/*
 *  cartFiller - v0.0.1
 *  Tool for automating cart filling process when doing big purchases
 *  https://andrey012.github.com/cartFiller
 *
 *  Made by Andrey Grinenko
 *  Under MIT License
 */
(function(){(function(a,b){"use strict";var c,d="undefined"!=typeof this.cartFillerConfiguration,e="undefined"!=typeof this.cartFillerEval;if(e&&!d?(b.cartFillerConfiguration={},c=b.cartFillerConfiguration):(this.cartFillerConfiguration={},c=this.cartFillerConfiguration),c.concatenated=d,c.localIndexHtml="",c.localInjectJs="",c.scripts=[],c.uiLaunched=!1,c.launch=function(d){console.log(""),a.getElementsByTagName("body")[0].getAttribute("data-old-cartfiller-version-detected")||(!d&&b.opener&&b.opener!==b||b.parent&&/\#?\/?launchSlaveInFrame$/.test(b.location.hash)?this.modules.dispatcher.startSlaveMode():c.uiLaunched||(c.uiLaunched=!0,"0"===String(c["data-type"])?this.modules.ui.framed(a,b):"1"===String(c["data-type"])?this.modules.ui.popup(a,b):alert("Type not specified, should be 0 for framed, 1 for popup")))},c.baseUrl="",c["data-type"]=0,c["data-choose-job"]="",c["data-debug"]=!1,c["data-worker"]="",c.gruntBuildTimeStamp="1485201331453",e)c.baseUrl=this.cartFillerEval[0],c["data-type"]=this.cartFillerEval[1],c["data-choose-job"]=this.cartFillerEval[2],c["data-debug"]=this.cartFillerEval[3],c["data-worker"]=this.cartFillerEval[4],c["data-wfu"]=this.cartFillerEval[5],c.localInjectJs=this.cartFillerEval[6];else{var f,g=a.getElementsByTagName("head")[0].getElementsByTagName("script");for(f=0;f<g.length;f++){var h=g[f];if(null!==h.getAttribute("data-type")&&null!==h.getAttribute("data-base-url")&&null!==h.getAttribute("data-choose-job")){for(var i=h.attributes,j=i.length-1;j>=0;j--)/^data-/.test(i[j].name)&&("data-base-url"===i[j].name?c.baseUrl=i[j].value:c[i[j].name]=i[j].value);break}}}if(!d){var k=a.createElement("script");k.setAttribute("src",c.baseUrl+"/boot/helpers/loader.js"),a.getElementsByTagName("head")[0].appendChild(k)}}).call(this,document,window),function(a,b,c){"use strict";var d=this.cartFillerConfiguration,e=function(a){return String(a).replace(/\s+/g," ").trim().toLowerCase()},f=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c]);return b},g=function(){var a;try{a=d.modules.ui.mainFrameWindow.document}catch(b){}return a};d.scripts.push({env:{},debug:!1,getName:function(){return"api"},registerWorker:function(a){return d.modules.dispatcher.registerWorker(a),this},result:function(a,b,c){return d.modules.dispatcher.submitWorkerResult(a,b,c),this},skipTask:function(){return d.modules.dispatcher.manageTaskFlow("skipTask"),this},skipStep:function(a){return"undefined"==typeof a&&(a=1),d.modules.dispatcher.manageTaskFlow("skipStep,"+a),this},skipJob:function(){return d.modules.dispatcher.manageTaskFlow("skipJob"),this},repeatTask:function(){return d.modules.dispatcher.manageTaskFlow("repeatTask"),this},repeatJob:function(){return d.modules.dispatcher.manageTaskFlow("repeatJob"),this},repeatStep:function(a){return c===a&&(a=1),d.modules.dispatcher.manageTaskFlow("repeatStep,"+String(a)),this},nop:function(){return d.modules.dispatcher.submitWorkerResult("","nop"),this},onload:function(a){return c===a&&(a=function(){d.modules.api.result()}),d.modules.dispatcher.registerWorkerOnloadCallback(a),this},waitFor:function(a,b,e,f,h){h=h||[],c===e&&(e=2e4),c===f&&(f=200);var i=Math.round(e/f);b||(b=""),"string"==typeof b&&(b=function(a){return function(b){d.modules.api.result(b?"":a.length?a:"timeout")}}(b));var j=function(){var c;try{c=a.apply(g(),h)}catch(e){return void d.modules.dispatcher.reportErrorResult(e)}if(!1!==d.modules.dispatcher.getWorkerCurrentStepIndex())if(c)try{h.unshift(c),b.apply(g(),h)}catch(e){return void d.modules.dispatcher.reportErrorResult(e)}else if(i--,i>0)d.modules.api.setTimeout(j,f);else try{h.unshift(!1),b.apply(g(),h)}catch(e){return void d.modules.dispatcher.reportErrorResult(e)}};return d.modules.api.setTimeout(j,f),this},waiter:function(a,b,c,e){return function(){d.modules.api.waitFor(a,b,c,e,f(arguments))}},highlight:function(a,b,c){try{d.modules.ui.highlight(a,b,c),d.modules.dispatcher.setReturnedValueOfStep(a)}catch(e){}return this},arrow:function(a,b,c){try{d.modules.ui.arrowTo(a,b,c),d.modules.dispatcher.setReturnedValueOfStep(a)}catch(e){}return this},"return":function(a){return d.modules.dispatcher.setReturnedValueOfStep(a),this},say:function(a,b,e){return d.modules.ui.say(a===c||null===a?a:String(a),b,e),this},each:function(a,b,e){var f,g=!1,h=function(a){return a===!1||0===a||a===d.modules.api};if(a instanceof Array||a.constructor&&("HTMLCollection"===a.constructor.name||"[object HTMLCollection]"===String(a.constructor)||"NodeListConstructor"===a.constructor.name||"[object NodeListConstructor]"===String(a.constructor))||"[object NodeList]"===String(a)){for(f=0;f<a.length;f++)if(h(b.call(d.modules.ui.mainFrameWindow.document,f,a[f]))){g=!0;break}}else if(null!==a&&"object"==typeof a&&"string"==typeof a.jquery&&c!==a.length&&"function"==typeof a.each)a.each(function(a,c){return h(b.call(d.modules.ui.mainFrameWindow.document,a,c))?(g=!0,!1):void 0});else for(f in a)if(a.hasOwnProperty(f)&&h(b.call(d.modules.ui.mainFrameWindow.document,f,a[f]))){g=!0;break}!g&&e instanceof Function&&e()},map:function(a,b,e){var f=[];f.map=function(a,b){return d.modules.api.map(f,a,b)};var g=function(a){f.push(a)},h=function(a){f.unshift(a)};return d.modules.api.each(a,function(a,c){return b.apply(f,[a,c,g,h])},e?function(){return e(g,h)}:c),f},compare:function(a,b){if(a=String(a),b=String(b),a===b)return"";for(var c="[",d=0;d<Math.max(a.length,b.length);d++){if(a.substr(d,1)!==b.substr(d,1)){c+="] <<< expected: ["+a.substr(d)+"], have: ["+b.substr(d)+"]";break}c+=a.substr(d,1)}return c},setTimeout:function(a,b){d.modules.dispatcher.registerWorkerSetTimeout(setTimeout(d.modules.api.applier(a),b))},setInterval:function(a,b){d.modules.dispatcher.registerWorkerSetInterval(setInterval(d.modules.api.applier(a),b))},click:function(a){return d.modules.api.clicker(a)},clicker:function(a,b){return["click",function(e){if(d.modules.api.debug)debugger;return b&&b.apply(g(),arguments),e?("object"==typeof e&&"string"==typeof e.jquery&&c!==e.length?e[0].click():e instanceof Array?e[0].click():e.click(),void(c===a||a===d.modules.api.result?d.modules.api.result():a===d.modules.api.onload?d.modules.api.onload():a.apply(g(),arguments))):d.modules.api.result()}]},confirmer:function(a,b,c){return["confirm",function(){d.modules.api.confirm("function"==typeof a?a:a[1],b,c,arguments)}]},confirm:function(a,b,c,e){if(d.modules.api.debug)debugger;var f,h=d.modules.ui.mainFrameWindow.confirm,i=!1,j=!1;d.modules.ui.mainFrameWindow.confirm=function(a){return i=!0,f=a,j="undefined"!=typeof c?"object"==typeof c?c.test(a):String(c)===String(a):!0,d.modules.ui.mainFrameWindow.confirm=h,b||"undefined"==typeof b},a.apply(g(),e)},openRelay:function(a,b){return d.modules.dispatcher.openRelayOnTheTail(a,b),this},registerOnloadCallback:function(a,b){return d.modules.dispatcher.registerEventCallback("onload",b?a:"",b?b:a),this},type:function(a,b,c,e){return d.modules.api.typer(a,b,c,e)},typer:function(a,b,e,f){var h=["type key sequence",function(h){var i=arguments;if(d.modules.api.debug)debugger;var j,k=function(){c===b||b===d.modules.api.result?d.modules.api.result():b===d.modules.api.onload?d.modules.api.onload():b.apply(g(),i)};if(!h)return d.modules.api.result();j="object"==typeof h&&"string"==typeof h.jquery&&c!==h.length?h[0]:h instanceof Array?h[0]:h,j.focus();var l;if(a instanceof Function)l=a();else if(c!==d.modules.dispatcher.getWorkerTask()[a])l=d.modules.dispatcher.getWorkerTask()[a];else{if(c===d.modules.dispatcher.getWorkerGlobals()[a])return void d.modules.api.result("Value to type ["+a+"] not found neither in the task properties nor in globals");l=d.modules.dispatcher.getWorkerGlobals()[a]}if(l=String(l),!e)try{j.value=""}catch(m){}var n=j.ownerDocument,o=function(a,b,c){var e,g=a.substr(0,1),i=g.charCodeAt(0),j=a.substr(1),l={get:function(){return i}},m={get:function(){return!1}},p=!0;for(var q in{keydown:0,keypress:0,input:0,keyup:0})if(("keypress"!==q||p)&&(g.length||"keypress"!==q)){var r=!1,s=!1;if("input"===q){try{r=new b.ownerDocument.defaultView.Event("input")}catch(r){}if(!r)try{r=b.createEvent("UIEvent"),r.initUIEvent("input")}catch(r){}if(!r)continue}else{r=b.ownerDocument.createEvent("KeyboardEvent");try{Object.defineProperty(r,"keyCode",l)}catch(r){s=!0}try{Object.defineProperty(r,"charCode",l)}catch(r){s=!0}try{Object.defineProperty(r,"metaKey",m)}catch(r){s=!0}try{Object.defineProperty(r,"which",l)}catch(r){s=!0}if(r.initKeyboardEvent?r.initKeyboardEvent(q,!0,!0,n.defaultView,!1,!1,!1,!1,i,i):r.initKeyEvent(q,!0,!0,n.defaultView,!1,!1,!1,!1,i,i),f&&(r.keyCode!==i||r.charCode!==i))return d.modules.api.result("could not set correct keyCode or charCode for "+q+": keyCode returns ["+r.keyCode+"] , charCode returns ["+r.charCode+"] instead of ["+i+"]"),!1;if(f&&r.metaKey)return d.modules.api.result("could not set metaKey to false"),!1}e=!0;try{e=b.dispatchEvent(r)}catch(r){}e||"keydown"!==q||(p=!1),(s||e)&&"keypress"===q&&(b.value=b.value+g)}if(0===j.length){try{var t=new b.ownerDocument.defaultView.Event("change",{bubbles:!0});b.dispatchEvent(t)}catch(r){}d.modules.api.arrow(h),k()}else d.modules.api.setTimeout(function(){o(j,b,c)},0)};o(l,j,b)}];return h[1].cartFillerParameterList=[a],h},apply:function(a){try{for(var b=[],c=1;c<arguments.length;c++)b.push(arguments[c]);a.apply(d.modules.dispatcher.getWorker(),b)}catch(e){throw d.modules.dispatcher.reportErrorResult(e),e}},applier:function(a){return function(){for(var b=[a],c=0;c<arguments.length;c++)b.push(arguments[c]);d.modules.api.apply.apply(d.modules.api,b)}},define:function(a,b){if(a instanceof Function){var c=/^\s*function\s+([^(]+)\(/;if(!c.test(a.toString())){var e="invalid shared function definition, if name is not specified as first parameter of api.define() call, then function should be named";throw alert(e),new Error(e)}var f=c.exec(a.toString());b=a,a=f[1]}return d.modules.dispatcher.defineSharedWorkerFunction(a,b),this},sleep:function(a){if("undefined"==typeof a){var b=d.modules.ui.getMessageToSay();a="undefined"===b?0:1e3+Math.floor(20*String(b).length)}return d.modules.dispatcher.setSleepAfterThisStep(a),this},drill:function(){for(var a=d.modules.dispatcher.getFrameToDrill(),b=a.filter(function(){return 1}),c=d.modules.ui.mainFrameWindow,e=b.length;b.length;)c=c.frames[b.shift()];var f=arguments[e](c);if(f)for(var g=0;g<c.frames.length;g++)if(f===c.frames[g]){for(var h=c.document.getElementsByTagName("iframe"),i=0;i<h.length;i++)h[i].contentWindow===f&&d.modules.ui.addElementToTrack("iframe",h[i],!0,[i]);return d.modules.dispatcher.drill(g)}return this},compareCleanText:function(a,b){return e(a)===e(b)},containsCleanText:function(a,b){return-1!==e(a).indexOf(e(b))},suspendRequests:function(a){d.modules.dispatcher.onMessage_toggleEditorMode({enable:!1,cb:a})},setAdditionalWindows:function(a){return a=a||[],d.modules.dispatcher.setAdditionalWindows(a),this},switchToWindow:function(a){return d.modules.dispatcher.switchToWindow(a),this}})}.call(this,document,window),function(document,window,undefined){"use strict";var worker=!1,workerSourceCodes={},workerCurrentTask={},workerCurrentTaskIndex=!1,workerCurrentStepIndex=!1,workerOnLoadHandler=!1,onLoadHappened=!1,workerTimeout=0,workerSetTimeoutIds=[],workerSetIntervalIds=[],workerWatchdogId=!1,workerGlobals={},workerLibResolve=function(a,b,c){var d,e;if("function"==typeof a||a instanceof Array){var f=!1;if(undefined===b.promiseArgs[0]&&"function"==typeof a&&"string"==typeof a.name&&a.name.length)e="helper",d=a.name;else{if("string"!=typeof b.promiseArgs[0]||!b.promiseArgs[0].length||"function"==typeof a&&"string"==typeof a.name&&a.name.length)throw new Error("invalid lib usage, name of function should either be specified as a parameter or named function should be used");e="step builder",d=b.promiseArgs[0],f=!0}var g=b.promiseArgs.slice(1);return"function"==typeof a?(workerLibByWorkerPath[c][d]=a,workerLibByWorkerPath[c][d].cartFillerWorkerLibType=e,f?a.apply({},g):[]):(workerLibByWorkerPath[c][d]=function(){return a},workerLibByWorkerPath[c][d].cartFillerWorkerLibType=e,a)}if(d=b.promiseArgs[0],"function"==typeof d){if("string"!=typeof d.name||!d.name.length)throw new Error("incorrect usage of lib, only named functions should be defined like that");return workerLibByWorkerPath[c][d.name]=d,workerLibByWorkerPath[c][d.name].cartFillerWorkerLibType="helper",[]}var h=d.split(".");d=h.pop();var i=workerLibByWorkerPath[c];if(h.filter(function(a,b){if(!i[a]||!i[a].cartFillerWorkerLibFn)throw new Error("lib ["+c+"]->["+h.slice(0,b).join(".")+"] does not have ["+a+"] sublib");i=i[a]}),!i.hasOwnProperty(d))throw new Error("lib ["+c+"]->["+h.join(".")+"] does not have ["+d+"] entry");return"function"==typeof i[d]?i[d].apply({},b.promiseArgs.slice(1)):i[d]},workerLibByWorkerPath,workerLib,workerLibFactory=function(a){var b=function(){var b=function(c){return workerLibResolve(c,b,a.join("."))};b.cartFillerLibPromiseFunction=!0,b.promiseArgs=[];for(var c=0;c<arguments.length;c++)b.promiseArgs.push(arguments[c]);return b.none=[],b};return b.cartFillerWorkerLibFn=!0,b.cartFillerWorkerLibPath=a.join("."),b},makeProxyForWorkerLib=function(a){var b=function(){var b;try{b=me.modules.ui.mainFrameWindow.document}catch(c){}return a.apply(b,arguments)};return b.cartFillerWorkerLibType=a.cartFillerWorkerLibType,"step builder"!==b.cartFillerWorkerLibType&&(b.cartFillerWorkerLibType="helper"),a.cartFillerWorkerLibType=b.cartFillerWorkerLibType,b},workerLibBrief={},workerUrlsCommonPart,resetWorkerLib=function(){workerLib=workerLibFactory([]),workerLibByWorkerPath={},workerLibBrief={},workerUrlsCommonPart=!1;for(var a in workerSourceCodes)if(!1!==workerUrlsCommonPart){for(var b=workerUrlsCommonPart.length;b>=0&&workerUrlsCommonPart.substr(0,b)!==a.substr(0,b);b--);workerUrlsCommonPart=workerUrlsCommonPart.substr(0,b)}else workerUrlsCommonPart=a},ambiguousWorkerLibProxyFunctionFactory=function(a){return function(){throw new Error("["+a+"] is ambiguous inside lib, use fully qualified name")}},processWorkerLibByPath=function(a,b){for(var c in a)a.hasOwnProperty(c)&&("function"==typeof a[c]?a[c]=makeProxyForWorkerLib(a[c]):"object"==typeof a[c]&&(a[c].cartFillerWorkerLibType="steps"),workerLib[c]=workerLib.hasOwnProperty(c)?ambiguousWorkerLibProxyFunctionFactory(c):a[c],a[c].cartFillerWorkerLibType&&(workerLibBrief[(b.join(".")+"."+c).replace(/^\./,"")]=a[c].cartFillerWorkerLibType));var d=workerLib,e=[];b.filter(function(c,f){if(e.push(c),undefined===d[c])d[c]=f===b.length-1?a:workerLibFactory(e);else{if(!d[c].cartFillerWorkerLibFn)throw new Error("naming conflict, can't put workerLib on this path: ["+e.join(".")+"]");if(f===b.length-1)throw new Error("can't replace workerLib on this path: ["+e.join(".")+"]")}d=d[c]})},postProcessWorkerLibs=function(){for(var a in workerLibByWorkerPath)for(var b in workerLib)workerLib.hasOwnProperty(b)&&!workerLibByWorkerPath[a].hasOwnProperty(b)&&(workerLibByWorkerPath[a][b]=workerLib[b])},makeLibPathFromWorkerPath=function(a){return a.substr(workerUrlsCommonPart.length).replace(/(^|\/)workers\//g,function(a,b){return b}).replace(/\.js$/,"").split("/")},workerEventListeners={},resultMessageName=!1,statusMessageName=!1,mainFrameLoaded=!1,workerFrameLoaded=!1,workerCurrentUrl=!1,bootstrapped=!1,returnedValuesOfSteps=[],returnedValuesOfStepsAreForTask,mostRecentReturnedValueOfStep,jobDetailsCache={},stepRepeatCounter=0,currentStepEnv={},currentStepWorkerFn,me=this.cartFillerConfiguration,oldTitle,sleepAfterThisStep,useTopWindowForLocalFileOperations,currentInvokeWorkerMessage,suspendAjaxRequestsCallback,magicParamPatterns={repeat:/repeat(\d+)/,sleep:/sleep(\d+)/},rememberedHashParams={},hideHashParam={},mainWindowOwnedByTestSuite=window.document.getElementsByTagName("body")[0].getAttribute("data-cartfiller-is-here")?!0:!1,relay={isSlave:!1,slaveCounter:0,parent:!1,currentMainFrameWindow:0,nextRelay:!1,nextRelayRegistered:!1,nextRelayQueue:[],knownUrls:{},igniteFromLocal:!1,bubbleMessage:function(a){this.isSlave&&postMessage(this.parent,"bubbleRelayMessage",a),this.nextRelay&&(this.nextRelayRegistered?postMessage(this.nextRelay,"bubbleRelayMessage",a):(a.cmd="bubbleRelayMessage",this.nextRelayQueue.push(a)))}},getWorkerFnParams=function(){returnedValuesOfStepsAreForTask!==workerCurrentTaskIndex&&(returnedValuesOfSteps=[returnedValuesOfSteps.pop()],returnedValuesOfStepsAreForTask=workerCurrentTaskIndex);for(var a=[],b=1,c=workerCurrentStepIndex;c>=0;c--)if(c in returnedValuesOfSteps){for(;b--;)a.push(returnedValuesOfSteps[c]);b=1}else b++;return a},callEventCallbacks=function(a){if(undefined!==workerEventListeners[a])for(var b in workerEventListeners[a])workerEventListeners[a][b]()},postMessage=function(a,b,c,d){undefined===d&&(d="cartFillerMessage"),undefined===c&&(c={}),c.cmd=b,a.postMessage(d+":"+JSON.stringify(c),"*")},resetWorker=function(){clearRegisteredTimeoutsAndIntervals(),workerCurrentTaskIndex=workerCurrentStepIndex=workerOnLoadHandler=suspendAjaxRequestsCallback=!1},fillWorkerCurrentTask=function(a){for(var b in workerCurrentTask)workerCurrentTask.hasOwnProperty(b)&&delete workerCurrentTask[b];var c;for(var d in a)a.hasOwnProperty(d)&&(c=a[d],c instanceof Array&&(c=workerGlobals[decodeAlias(c)]),workerCurrentTask[d]=c)},decodeAlias=function(a){var b=a.map(function(a){return a instanceof Array?String(workerGlobals[decodeAlias(a)]):a});return b.join("")},fillWorkerGlobals=function(a){for(var b in workerGlobals)workerGlobals.hasOwnProperty(b)&&delete workerGlobals[b];for(var c in a)a.hasOwnProperty(c)&&(workerGlobals[c]=a[c])},getLibUrl=function(){return me.localIndexHtml?"":me.baseUrl.replace(/(src|dist)\/?$/,"lib/")},nextTaskFlow,initialized,clearRegisteredTimeoutsAndIntervals=function(){for(;workerSetTimeoutIds.length;)clearTimeout(workerSetTimeoutIds.pop());for(;workerSetIntervalIds.length;)clearInterval(workerSetIntervalIds.pop())},registerWorkerWatchdog=function(){workerWatchdogId&&workerWatchdogId!==!0?removeWatchdogHandler():workerWatchdogId=!1,workerWatchdogId=workerTimeout?setTimeout(function(){workerWatchdogId=!1,workerOnLoadHandler=suspendAjaxRequestsCallback=!1,me.modules.api.result("Timeout happened, worker step cancelled")},workerTimeout):!0},removeWatchdogHandler=function(){workerWatchdogId&&(workerWatchdogId!==!0&&clearTimeout(workerWatchdogId),workerWatchdogId=!1)},openRelay=function(a,b,c){relay.knownUrls[a]=!0,relay.nextRelay&&b?relay.nextRelayRegistered?postMessage(relay.nextRelay,b.cmd,b):relay.nextRelayQueue.push(b):(relay.nextRelay=window.open(a,"_blank","toolbar=yes, location=yes, status=yes, menubar=yes, scrollbars=yes"),c&&setTimeout(function(){relay.nextRelay.blur(),window.focus()},0),b&&relay.nextRelayQueue.push(b),me.localInjectJs&&(relay.igniteFromLocal=!0,setTimeout(function d(){relay.igniteFromLocal&&(relay.nextRelay.postMessage(me.localInjectJs,"*"),setTimeout(d,500))},500)))},workersToEvaluate=[],sharedWorkerFunctions={},currentEvaluatedWorker,workerTaskSources={},evaluateNextWorker=function(){if(!workersToEvaluate.length)return void me.modules.dispatcher.postMessageToWorker("globalsUpdate",{globals:workerGlobals});currentEvaluatedWorker=workersToEvaluate.shift();var apiIsThere=!1,injectDebuggerFn=function(a,b){return!apiIsThere&&/\,\s*api\s*\,/.test(a)&&(apiIsThere=!0),apiIsThere?b+" if(api.debug && (1 || api.debug.stop)) debugger; ":a};eval(workerSourceCodes[currentEvaluatedWorker].replace(/(function\s*\([^)]*\)\s*{[ \t]*)/g,injectDebuggerFn)),evaluateNextWorker()},recursivelyCollectSteps=function(a,b){"undefined"==typeof b&&(b=[]);for(var c=0;c<a.length;c++)a[c]===me.modules.api||(a[c]instanceof Array&&(0===a[c].length||a[c].length>0&&("string"==typeof a[c][0]||a[c][0]instanceof Array||"function"==typeof a[c][0]&&a[c][0].cartFillerLibPromiseFunction))?recursivelyCollectSteps(a[c],b):b.push(a[c]));return b},resolveLibPromisesInWorker=function(){var a=!1;for(var b in worker)for(var c=worker[b].length-1;c>=0;c--)if("function"==typeof worker[b][c])if(worker[b][c].cartFillerLibPromiseFunction===!0){a=!0;var d=recursivelyCollectSteps(worker[b][c]());d.unshift(1),d.unshift(c),worker[b].splice.apply(worker[b],d)}else"helper"===worker[b][c].cartFillerWorkerLibType&&worker[b].splice(c,1);a&&resolveLibPromisesInWorker()},evaluateWorkers=function(){workersToEvaluate=[],sharedWorkerFunctions={};for(var a in workerSourceCodes)workersToEvaluate.push(a);resetWorkerLib(),evaluateNextWorker(),postProcessWorkerLibs(),resolveLibPromisesInWorker();var b={},c={},d={};for(var e in worker){d[e]={};var f=[],g={},h={};for(a=0;a<worker[e].length;a++)"string"==typeof worker[e][a]&&(f.push(worker[e][a]),worker[e][a+1]instanceof Function&&(g[f.length-1]=discoverTaskParameters(worker[e][a+1],h),d[e][f.length-1]=discoverStepDependencies(worker[e][a+1])));g.all=h,b[e]=f,c[e]=g}me.modules.dispatcher.postMessageToWorker("workerRegistered",{jobTaskDescriptions:b,discoveredParameters:c,workerTaskSources:workerTaskSources,stepDependencies:d,workerLib:workerLibBrief})},discoverStepDependencies=function(a){var b=a.toString().split("(")[1].split(")")[0].split(",")[0].trim();if(b.length){for(var c in magicParamPatterns)if(magicParamPatterns[c].test(b))return!1;return!0}return!1},discoverTaskParameters=function(a,b){var c={};return[/[^a-zA-Z0-9_$]task\.([a-zA-Z0-9_$]+)[^a-zA-Z0-9_$]/g,/[^a-zA-Z0-9_$]task\[['"]([^'"]+)['"]\]/g].filter(function(d){var e=new RegExp(d.source),f=a.toString(),g=f.match(d);g&&g.filter(function(a){var d=e.exec(a);d&&(c[d[1]]=b[d[1]]=!0)});var h=a.cartFillerParameterList;if("undefined"!=typeof h)if(h instanceof Array)h.filter(function(a){c[a]=b[a]=!0});else for(var i in h)c[i]=b[i]=!0}),c},startupWatchDog={fn:function(){var a=[];if(this.workerRegistered||a.push("worker"),a.length){var b="one or more frames were not registered: "+a.join(", ");window.cartFillerEventHandler&&window.cartFillerEventHandler({message:b,filename:"dispatcher.js",lineno:0}),alert(b)}},workerRegistered:!1,chooseJobRegistered:!1,mainRegistered:!1};this.cartFillerConfiguration.scripts.push({running:!1,getName:function(){return"dispatcher"},init:function(a){a||setTimeout(function(){startupWatchDog.fn()},1e4);var b=this;initialized||(initialized=!0,window.addEventListener("message",function(a){var c="cartFillerMessage:";if(c===a.data.substr(0,c.length)){var d=JSON.parse(a.data.substr(c.length));if(a.source===relay.nextRelay&&"register"!==d.cmd&&"bubbleRelayMessage"!==d.cmd&&"locate"!==d.cmd)"workerStepResult"===d.cmd&&fillWorkerGlobals(d.globals),postMessage(relay.isSlave?relay.parent:me.modules.ui.workerFrameWindow,d.cmd,d);else{var e="onMessage_"+d.cmd;undefined!==b[e]&&b[e]instanceof Function?b[e](d,a.source):console.log("unknown message: "+e+":"+a.data)}}else if(0===a.data.indexOf("cartFillerFilePopupUrl")||0===a.data.indexOf("cartFillerFilePopupPing"))window.opener.postMessage(a.data,"*");else if("/^'cartFillerEval'/"===a.data)a.source.postMessage(me.localInjectJs,"*");else if(0===a.data.indexOf("'cartFillerEval';"));else{var f=function(a,b,c){if(c>20)return{};"undefined"==typeof c&&(c=0),"undefined"==typeof b&&(b=[]);var d,e=function(a){return a===d},g={};for(var h in a){d=a[h];try{if(!(d instanceof Window||d instanceof Function||"[object Window]"===d.toString())){var i=null;try{"object"==typeof d&&d.constructor&&(i=d.constructor.name)}catch(d){}"Window"!==i&&(b.filter(e).length||(b.push(d),g[h]="object"==typeof a[h]?f(d,b,c+1):a[h]))}}catch(d){}}return g};me.modules.dispatcher.onMessage_postMessage({cmd:"postMessage",event:f(a),originalEvent:a})}return!1},!1))},onMessage_register:function(a,b){if(a.registerFromSlave&&(relay.nextRelay=b),b===me.modules.ui.workerFrameWindow)workerFrameLoaded=!0,startupWatchDog.workerRegistered=!0,mainFrameLoaded&&!bootstrapped&&this.bootstrapCartFiller();else if(b===me.modules.ui.chooseJobFrameWindow)startupWatchDog.chooseJobRegistered=!0,this.postMessageToChooseJob("bootstrap",{lib:getLibUrl(),testSuite:!0,src:me.localIndexHtml?"":me.baseUrl.replace(/\/$/,"")+"/",hashUrl:window.location.hash},"cartFillerMessage");else if(b===me.modules.ui.mainFrameWindow)startupWatchDog.mainRegistered=!0,postMessage(b,"bootstrap",{dummy:!0});else if(b===relay.nextRelay){relay.igniteFromLocal=!1,relay.nextRelayRegistered=!0;var c,d=[];for(c in workerSourceCodes)workerSourceCodes.hasOwnProperty(c)&&d.push(c);for(var e=d.length-1;e>=0;e--)relay.nextRelayQueue.unshift({cmd:"loadWorker",jobDetailsCache:jobDetailsCache,src:d[e],code:workerSourceCodes[d[e]],isFinal:e===d.length-1});for(var f;relay.nextRelayQueue.length;)f=relay.nextRelayQueue.shift(),postMessage(relay.nextRelay,f.cmd,f)}},onMessage_makeSmaller:function(){me.modules.ui.setSize("small")},onMessage_makeBigger:function(){me.modules.ui.setSize("big")},onMessage_toggleSize:function(a){me.modules.ui.setSize(a.size)},onMessage_chooseJob:function(a){relay.isSlave?(a.notToChildren=!0,this.onMessage_bubbleRelayMessage(a)):(me.modules.ui.showHideChooseJobFrame(!0),this.postMessageToWorker("chooseJobShown"),a.hideHashDetails&&(hideHashParam={job:1,task:1,step:1}),this.onMessage_updateHashUrl({params:{}}))},onMessage_chooseJobCancel:function(){relay.isSlave?(details.notToChildren=!0,this.onMessage_bubbleRelayMessage(details)):(me.modules.ui.showHideChooseJobFrame(!1),this.postMessageToWorker("chooseJobHidden"),hideHashParam={},this.onMessage_updateHashUrl({params:{}}))},onMessage_jobDetails:function(a){var b=function(a){if(!(a instanceof Array)){var b=[];for(c=0;"undefined"!=typeof a[c];c++)b.push(a[c]);a=b}return a};if(undefined!==a.details){workerSourceCodes={},resultMessageName=a.resultMessage?a.resultMessage:!1,statusMessageName=a.statusMessage?a.statusMessage:!1,me.modules.ui.showHideChooseJobFrame(!1),hideHashParam={},a.overrideWorkerSrc=me["data-worker"],workerTimeout=a.timeout,workerCurrentTask={},resetWorker();var c;for(c in jobDetailsCache)jobDetailsCache.hasOwnProperty(c)&&delete jobDetailsCache[c];for(c in a)jobDetailsCache[c]=a[c];worker={},workerGlobals=a.globals=a.globals?a.globals:{},a.details=b(a.details),workerEventListeners={}}else{if(undefined===a.$cartFillerTestUpdate){if(undefined!==a.$preventPageReload)return void me.modules.ui.preventPageReload();throw new Error("unknown job details package - should have either details or $cartFillerTestUpdate")}a.$cartFillerTestUpdate.details=b(a.$cartFillerTestUpdate.details)}this.postMessageToWorker("jobDetails",a)},onMessage_sendResult:function(a){me.modules.ui.showHideChooseJobFrame(!0),resultMessageName&&this.postMessageToChooseJob(resultMessageName,a)},onMessage_sendStatus:function(a){relay.isSlave?(a.message="sendStatus",a.notToChildren=!0,a.cmd="bubbleRelayMessage",this.onMessage_bubbleRelayMessage(a)):statusMessageName&&this.postMessageToChooseJob(statusMessageName,a)},onMessage_loadWorker:function(a){try{a.jobDetailsCache&&(jobDetailsCache=a.jobDetailsCache),workerSourceCodes[a.src]=a.code,a.isFinal&&(evaluateWorkers(),relay.isSlave&&this.onMessage_bubbleRelayMessage({message:"slaveReady",notToChildren:!0})),relay.nextRelay&&(a.jobDetailsCache=jobDetailsCache,postMessage(relay.nextRelay,a.cmd,a))}catch(b){throw alert(b),console.log(b),b}},onMessage_updateProperty:function(a){if(parseInt(a.index)===parseInt(workerCurrentTaskIndex)){var b=a.value;b instanceof Array&&(b=workerGlobals[decodeAlias(b)]),workerCurrentTask[a.name]=b}},onMessage_invokeWorker:function(a){0===a.index&&0===a.step&&me.modules.ui.currentMainFrameWindow>0&&this.switchToWindow(0),relay.isSlave||(a.currentMainFrameWindow=me.modules.ui.currentMainFrameWindow);var b;if(currentInvokeWorkerMessage=a,a.globals&&fillWorkerGlobals(a.globals),this.running=a.running,relay.isSlave||a.drillToFrame&&a.drillToFrame.length||me.modules.ui.prepareTolearOverlaysAndReflect(),this.reflectMessage(a,a.drillToFrame))return void(a.debug&&console.log("Debugger call went to slave tab - look for it there!"));if(!1!==workerCurrentStepIndex)b="ERROR: worker task is in still in progress",alert(b);else{stepRepeatCounter=0,onLoadHappened=!1,nextTaskFlow="normal",workerCurrentTaskIndex!==a.index&&fillWorkerCurrentTask(a.details),workerCurrentTaskIndex=a.index,workerCurrentStepIndex=a.step,this.setReturnedValueOfStep(mostRecentReturnedValueOfStep),currentStepEnv={taskIndex:a.index,stepIndex:a.step,task:a.details,repeatCounter:a.repeatCounter,params:{}};try{if(undefined===worker[a.task])return alert(b="invalid worker - no function for "+a.task+" exist"),void me.modules.api.result(b,!1);if(undefined===worker[a.task][2*a.step+1])return alert(b="invalid worker - function for "+a.task+" step "+a.step+" does not exist"),void me.modules.api.result(b,!1);var c=worker[a.task][2*a.step+1];if("function"!=typeof c){if("function"!=typeof c[0])return alert(b="invalid worker - function for "+a.task+" step "+a.step+" is not a function"),void me.modules.api.result(b,!1);currentStepEnv.params=c[1],c=c[0]}if(registerWorkerWatchdog(),sleepAfterThisStep=undefined,currentStepWorkerFn=c,me.modules.api.debug=a.debug,a.debug){me.modules.api.debug={};try{Object.defineProperty(me.modules.api.debug,"stop",{get:function(){return me.modules.api.debug=!1,"debugging stopped"}})}catch(d){me.modules.api.debug.stop="can't attach getter"}console.log("to stop debugging of this step type api.debug = 0; in console, or hover over any api.debug.stop property")}me.modules.api.env=currentStepEnv,c.apply(me.modules.ui.getMainFrameWindowDocument(),getWorkerFnParams())}catch(b){throw this.reportErrorResult(b),b}}},reportErrorResult:function(a){if(console.log(a),workerWatchdogId){var b=String(a);b||(b="unknown exception"),me.modules.api.result(b,!1)}},onMessage_focusMainFrameWindow:function(){me.modules.ui.focusMainFrameWindow()},onMessage_resetWorker:function(a){relay.nextRelay&&openRelay("about:blank",a),resetWorker()},onMessage_closePopup:function(){me.modules.ui.closePopup()},onMessage_helloFromPlugin:function(a){this.postMessageToChooseJob(a.message,{useTopWindowForLocalFileOperations:useTopWindowForLocalFileOperations})},onMessage_refreshPage:function(a){this.reflectMessage(a)||me.modules.ui.refreshPage()},onMessage_startReportingMousePointer:function(){me.modules.ui.startReportingMousePointer()},onMessage_evaluateCssSelector:function(details){if(!me.modules.dispatcher.reflectMessage(details)){var arrow=[],elements;try{elements=eval("(function(window, document, jQuery, $, api){return jQuery"+details.selector+";})(me.modules.ui.mainFrameWindow, me.modules.ui.mainFrameWindow.document, me.modules.ui.mainFrameWindow.jQuery, me.modules.ui.mainFrameWindow.$, me.modules.api);")}catch(e){elements=[]}for(var i=0;i<elements.length&&16>i;i++)arrow.push(elements[i]);me.modules.ui.clearOverlays(),me.modules.ui.arrowTo(arrow,!0,!0),this.postMessageToWorker("cssSelectorEvaluateResult",{count:elements.length})}},onMessage_bubbleRelayMessage:function(a,b){a.cmd="bubbleRelayMessage",relay.isSlave&&b!==relay.parent&&!a.notToParents&&postMessage(relay.parent,a.cmd,a),relay.nextRelay&&b!==relay.nextRelay&&!a.notToChildren&&(relay.nextRelayRegistered?postMessage(relay.nextRelay,a.cmd,a):relay.nextRelayQueue.push(a)),"onMainFrameLoaded"===a.message?me.modules.dispatcher.onMainFrameLoaded(a.args[0],!0):"openRelayOnHead"!==a.message||relay.isSlave?"openRelayOnTail"!==a.message||relay.nextRelay?"updateTitle"===a.message?me.modules.dispatcher.onMessage_updateTitle(a):"drill"!==a.message||relay.isSlave?"drawOverlays"===a.message?me.modules.ui.drawOverlays(a):"clearOverlays"===a.message?me.modules.ui.clearOverlays():"drawOverlays"===a.message?me.modules.ui.drawOverlays():"tellWhatYouHaveToDraw"===a.message?me.modules.ui.tellWhatYouHaveToDraw():"sendStatus"===a.message&&b&&!relay.isSlave?me.modules.dispatcher.onMessage_sendStatus(a):"clearCurrentUrl"===a.message&&b?me.modules.dispatcher.onMessage_clearCurrentUrl():"prepareToClearOverlays"===a.message?me.modules.ui.prepareToClearOverlays():"setAdditionalWindows"!==a.message||relay.isSlave?"switchToWindow"!==a.message||relay.isSlave?"slaveReady"!==a.message||relay.isSlave?"chooseJob"!==a.message||relay.isSlave?"chooseJobCancel"!==a.message||relay.isSlave?"updateSlaveCounter"===a.message?relay.slaveCounter=a.slaveCounter:"broadcastReturnedValues"===a.message&&b?(a.returnedValuesOfStepsAreForTask!==returnedValuesOfStepsAreForTask&&(returnedValuesOfSteps=[undefined],
returnedValuesOfStepsAreForTask=a.returnedValuesOfStepsAreForTask),a.values.filter(function(a,b){undefined!==a&&(returnedValuesOfSteps[b]=a)})):"reportingMousePointerClickForWindow"===a.message&&b&&a.currentMainFrameWindow===relay.currentMainFrameWindow&&me.modules.ui.reportingMousePointerClickForWindow(a.x,a.y):me.modules.dispatcher.onMessage_chooseJobCancel(a):me.modules.dispatcher.onMessage_chooseJob(a):(relay.slaveCounter++,me.modules.dispatcher.onMessage_bubbleRelayMessage({message:"updateSlaveCounter",slaveCounter:relay.slaveCounter})):me.modules.dispatcher.switchToWindow(a.index):me.modules.dispatcher.setAdditionalWindows(a.descriptors,a):(a.cmd="invokeWorker",me.modules.dispatcher.onMessage_invokeWorker(a)):openRelay(a.args[0],undefined,a.args[1]):relay.knownUrls[a.args[0]]||(relay.knownUrls[a.args[0]]=!0,me.modules.dispatcher.onMessage_bubbleRelayMessage({message:"openRelayOnTail",args:a.args,notToParents:!0}))},onMessage_reportingMousePointerClick:function(a){me.modules.dispatcher.reflectMessage(a)||me.modules.ui.reportingMousePointerClick(a.x,a.y)},onMessage_postMessage:function(a){if(/^cartFillerFilePopup/.test(a.event.data))me.modules.ui.chooseJobFrameWindow.postMessage(a.event.data,"*");else if(!me.modules.dispatcher.reflectMessage(a)){var b;b=new me.modules.ui.mainFrameWindow.CustomEvent("message",a.event);for(var c in a.event)try{b[c]=a.event[c]}catch(d){}me.modules.ui.mainFrameWindow.dispatchEvent(b)}},onMessage_locate:function(){alert("Here I am!")},onMessage_updateHashUrl:function(a){if(mainWindowOwnedByTestSuite){var b,c=a.params;for(b in c)rememberedHashParams[b]=c[b];for(b in rememberedHashParams)undefined===c[b]&&(c[b]=rememberedHashParams[b]);var d=window.location.hash.replace(/^#\/?/,"").split("&").map(function(a){var b,d;for(d in hideHashParam)if(b=encodeURIComponent(d),0===a.indexOf(b+"="))return"";for(d in c)if(b=encodeURIComponent(d),0===a.indexOf(b+"=")){var e=hideHashParam[d]||""!==c[d]&&c[d]!==!1?b+"="+encodeURIComponent(c[d]):"";return delete c[d],e}return a}).filter(function(a){return a.length});for(b in c)hideHashParam[b]||""===c[b]||c[b]===!1||d.push(encodeURIComponent(b)+"="+encodeURIComponent(c[b]));var e=d.join("&");e.length<4096&&(window.history&&window.history.replaceState?window.history.replaceState(undefined,undefined,"#"+e):window.location.hash=e)}},onMessage_updateTitle:function(a){window.document.title=a.title},onMessage_requestWorkers:function(a){this.postMessageToChooseJob("cartFillerRequestWorkers",a)},onMessage_launchFromSlave:function(){useTopWindowForLocalFileOperations=!0,me.launch(!0)},onMessage_highlightElementForQueryBuilder:function(a){me.modules.dispatcher.reflectMessage(a)||me.modules.ui.highlightElementForQueryBuilder(a.path)},onMessage_updateGlobal:function(a){this.reflectMessage(a),workerGlobals[a.name]=a.value,fillWorkerCurrentTask(currentStepEnv.task)},onMessage_toggleEditorMode:function(a){this.onMessage_sendStatus({toggleEditorMode:!0,enable:a.enable}),a.cb&&(suspendAjaxRequestsCallback=a.cb),a.enable&&this.postMessageToWorker("toggleEditorModeResponse",{enabled:!0})},onMessage_suspendAjaxRequestsDone:function(a){this.reflectMessage(a)||(this.postMessageToWorker("toggleEditorModeResponse"),suspendAjaxRequestsCallback&&suspendAjaxRequestsCallback())},onMainFrameLoaded:function(a,b){if(mainFrameLoaded=!0,workerFrameLoaded&&!bootstrapped?this.bootstrapCartFiller():b||relay.bubbleMessage({message:"onMainFrameLoaded",args:[a]}),workerOnLoadHandler){try{callEventCallbacks("onload"),workerOnLoadHandler(a)}catch(c){this.reportErrorResult(c)}workerOnLoadHandler=!1,onLoadHappened=!1}else onLoadHappened=!0},postMessageToWorker:function(a,b){postMessage(me.modules.ui.workerFrameWindow,a,b)},postMessageToChooseJob:function(a,b,c){postMessage(me.modules.ui.chooseJobFrameWindow,a,b,c?c:a)},bootstrapCartFiller:function(){bootstrapped=!0,this.postMessageToWorker("bootstrap",{lib:getLibUrl(),debug:me["data-debug"]})},registerWorker:function(a){var b=makeLibPathFromWorkerPath(currentEvaluatedWorker),c=workerLibFactory(b);workerLibByWorkerPath[b.join(".")]=c;var d={window:me.modules.ui.mainFrameWindow,document:undefined,api:me.modules.api,task:workerCurrentTask,job:jobDetailsCache,globals:workerGlobals,lib:c},e=a.toString().split("(")[1].split(")")[0].split(",").map(function(a){return a=a.trim(),d.hasOwnProperty(a)?d[a]:function(){for(;!sharedWorkerFunctions[a]&&workersToEvaluate.length;)evaluateNextWorker();if(!sharedWorkerFunctions[a]){var b="bad worker - shared function was not defined: ["+a+"]";throw alert(b),new Error(b)}return sharedWorkerFunctions[a].apply(worker,arguments)}}),f=a.apply(undefined,e);processWorkerLibByPath(c,b);for(var g in f)f.hasOwnProperty(g)&&(worker[g]=recursivelyCollectSteps(f[g]),workerTaskSources[g]=currentEvaluatedWorker)},manageTaskFlow:function(a){nextTaskFlow=a},submitWorkerResult:function(a,b,c){if(suspendAjaxRequestsCallback&&(suspendAjaxRequestsCallback=!1,this.onMessage_toggleEditorMode({enable:!0})),workerCurrentStepIndex===!1)return void alert("You have invalid worker, result is submitted twice, please fix");for(var d in currentStepEnv.task)if(currentStepEnv.task[d]instanceof Array){for(var e=currentStepEnv.task[d][0];e[0]instanceof Array;e=e[0]);workerGlobals[decodeAlias(currentStepEnv.task[d])]=workerCurrentTask[d]}var f,g;if(undefined===a||""===a)f="ok";else{if("string"!=typeof a)throw new Error("invalid message type "+typeof a);f=b?"skip":"error"}if(clearRegisteredTimeoutsAndIntervals(),this.onMessage_bubbleRelayMessage({message:"tellWhatYouHaveToDraw"}),"ok"!==f){if(stepRepeatCounter++,g=magicParamPatterns.repeat.exec(currentStepWorkerFn.toString().split(")")[0]),g&&parseInt(g[1])>stepRepeatCounter)return void me.modules.api.setTimeout(function(){currentStepWorkerFn.apply(me.modules.ui.getMainFrameWindowDocument(),getWorkerFnParams())},1e3)}else"undefined"==typeof sleepAfterThisStep&&(g=magicParamPatterns.sleep.exec(currentStepWorkerFn.toString().split(")")[0]),g&&(sleepAfterThisStep=parseInt(g[1])));removeWatchdogHandler();var h={index:workerCurrentTaskIndex,step:workerCurrentStepIndex,status:f,message:a,response:c,nop:"nop"===b,nextTaskFlow:nextTaskFlow,globals:workerGlobals,sleep:sleepAfterThisStep};workerCurrentStepIndex=!1,workerOnLoadHandler=!1,suspendAjaxRequestsCallback=!1,this.postMessageToWorker("workerStepResult",h)},registerWorkerOnloadCallback:function(a){if(onLoadHappened){try{callEventCallbacks("onload"),a(!0)}catch(b){this.reportErrorResult(b)}workerOnLoadHandler=!1}else workerOnLoadHandler=a},getWorkerCurrentStepIndex:function(){return workerCurrentStepIndex},setReturnedValueOfStep:function(a){returnedValuesOfSteps[workerCurrentStepIndex+1]=mostRecentReturnedValueOfStep=a,this.onMessage_bubbleRelayMessage({message:"broadcastReturnedValues",values:returnedValuesOfSteps.map(function(a){return"string"==typeof a||"number"==typeof a?a:undefined}),returnedValuesOfStepsAreForTask:returnedValuesOfStepsAreForTask})},registerWorkerSetTimeout:function(a){workerSetTimeoutIds.push(a)},registerWorkerSetInterval:function(a){workerSetIntervalIds.push(a)},updateCurrentUrl:function(a){workerCurrentUrl!==a&&(this.postMessageToWorker("currentUrl",{url:a,currentMainFrameWindow:me.modules.ui.currentMainFrameWindow}),this.onMessage_bubbleRelayMessage({message:"clearCurrentUrl"}),workerCurrentUrl=a)},onMessage_clearCurrentUrl:function(){workerCurrentUrl=!1},haveAccess:function(a){var b=me.modules.ui.mainFrameWindow;(a||[]).filter(function(a){b=b.frames[a]});try{b.location.href}catch(c){return!1}return!0},reflectMessage:function(a,b){return!this.haveAccess(b)||a.hasOwnProperty("currentMainFrameWindow")&&relay.currentMainFrameWindow!==a.currentMainFrameWindow?("invokeWorker"===a.cmd&&(a.globals=workerGlobals),openRelay("about:blank",a),!0):!1},startSlaveMode:function(){for(var a=document.getElementsByTagName("body")[0];a.children.length;)a.removeChild(a.children[0]);var b,c,d=document.createElement("a");try{d.textContent="This tab is used by cartFiller as slave, DO NOT CLOSE IT!, click this message to locate original tab.",d.style.color="red",d.style.display="block",d.style.padding="20px",d.setAttribute("href","#"),d.onclick=function(){relay.parent.postMessage('cartFillerMessage:{"cmd":"locate"}',"*")}}catch(e){}a.appendChild(d);try{d.focus()}catch(e){}if(worker={},window.opener)relay.parent=window.opener;else if(window.parent){relay.parent=window.parent;try{for(b=1;c=window.parent.frames["cartFillerMainFrame-s"+b];b++)if(c===window){relay.currentMainFrameWindow=b,me.modules.ui.mainFrameWindow=window.parent.frames["cartFillerMainFrame-"+b],b>1&&(relay.parent=window.parent.frames["cartFillerMainFrame-s"+(b-1)]);break}}catch(e){}}me.modules.dispatcher.init(!0),relay.parent.postMessage('cartFillerMessage:{"cmd":"register","registerFromSlave":1}',"*"),me.modules.ui.chooseJobFrameWindow=me.modules.ui.workerFrameWindow=relay.parent;try{if(relay.parent===window.opener)for(var f=window.opener;f&&f!==f.opener;f=f.opener)try{if(f.frames["cartFillerMainFrame-0"]){me.modules.ui.mainFrameWindow=f.frames["cartFillerMainFrame-0"];break}}catch(e){}}catch(e){return}return me.modules.ui.mainFrameWindow?(me.modules.dispatcher.registerLoadWatcher(),relay.isSlave=!0,void setInterval(function(){var a=!1;try{me.modules.ui.mainFrameWindow&&me.modules.ui.mainFrameWindow.location&&(a=me.modules.ui.mainFrameWindow.location.href)}catch(b){}a&&me.modules.dispatcher.updateCurrentUrl(a)},100)):void setTimeout(function(){me.uiLaunched||alert("could not find mainFrameWindow in slave mode")},1e4)},registerLoadWatcher:function(){setTimeout(function a(){var b;try{me.modules.ui.mainFrameWindow.document&&"complete"===me.modules.ui.mainFrameWindow.document.readyState&&!me.modules.ui.mainFrameWindow.document.getElementsByTagName("html")[0].getAttribute("data-cartfiller-reload-tracker")&&(me.modules.ui.mainFrameWindow.document.getElementsByTagName("html")[0].setAttribute("data-cartfiller-reload-tracker",0),me.modules.dispatcher.onMainFrameLoaded(!0)),b="undefined"==typeof me.modules.ui.mainFrameWindow.document.title?"":me.modules.ui.mainFrameWindow.document.title}catch(c){}oldTitle!==b&&(oldTitle=b,"undefined"!=typeof b&&(me.modules.dispatcher.onMessage_updateTitle({title:b}),relay.bubbleMessage({message:"updateTitle",title:b}))),setTimeout(a,100)},100)},openRelayOnTheTail:function(a,b){me.modules.dispatcher.onMessage_bubbleRelayMessage({message:"openRelayOnHead",args:[a,b],notToChildren:!0})},registerEventCallback:function(a,b,c){undefined===workerEventListeners[a]&&(workerEventListeners[a]={}),workerEventListeners[a][b]=c},getWorkerTask:function(){return workerCurrentTask},getWorkerGlobals:function(){return workerGlobals},getWorker:function(){return worker},defineSharedWorkerFunction:function(a,b){sharedWorkerFunctions[a]=b},setSleepAfterThisStep:function(a){sleepAfterThisStep=a},drill:function(a){workerCurrentStepIndex=workerOnLoadHandler=suspendAjaxRequestsCallback=!1,currentInvokeWorkerMessage.drillToFrame=this.getFrameToDrill(),currentInvokeWorkerMessage.drillToFrame.push(a),currentInvokeWorkerMessage.message="drill",currentInvokeWorkerMessage.notToChildren=!0,currentInvokeWorkerMessage.notToParents=!1,this.onMessage_bubbleRelayMessage(currentInvokeWorkerMessage)},isDrilling:function(){return"undefined"!=typeof currentInvokeWorkerMessage.drillToFrame},getFrameToDrill:function(){return currentInvokeWorkerMessage.drillToFrame?currentInvokeWorkerMessage.drillToFrame:[]},isSlave:function(){return relay.isSlave},resetRelays:function(){relay.nextRelay=relay.nextRelayRegistered=!1,relay.nextRelayQueue=[],relay.knownUrls={},relay.slaveCounter=0},getSlaveCounter:function(){return relay.slaveCounter},setAdditionalWindows:function(a,b){if(relay.currentMainFrameWindow>0)throw new Error("setAdditionalWindows is only allowed when worker is switched to primary window (0)");relay.isSlave?this.onMessage_bubbleRelayMessage({message:"setAdditionalWindows",descriptors:a,notToChildren:!0,workerCurrentStepIndex:workerCurrentStepIndex,workerCurrentTaskIndex:workerCurrentTaskIndex,nextTaskFlow:nextTaskFlow,sleepAfterThisStep:sleepAfterThisStep,workerGlobals:workerGlobals}):(me.modules.ui.setAdditionalWindows(a),b&&(workerCurrentTaskIndex=b.workerCurrentTaskIndex,workerCurrentStepIndex=b.workerCurrentStepIndex,nextTaskFlow=b.nextTaskFlow,sleepAfterThisStep=b.sleepAfterThisStep,workerGlobals=b.workerGlobals))},switchToWindow:function(a){relay.isSlave?this.onMessage_bubbleRelayMessage({message:"switchToWindow",index:a,notToChildren:!0}):(me.modules.ui.switchToWindow(a),this.postMessageToWorker("switchToWindow",{currentMainFrameWindow:a}))},getFrameWindowIndex:function(){return relay.currentMainFrameWindow}})}.call(this,document,window),function(a,b){"use strict";var c=["dispatcher","ui","api"],d=this,e=function(){for(var a=c.length-1;a>=0;a--){for(var e=!1,f=d.cartFillerConfiguration.scripts.length-1;f>=0;f--)if(d.cartFillerConfiguration.scripts[f].getName()===c[a]){e=!0;break}if(!e)return}b.cartFillerAPI=function(){return d.cartFillerConfiguration.modules.api},d.cartFillerConfiguration.modules={};for(var g=d.cartFillerConfiguration.scripts.length-1;g>=0;g--){var h=d.cartFillerConfiguration.scripts[g];d.cartFillerConfiguration.modules[h.getName()]=h}d.cartFillerConfiguration.launch()};if(this.cartFillerConfiguration.scripts.push=function(a){Array.prototype.push.call(this,a),e()},!this.cartFillerConfiguration.concatenated)for(var f=a.getElementsByTagName("head")[0],g=c.length-1;g>=0;g--){var h=a.createElement("script");h.setAttribute("src",this.cartFillerConfiguration.baseUrl+"/boot/helpers/"+c[g]+".js"),f.appendChild(h)}}.call(this,document,window),function(a,b,c){"use strict";var d=this.cartFillerConfiguration,e="cartFillerOverlayDiv",f="cartFillerMainFrame",g="cartFillerWorkerFrame",h="cartFillerChooseJobFrame",i=!1,j=[],k={},l={},m="",n={},o="",p=!1,q="",r=0,s=!1,t=0,u=!1,v="big",w=!1,x=!1,y=function(){return d.modules.ui.mainFrameWindow},z=function(){return"rgba(255,0,0,0.3)"},A=function(a){var b=y().document.createElement("div");b.style.position="fixed",b.style.backgroundColor=z(),b.style.zIndex=Y(),b.className=e+" "+e+a,b.onclick=function(){d.modules.ui.clearOverlaysAndReflect()};var c=y().document.getElementsByTagName("body")[0];return c&&c.appendChild(b),b},B=function(a){for(var b=y().document.getElementsByClassName(e+(a?a:"")),c=b.length-1;c>=0;c--)b[c].parentNode.removeChild(b[c]);for(b=y().document.getElementsByClassName(e+" "+e+(a?a:"")),c=b.length-1;c>=0;c--)b[c].parentNode.removeChild(b[c])},C=function(a,b,c,d){var e=A(a);e.style.left=b+"px",e.style.top=c+"px",e.style.width="20px",e.style.height=d+"px"},D=function(a,b,c,d){var e=A(a);e.style.left=b+"px",e.style.top=c+"px",e.style.width=d+"px",e.style.height="20px"},E=function(a,b,c){var d=A(a);d.style.left=b+"px",d.style.top=c-25+"px",d.style.width=d.style.height="0px",d.style.backgroundColor="transparent",d.style.borderTop=d.style.borderBottom="25px solid transparent",d.style.borderLeft="30px solid rgba(255,0,0,0.3)"},F=function(a,b,c){var d=A(a);d.style.left=b-25+"px",d.style.top=c+"px",d.style.width=d.style.height="0px",d.style.backgroundColor="transparent",d.style.borderLeft=d.style.borderRight="25px solid transparent",d.style.borderTop="30px solid rgba(255,0,0,0.3)"},G=function(a,b,c){var d=A(a);d.style.left=b-25+"px",d.style.top=c+"px",d.style.width=d.style.height="0px",d.style.backgroundColor="transparent",d.style.borderLeft=d.style.borderRight="25px solid transparent",d.style.borderBottom="30px solid rgba(255,0,0,0.3)"},H=function(a){var b,c,d,e,f,g,h,i={};if(!(a instanceof Array)){var j=[];for(b in a)j.push(a[b]);a=j}for(b=a.length-1;b>=0;b--)if(g=a[b],g&&g.element){h=g.element.getBoundingClientRect();var k=0,l=0;if("iframe"===g.type)try{var m=g.element.ownerDocument.defaultView.getComputedStyle(g.element);l=parseInt(m.borderTopWidth.replace(/[^0-9]/g,"")),k=parseInt(m.borderLeftWidth.replace(/[^0-9]/g,""))}catch(n){}h.width>0||h.height>0||h.left>0||h.top>0?(c=Math.round(h.top-5),d=Math.round(h.left-5),f=Math.round(h.height+9),e=Math.round(h.width+9),(c!==g.top||d!==g.left||f!==g.height||e!==g.width)&&(i.any=!0,g.type&&(i[g.type]=!0),g.top=c,g.left=d,g.height=f,g.width=e,g.right=d+e,g.bottom=c+f,g.self={top:h.top+l,left:h.left+k,right:h.right+k,bottom:h.bottom+l,width:h.width,height:h.height})):(i.any=!0,g.type&&(i[g.type]=!0),g.deleted=!0,g.element=null)}return i},I=function(a){if(!a.path||!a.path.length)return a;for(var b={left:a.rect.left,top:a.rect.top,width:a.rect.width,height:a.rect.height,originalElement:a},c=a.path.length-1;c>=0;c--){var d=a.path.slice(0,c+1).join("/"),e=l[d];e&&(b.left+=e.rect.left,b.top+=e.rect.top)}return{rect:b}},J=0,K=function(){var a,c,e=function(b){b.scroll&&b.ts>J&&(b.ts>c||!c)&&(a=b,c=b.ts)},f=function(a){return a.currentMainFrameWindow===d.modules.dispatcher.getFrameWindowIndex()};for(var g in k)k[g].filter(f).filter(e);if(a){if(J=c,b.callPhantom&&b.callPhantom instanceof Function){var h=I(a);b.callPhantom({scroll:h})}else{for(var i=.25,j=[a.rect.left-P()*i,a.rect.top-O()*i],l=0;2>l;l++)j[l]<0||(j[l]=Math.min(j[l],Math.max(0,a.rect[l?"bottom":"right"]-(l?O():P())*(1-i))));d.modules.ui.mainFrameWindow.addEventListener("scroll",S),d.modules.ui.mainFrameWindow.scrollBy(j[0],j[1])}return!0}},L=function(){K(),B("arrow");for(var a in k)M(k[a])},M=function(a){var b,c,e;a.filter(function(a){return"arrow"===a.type&&!a.deleted}).filter(function(a){return a.currentMainFrameWindow===d.modules.dispatcher.getFrameWindowIndex()}).map(I).filter(function(a,d){var f=A("arrow");f.style.backgroundColor="transparent",f.style.borderLeft=f.style.borderTop=f.style.borderRight=f.style.borderBottom="5px solid rgba(255,0,0,0.3)",f.style.left=a.rect.left+"px",f.style.top=a.rect.top+"px",f.style.width=a.rect.width+"px",f.style.height=a.rect.height+"px",f.style.boxSizing="border-box",a.rect.left>40?(b=a.rect.top+Math.round(a.rect.height/2),C("arrow",0,0,b-10),D("arrow",0,b-10,a.rect.left-30),E("arrow",a.rect.left-30,b)):a.rect.top>40?(c=a.rect.left+Math.min(30+30*d,Math.round(a.rect.width/2)),D("arrow",0,0,c-10),C("arrow",c-10,0,a.rect.top-30),F("arrow",c,a.rect.top-30)):(c=a.rect.left+Math.min(30,Math.round(a.rect.width/2)),e=a.rect.top+a.rect.height,D("arrow",0,e+60,c+10),C("arrow",c-10,e+30,30),G("arrow",c,e))})},N=function(a){var b,e,f,g,h=function(b){return("undefined"==typeof a||a[b.type])&&!b.deleted},i=function(a){b=c===b?a.rect.left:Math.min(b,a.rect.left),f=c===f?a.rect.left+a.rect.width:Math.max(f,a.rect.left+a.rect.width),e=c===e?a.rect.top:Math.min(e,a.rect.top),g=c===g?a.rect.top+a.rect.height:Math.max(g,a.rect.top+a.rect.height)},j=function(a){return a.currentMainFrameWindow===d.modules.dispatcher.getFrameWindowIndex()};for(var l in k)k[l].filter(h).filter(j).map(I).filter(i);return{left:b,right:f,top:e,bottom:g}},O=function(){return d.modules.ui.mainFrameWindow.innerHeight},P=function(){return d.modules.ui.mainFrameWindow.innerWidth},Q=function(){K(),B("highlight");var a=N({highlight:!0});if(a.left!==c){var b=O(),d=P(),e=5;W(0,0,Math.max(0,a.left-e),b),W(Math.min(d,a.right+e),0,d,b),W(Math.max(0,a.left-e),0,Math.min(d,a.right+e),Math.min(b,a.top-e)),W(Math.max(0,a.left-e),Math.max(0,a.bottom+e),Math.min(d,a.right+e),b)}},R=function(){B("message");var a=N({highlight:!0,arrow:!0});if(a.left===c&&(a={top:0,bottom:0,left:0,right:0}),"string"==typeof m&&m.length>0||"string"!=typeof m&&c!==m&&null!==m&&!isNaN(m)){var b=y().document.createElement("div");b.style.display="block",b.style.backgroundColor="#fff",b.style.padding="10px",b.style.fontSize="20px;",b.style.zIndex=Y()+1,b.style.border="#bbb solid 10px",b.style.borderRadius="20px",b.style.overflow="auto",b.style.opacity="0",b.style.top=Math.min(O()-100,a.bottom+5-t)+"px",b.style.left=Math.max(0,Math.round((a.left+a.right)/2)-s)+"px",b.style.width=s+"px",b.style.height="auto",b.style.maxHeight="100%",b.style.position="fixed",b.style.fontSize="20px",b.className=e+" "+e+"message";var f=y().document.createElement(p?"pre":"div");b.appendChild(f),p?f.textContent=m:m.split("\n").filter(function(a,b){if(b){var c=y().document.createElement("br");f.appendChild(c)}var d=y().document.createElement("span");d.textContent=a,f.appendChild(d)}),f.style.backgroundColor="#fff",f.style.border="none",f.onclick=function(a){return a.stopPropagation(),!1};var g=y().document.createElement("button");b.appendChild(g),g.textContent=n.nextButton||"Close",g.style.borderRadius="4px",g.style.fontSize="14px",g.style["float"]="right",n.nextButton&&(d.modules.dispatcher.running===!0?setTimeout(function(){d.modules.ui.clearOverlaysAndReflect()},0):g.onclick=function(a){return a.stopPropagation(),d.modules.ui.clearOverlaysAndReflect(),!1}),b.onclick=function(){d.modules.ui.clearOverlaysAndReflect()},y().document.getElementsByTagName("body")[0].appendChild(b),r=100,d.modules.ui.adjustMessageDiv(b)}q=m},S=function(){var a=function(a){var b=function(a){var b="iframe"===a.type?a.self:a;return{rect:{left:b.left,top:b.top,width:b.width,height:b.height,right:b.right,bottom:b.bottom,url:a.element?a.element.ownerDocument.defaultView.location.href:!1},type:a.type,path:a.path,scroll:a.scroll,ts:a.ts,deleted:a.deleted,currentMainFrameWindow:a.currentMainFrameWindow}},c={};return j.filter(function(b){return a[b.type]}).filter(function(a){return c[a.path.join("/")]=[],!0}).map(b).filter(function(a){a.discard||c[a.path.join("/")].push(a)}),c};try{var b=H(j),c=q!==m;if(b.arrow||b.highlight||c||b.iframe){var e={elementsByPath:a({arrow:b.arrow,highlight:b.highlight}),rebuild:b,iframesByPath:{}};c&&(e.messageToSay=m,e.rebuild.message=!0),b.iframe&&(e.iframesByPath=a({iframe:!0})),d.modules.ui.drawOverlaysAndReflect(e)}}catch(f){}},T={width:!1,height:!1,outerWidth:!1,outerHeight:!1,workerFrameSize:!1},U=function(a){var c=b.innerWidth,e=b.innerHeight,f=u?!1:b.outerWidth,g=u?!1:b.outerHeight;if(d.modules.ui.mainFrameWindow&&d.modules.ui.mainFrameWindow.location){var h=!1;try{h=d.modules.ui.mainFrameWindow.location.href}catch(i){}h&&d.modules.dispatcher.updateCurrentUrl(h)}(T.width!==c||T.height!==e||T.outerWidth!==f||T.outerHeight!==g||T.workerFrameSize!==v||a)&&(!function(){var a=.8*c-1,b=.2*c-1,h=.8*c-1,i=.2*c-1,j=40,k=Math.floor((e-15-(u?(d.modules.ui.mainFrames.length-1)*j:0))/(u?d.modules.ui.mainFrames.length:1)),l=k+j,m=e-15,n=.02*c+(u?0:200),o=.76*c-(u?0:200),p=.02*e,q=.96*e;u&&d.modules.ui.mainFrames.filter(function(a,b){a.style.height=k+"px",b>0&&(d.modules.ui.slaveFrames[b].style.height=j+"px")});try{d.modules.ui.workerFrame.style.height=m+"px"}catch(r){}try{d.modules.ui.chooseJobFrame.style.height=q+"px",d.modules.ui.chooseJobFrame.style.top=p+"px",d.modules.ui.chooseJobFrame.style.left=n+"px",d.modules.ui.chooseJobFrame.style.width=o+"px"}catch(r){}if(u&&d.modules.ui.mainFrames.filter(function(a,b){try{a.style.top=l*b+"px",b>0&&(d.modules.ui.slaveFrames[b].style.top=l*b-j+"px")}catch(c){}}),"big"===v)if(u){try{d.modules.ui.workerFrame.style.width=h+"px",d.modules.ui.workerFrame.style.left=b+"px"}catch(r){}d.modules.ui.mainFrames.filter(function(a,c){try{a.style.width=b+"px",c>0&&(d.modules.ui.slaveFrames[c].style.width=b+"px")}catch(e){}})}else{try{d.modules.ui.mainFrameWindow.resizeTo(1,1)}catch(r){}try{d.modules.ui.workerFrame.style.width=h+"px",d.modules.ui.workerFrame.style.left=c-h-5+"px"}catch(r){}}else if("small"===v)if(u){try{d.modules.ui.workerFrame.style.width=i+"px",d.modules.ui.workerFrame.style.left=a+"px"}catch(r){}d.modules.ui.mainFrames.filter(function(b,c){try{b.style.width=a+"px",c>0&&(d.modules.ui.slaveFrames[c].style.width=a+"px")}catch(e){}})}else{try{d.modules.ui.mainFrameWindow.resizeTo(Math.round(.8*f-10),Math.round(g))}catch(r){}try{d.modules.ui.workerFrame.style.width=i+"px",d.modules.ui.workerFrame.style.left=c-i-5+"px"}catch(r){}}}(),T.width=c,T.height=e,T.outerWidth=f,T.outerHeight=g,T.workerFrameSize=v)},V=function(){return d.modules.ui.mainFrameWindow.document},W=function(a,b,c,f){a=Math.round(a),b=Math.round(b),c=Math.round(c),f=Math.round(f);var g=V().createElement("div");g.style.position="fixed",g.style.left=a+"px",g.style.top=b+"px",g.style.width=c-a+"px",g.style.height=f-b+"px",g.style.backgroundColor="rgba(0,0,0,0.3)",g.style.zIndex=Y(),g.className=e+" "+e+"highlight",g.onclick=function(){d.modules.ui.clearOverlaysAndReflect()},V().getElementsByTagName("body")[0].appendChild(g)},X=function(){return d["data-wfu"]?d["data-wfu"]:d.baseUrl+"/index"+(d.concatenated?"":/\/src$/.test(d.baseUrl)?"":".uncompressed")+".html"+(d.gruntBuildTimeStamp?"?"+d.gruntBuildTimeStamp:"")},Y=function(){return 1e8};setInterval(S,200);var Z=function(a,b){if(b=b||[],a===d.modules.ui.mainFrameWindow)return b;for(var c=a.parent,e=0;e<c.frames.length&&a!==c.frames[e];e++);b.unshift(e),Z(c,b);try{c.location.href;var f=c.document.getElementsByTagName("iframe");for(e=f.length-1;e>=0;e--)f[e].contentWindow===a&&d.modules.ui.addElementToTrack("iframe",f[e],!0,[e])}catch(g){}return b},$=function(a){if(a=a||0,d.modules.ui.currentMainFrameWindow=a,d.modules.ui.mainFrameWindow=d.modules.ui.mainFrameWindows[0],u)if(d.modules.ui.mainFrames&&d.modules.ui.mainFrames.length>1)for(var b=d.modules.ui.mainFrames.length-1;b>=0;b--){var c=d.modules.ui.mainFrames[b];c.style.borderWidth="5px",c.style.borderColor=b===a?"red":"transparent"}else d.modules.ui.mainFrames[0].style.borderWidth="0px"};d.scripts.push({getName:function(){return"ui"},setSize:function(){},showHideChooseJobFrame:function(a){a&&!i&&(0===d["data-choose-job"].indexOf("#")&&d.localIndexHtml?this.chooseJobFrameWindow.document.write(d.localIndexHtml.replace(/data-local-href=""/,'data-local-href="'+d["data-choose-job"]+'"')):this.chooseJobFrameWindow.location.href=d["data-choose-job"],i=!0),this.chooseJobFrame.style.display=a?"block":"none"},closePopup:function(){},focusMainFrameWindow:function(){},highlight:function(a,b){x&&this.clearOverlaysAndReflect(!0),m="";var e,f=!1;if(null!==a&&"object"==typeof a&&"string"==typeof a.jquery&&c!==a.length&&"function"==typeof a.each)a.each(function(a,c){return d.modules.ui.addElementToTrack("highlight",c),f=!0,b?void 0:!1});else if(a instanceof Array)for(e=a.length-1;e>=0&&(this.addElementToTrack("highlight",a[e]),f=!0,!0===b);e--);else c!==a&&(this.addElementToTrack("highlight",a),f=!0);if(f>0&&d.modules.dispatcher.haveAccess()){var g=this.mainFrameWindow.document.getElementsByTagName("body")[0];g.style.paddingBottom=O()+"px"}},arrowTo:function(a,b,e){if(x&&this.clearOverlaysAndReflect(!0),null!==a&&"object"==typeof a&&"string"==typeof a.jquery&&c!==a.length&&"function"==typeof a.each)a.each(function(a,c){return d.modules.ui.addElementToTrack("arrow",c,e),b?void(e=!0):!1});else if(a instanceof Array)for(var f=0;f<a.length&&(this.addElementToTrack("arrow",a[f],e),b);f++)e=!0;else c!==a&&this.addElementToTrack("arrow",a,e)},say:function(a,b,d){m=c===a||null===a?"":a,n.nextButton=d,p=b,s=Math.max(100,Math.round(.5*P())),t=0,r=100},adjustMessageDiv:function(a){var b=this;setTimeout(function d(){var e=!0;if(r>0){if(!a.parentNode)return void setTimeout(d,100);e=!1;var f=a.getBoundingClientRect();f.bottom>b.mainFrameWindow.innerHeight?f.width>.95*b.mainFrameWindow.innerWidth?t+=Math.min(f.top,f.bottom-b.mainFrameWindow.innerHeight):s=Math.min(b.mainFrameWindow.innerWidth,parseInt(a.style.width.replace("px",""))+Math.round(.4*b.mainFrameWindow.innerWidth)):e=!0,e?(a.style.opacity="1",r=0,q=m):(r--,q=c)}else a.style.opacity="1"},0)},popup:function(a,b){d.modules.dispatcher.init(),this.mainFrameWindows=[b.open(b.location.href,"_blank","resizable=1, height=1, width=1, scrollbars=1")],$(),this.mainFrameWindow=this.mainFrameWindows[0],this.closePopup=function(){this.mainFrameWindow.close()},this.focusMainFrameWindow=function(){this.mainFrameWindow.focus()},d.modules.dispatcher.registerLoadWatcher();for(var e=b.document.getElementsByTagName("body")[0];e.children.length;)e.removeChild(e.children[0]);this.setSize=function(a){c===a&&(a="big"===v?"small":"big"),v=a,U(),"small"===a&&this.mainFrameWindow.focus()},this.workerFrame=b.document.createElement("iframe"),this.workerFrame.setAttribute("name",g),this.workerFrame.style.position="fixed",this.workerFrame.style.top="0px",this.workerFrame.style.height="100%",this.workerFrame.style.zIndex="100000",e.appendChild(this.workerFrame),this.workerFrameWindow=b.frames[g],d.localIndexHtml?this.workerFrameWindow.document.write(d.localIndexHtml):this.workerFrameWindow.location.href=X(),this.chooseJobFrame=b.document.createElement("iframe"),this.chooseJobFrame.setAttribute("name",h),this.chooseJobFrame.style.position="fixed",this.chooseJobFrame.style.height="0px",this.chooseJobFrame.style.top="0px",this.chooseJobFrame.style.left="0px",this.chooseJobFrame.style.width="0px",this.chooseJobFrame.style.zIndex="10000002",this.chooseJobFrame.style.background="white",e.appendChild(this.chooseJobFrame),this.chooseJobFrameWindow=b.frames[h],this.setSize("big"),setInterval(U,2e3)},framed:function(a,b){u=!0,d.modules.dispatcher.init();for(var e=a.getElementsByTagName("body")[0],i=b.location.href;e.children.length;)e.removeChild(e.children[0]);this.mainFrames=[a.createElement("iframe")],this.mainFrames[0].setAttribute("name",f+"-0"),this.mainFrames[0].style.height="0px",this.mainFrames[0].style.position="fixed",this.mainFrames[0].style.left="0px",this.mainFrames[0].style.top="0px",this.mainFrames[0].style.borderWidth="0px",this.slaveFrames=[c],this.workerFrame=a.createElement("iframe"),this.workerFrame.setAttribute("name",g),this.workerFrame.style.height="0px",this.workerFrame.style.position="fixed",this.workerFrame.style.top="0px",this.chooseJobFrame=a.createElement("iframe"),this.chooseJobFrame.setAttribute("name",h),this.chooseJobFrame.style.display="none",this.chooseJobFrame.style.height="0px",this.chooseJobFrame.style.top="0px",this.chooseJobFrame.style.left="0px",this.chooseJobFrame.style.width="0px",this.chooseJobFrame.style.position="fixed",this.chooseJobFrame.style.background="white",this.chooseJobFrame.style.zIndex="10000002",e.appendChild(this.mainFrames[0]),this.mainFrameWindows=[b.frames[f+"-0"]],$(),d.modules.dispatcher.registerLoadWatcher(),this.mainFrameWindow.location.href=i,e.appendChild(this.workerFrame),this.workerFrameWindow=b.frames[g],d.localIndexHtml?this.workerFrameWindow.document.write(d.localIndexHtml):this.workerFrameWindow.location.href=X(),e.appendChild(this.chooseJobFrame),this.chooseJobFrameWindow=b.frames[h],this.setSize=function(a){c===a&&(a="big"===v?"small":"big"),v=a,U()},this.setSize("small"),setInterval(U,2e3)},refreshPage:function(){this.mainFrameWindow.location.reload()},reportingMousePointerClick:function(a,c){var e=b.document.elementFromPoint(a,c);if(e){var f=/^cartFillerMainFrame-(\d+)$/.exec(e.getAttribute("name"));if(f){var g=parseInt(f[1]);if(g!==d.modules.dispatcher.getFrameWindowIndex()){var h=e.getBoundingClientRect();d.modules.dispatcher.onMessage_bubbleRelayMessage({message:"reportingMousePointerClickForWindow",currentMainFrameWindow:g,x:a-h.left,y:c-h.top})}else this.reportingMousePointerClickForWindow(a,c);return}}d.modules.dispatcher.postMessageToWorker("mousePointer",{x:a,y:c,stack:[],w:d.modules.dispatcher.getFrameWindowIndex()})},reportingMousePointerClickForWindow:function(b,e){for(var f,g,h,i=[],j=d.modules.ui.mainFrameWindow.document.elementFromPoint(b,e);j&&"BODY"!==j.nodeName&&"HTML"!==j.nodeName&&j!==a;){var k=[];for(g=j.attributes.length-1;g>=0;g--)h=j.attributes[g].name,"id"!==h&&"class"!==h&&k.push({n:h,v:j.attributes[g].value});for(f=j,g=0;f;f=f.previousElementSibling)f.nodeName===j.nodeName&&g++;i.unshift({element:j.nodeName.toLowerCase(),attrs:k,classes:"string"==typeof j.className?j.className.split(" ").filter(function(a){return a}):[],id:"string"==typeof j.id?j.id:c,index:g,text:String(j.textContent).length<200?String(j.textContent):""}),j=j.parentNode}d.modules.dispatcher.postMessageToWorker("mousePointer",{x:b,y:e,stack:i,w:d.modules.dispatcher.getFrameWindowIndex()})},startReportingMousePointer:function(){try{d.modules.ui.clearOverlaysAndReflect()}catch(c){}if(!w){var e=a.createElement("div");

e.style.height=b.innerHeight+"px",e.style.width=b.innerWidth+"px",e.zindex=1e3,e.style.position="absolute",e.style.left="0px",e.style.top="0px",e.style.backgroundColor="transparent",a.getElementsByTagName("body")[0].appendChild(e),w=e;var f,g;e.addEventListener("mousemove",function(a){f=a.clientX,g=a.clientY},!1),e.addEventListener("click",function(){a.getElementsByTagName("body")[0].removeChild(w),w=!1,d.modules.dispatcher.reflectMessage({cmd:"reportingMousePointerClick",x:f,y:g})||d.modules.ui.reportingMousePointerClick(f,g)})}},preventPageReload:function(){setInterval(function(){b.onbeforeunload=function(){return setTimeout(function(){d.modules.ui.mainFrameWindow.location.reload()},0),"This will cause CartFiller to reload. Choose not to reload if you want just to refresh the main frame."}},2e3)},getMessageToSay:function(){return m},highlightElementForQueryBuilder:function(a){if(this.clearOverlays(),a){for(var b=this.mainFrameWindow.document.getElementsByTagName("body")[0],c=0;c<a.length;c++){for(var d=a[c][0],e=b.children.length,f=0;e>f;f++)if(b.children[f].nodeName.toLowerCase()===d){if(!a[c][1]){b=b.children[f],d=!1;break}a[c][1]--}if(d)return}this.arrowTo(b,!1,!0)}},prepareTolearOverlaysAndReflect:function(){d.modules.dispatcher.onMessage_bubbleRelayMessage({message:"prepareToClearOverlays"})},prepareToClearOverlays:function(){x=!0,m="",d.modules.dispatcher.haveAccess()&&R()},clearOverlaysAndReflect:function(a){!a&&n.nextButton&&(d.modules.api.result(),n.nextButton=!1),d.modules.dispatcher.onMessage_bubbleRelayMessage({message:"clearOverlays"})},clearOverlays:function(){x=!1,j=[],k={},m="",d.modules.dispatcher.haveAccess()&&(L(),Q(),R())},drawOverlays:function(a){var b,c=!1;for(b in a.iframesByPath)l[b]=a.iframesByPath[b][0],c=!0;for(b in a.elementsByPath)k[b]=a.elementsByPath[b];d.modules.dispatcher.haveAccess()&&((a.rebuild.arrow||c)&&L(),(a.rebuild.highlight||c)&&Q(),(a.rebuild.message||c)&&(o=a.messageToSay,R()))},drawOverlaysAndReflect:function(a){a.message="drawOverlays",d.modules.dispatcher.onMessage_bubbleRelayMessage(a)},tellWhatYouHaveToDraw:function(){S()},addElementToTrack:function(a,b,c,e){j.push({element:b,type:a,scroll:!c,path:Z(b.ownerDocument.defaultView,e),ts:(new Date).getTime(),currentMainFrameWindow:d.modules.dispatcher.getFrameWindowIndex()}),c||b.scrollIntoView()},getMainFrameWindowDocument:function(){var a;try{a=d.modules.ui.mainFrameWindow.document}catch(b){}return a},setAdditionalWindows:function(c){if(!u)throw new Error("this function is only availabled in framed mode");for(var e=this.mainFrames.length-1;e>=1;e--)this.mainFrames[e].parentNode.removeChild(this.mainFrames[e]),this.slaveFrames[e].parentNode.removeChild(this.slaveFrames[e]);this.mainFrames.splice(1),this.slaveFrames.splice(1),this.mainFrameWindows.splice(1),d.modules.dispatcher.resetRelays();var g=a.getElementsByTagName("body")[0],h=-1,i=function(){return d.modules.dispatcher.getSlaveCounter()===h+1},j=function(a){a?(h++,h===c.length?d.modules.api.result():(b.frames[f+"-s"+(h+1)].location.href=c[h].slave+"#launchSlaveInFrame",d.modules.api.waitFor(i,j))):d.modules.api.result("Unable to load slave")};for(e=1;e<=c.length;e++){var k=a.createElement("iframe");k.setAttribute("name",f+"-"+e),k.style.height="0px",k.style.position="fixed",k.style.left="0px",k.style.top="0px",k.style.borderWidth="0px",this.mainFrames[e]=k,g.appendChild(k),this.mainFrameWindows[e]=b.frames[f+"-"+e],this.mainFrameWindows[e].location.href=c[e-1].url;var l=a.createElement("iframe");l.setAttribute("name",f+"-s"+e),l.style.height="0px",l.style.position="fixed",l.style.left="0px",l.style.top="0px",l.style.borderWidth="1px",l.style.borderColor="#ccc",this.slaveFrames[e]=l,g.appendChild(l)}$(),U(!0),j(!0)},switchToWindow:function(a){$(a)}})}.call(this,document,window)}).call({cartFillerConfiguration:{},cartFillerEval:this.cartFillerEval});