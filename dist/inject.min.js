/*
 *  cartFiller - v0.0.1
 *  Tool for automating cart filling process when doing big purchases
 *  https://andrey012.github.com/cartFiller
 *
 *  Made by Andrey Grinenko
 *  Under MIT License
 */
(function(){(function(a,b){"use strict";var c,d="undefined"!=typeof this.cartFillerConfiguration,e="undefined"!=typeof this.cartFillerEval;if(e&&!d?(b.cartFillerConfiguration={},c=b.cartFillerConfiguration):(this.cartFillerConfiguration={},c=this.cartFillerConfiguration),c.concatenated=d,c.localIndexHtml="",c.localInjectJs="",c.scripts=[],c.uiLaunched=!1,c.launch=function(d){console.log(""),a.getElementsByTagName("body")[0].getAttribute("data-old-cartfiller-version-detected")||(!d&&b.opener&&b.opener!==b?this.modules.dispatcher.startSlaveMode():c.uiLaunched||(c.uiLaunched=!0,"0"===String(c["data-type"])?this.modules.ui.framed(a,b):"1"===String(c["data-type"])?this.modules.ui.popup(a,b):alert("Type not specified, should be 0 for framed, 1 for popup")))},c.baseUrl="",c["data-type"]=0,c["data-choose-job"]="",c["data-debug"]=!1,c["data-worker"]="",c.gruntBuildTimeStamp="1462524834291",e)c.baseUrl=this.cartFillerEval[0],c["data-type"]=this.cartFillerEval[1],c["data-choose-job"]=this.cartFillerEval[2],c["data-debug"]=this.cartFillerEval[3],c["data-worker"]=this.cartFillerEval[4],c["data-wfu"]=this.cartFillerEval[5],c.localInjectJs=this.cartFillerEval[6];else{var f,g=a.getElementsByTagName("head")[0].getElementsByTagName("script");for(f=0;f<g.length;f++){var h=g[f];if(null!==h.getAttribute("data-type")&&null!==h.getAttribute("data-base-url")&&null!==h.getAttribute("data-choose-job")){for(var i=h.attributes,j=i.length-1;j>=0;j--)/^data-/.test(i[j].name)&&("data-base-url"===i[j].name?c.baseUrl=i[j].value:c[i[j].name]=i[j].value);break}}}if(!d){var k=a.createElement("script");k.setAttribute("src",c.baseUrl+"/boot/helpers/loader.js"),a.getElementsByTagName("head")[0].appendChild(k)}}).call(this,document,window),function(a,b,c){"use strict";var d=this.cartFillerConfiguration;d.scripts.push({getName:function(){return"api"},registerWorker:function(a){return d.modules.dispatcher.registerWorker(a),this},result:function(a,b,c){return d.modules.dispatcher.submitWorkerResult(a,b,c),this},skipTask:function(){return d.modules.dispatcher.manageTaskFlow("skipTask"),this},repeatTask:function(){return d.modules.dispatcher.manageTaskFlow("repeatTask"),this},repeatStep:function(){return d.modules.dispatcher.manageTaskFlow("repeatStep"),this},nop:function(){return d.modules.dispatcher.submitWorkerResult("","nop"),this},onload:function(a){return c===a&&(a=function(){d.modules.api.result()}),d.modules.dispatcher.registerWorkerOnloadCallback(a),this},waitFor:function(a,b,e,f){c===e&&(e=2e4),c===f&&(f=200);var g=Math.round(e/f);b||(b=""),"string"==typeof b&&(b=function(a){return function(b){d.modules.api.result(b?"":a.length?a:"timeout")}}(b));var h=function(){var c;try{c=a()}catch(e){return void d.modules.dispatcher.reportErrorResult(e)}if(!1!==d.modules.dispatcher.getWorkerCurrentStepIndex())if(c)try{b(c)}catch(e){return void d.modules.dispatcher.reportErrorResult(e)}else if(g--,g>0)d.modules.api.setTimeout(h,f);else try{b(!1)}catch(e){return void d.modules.dispatcher.reportErrorResult(e)}};return d.modules.api.setTimeout(h,f),this},highlight:function(a,b){try{d.modules.ui.highlight(a,b),d.modules.dispatcher.setHighlightedElement(a)}catch(c){}return this},arrow:function(a,b){try{d.modules.ui.arrowTo(a,b),d.modules.dispatcher.setHighlightedElement(a)}catch(c){}return this},say:function(a,b){return d.modules.ui.say(a,b),this},each:function(a,b,d){var e,f=!1;if(a instanceof Array||a.constructor&&("HTMLCollection"===a.constructor.name||"[object HTMLCollection]"===String(a.constructor)||"NodeListConstructor"===a.constructor.name||"[object NodeListConstructor]"===String(a.constructor))||"[object NodeList]"===String(a)){for(e=0;e<a.length;e++)if(!1===b(e,a[e])){f=!0;break}}else if(null!==a&&"object"==typeof a&&"string"==typeof a.jquery&&c!==a.length&&"function"==typeof a.each)a.each(function(a,c){var d=b(a,c);return!1===d&&(f=!0),d});else for(e in a)if(a.hasOwnProperty(e)&&!1===b(e,a[e])){f=!0;break}!f&&d instanceof Function&&d()},map:function(a,b,e){var f=[];f.map=function(a,b){return d.modules.api.map(f,a,b)};var g=function(a){f.push(a)},h=function(a){f.unshift(a)};return d.modules.api.each(a,function(a,c){return b(a,c,g,h)},e?function(){return e(g,h)}:c),f},compare:function(a,b){if(a=String(a),b=String(b),a===b)return"";for(var c="[",d=0;d<Math.max(a.length,b.length);d++){if(a.substr(d,1)!==b.substr(d,1)){c+="] <<< expected: ["+a.substr(d)+"], have: ["+b.substr(d)+"]";break}c+=a.substr(d,1)}return c},setTimeout:function(a,b){d.modules.dispatcher.registerWorkerSetTimeout(setTimeout(d.modules.api.applier(a),b))},setInterval:function(a,b){d.modules.dispatcher.registerWorkerSetInterval(setInterval(d.modules.api.applier(a),b))},click:function(a){return["click",function(b,e){"object"==typeof b&&"string"==typeof b.jquery&&c!==b.length?b[0].click():b instanceof Array?b[0].click():b.click(),c===a||a===d.modules.api.result?d.modules.api.result():a===d.modules.api.onload?d.modules.api.onload():a(b,e)}]},openRelay:function(a,b){return d.modules.dispatcher.openRelayOnTheTail(a,b),this},registerOnloadCallback:function(a,b){return d.modules.dispatcher.registerEventCallback("onload",b?a:"",b?b:a),this},type:function(a,b,e){var f=["type key sequence",function(f,g){var h;h="object"==typeof f&&"string"==typeof f.jquery&&c!==f.length?f[0]:f instanceof Array?f[0]:f,h.focus();var i;if(a instanceof Function)i=a();else if(c!==d.modules.dispatcher.getWorkerTask()[a])i=d.modules.dispatcher.getWorkerTask()[a];else{if(c===d.modules.dispatcher.getWorkerGlobals()[a])return void d.modules.api.result("Value to type ["+a+"] not found neither in the task properties nor in globals");i=d.modules.dispatcher.getWorkerGlobals()[a]}if(i=String(i),!e)try{h.value=""}catch(j){}var k=d.modules.ui.mainFrameWindow.document,l=function(a,b,e){var h,i=a.substr(0,1),j=i.charCodeAt(0),m=a.substr(1),n={get:function(){return j}},o={get:function(){return!1}},p=!0;for(var q in{keydown:0,keypress:0,input:0,keyup:0})if(("keypress"!==q||p)&&(i.length||"keypress"!==q)){var r=!1;if("input"===q){try{r=new Event("input")}catch(r){}if(!r)try{r=k.createEvent("UIEvent"),r.initUIEvent("input")}catch(r){}if(!r)continue}else{if(r=k.createEvent("KeyboardEvent"),Object.defineProperty(r,"keyCode",n),Object.defineProperty(r,"charCode",n),Object.defineProperty(r,"metaKey",o),Object.defineProperty(r,"which",n),r.initKeyboardEvent?r.initKeyboardEvent(q,!0,!0,k.defaultView,!1,!1,!1,!1,j,j):r.initKeyEvent(q,!0,!0,k.defaultView,!1,!1,!1,!1,j,j),r.keyCode!==j||r.charCode!==j)return d.modules.api.result("could not set correct keyCode or charCode for "+q+": keyCode returns ["+r.keyCode+"] , charCode returns ["+r.charCode+"] instead of ["+j+"]"),!1;if(r.metaKey)return d.modules.api.result("could not set metaKey to false"),!1}h=b.dispatchEvent(r),h||"keydown"!==q||(p=!1),h&&"keypress"===q&&(b.value=b.value+i)}if(0===m.length){var s=new Event("change");b.dispatchEvent(s),d.modules.api.arrow(f),c===e||e===d.modules.api.result?d.modules.api.result():e===d.modules.api.onload?d.modules.api.onload():e(f,g)}else d.modules.api.setTimeout(function(){l(m,b,e)},0)};l(i,h,b)}];return f[1].cartFillerParameterList=[a],f},apply:function(a){try{for(var b=[],c=1;c<arguments.length;c++)b.push(arguments[c]);a.apply(d.modules.dispatcher.getWorker(),b)}catch(e){throw d.modules.dispatcher.reportErrorResult(e),e}},applier:function(a){return function(){for(var b=[a],c=0;c<arguments.length;c++)b.push(arguments[c]);d.modules.api.apply.apply(d.modules.api,b)}},define:function(a,b){if(a instanceof Function){var c=/^\s*function\s+([^(]+)\(/;if(!c.test(a.toString())){var e="invalid shared function definition, if name is not specified as first parameter of api.define() call, then function should be named";throw alert(e),new Error(e)}var f=c.exec(a.toString());b=a,a=f[1]}return d.modules.dispatcher.defineSharedWorkerFunction(a,b),this},sleep:function(a){if("undefined"==typeof a){var b=d.modules.ui.getMessageToSay();a="undefined"===b?0:1e3+Math.floor(20*String(b).length)}d.modules.dispatcher.setSleepAfterThisStep(a)},drill:function(){for(var a=d.modules.dispatcher.getFrameToDrill().filter(function(){return 1}),b=a.filter(function(){return 1}),c=d.modules.ui.mainFrameWindow,e=b.length;b.length;)c=c.frames[b.shift()];var f=arguments[e](c);if(f)for(var g=0;g<c.frames.length;g++)if(a.push(g),f===c.frames[g]){for(var h=c.document.getElementsByTagName("iframe"),i=0;i<h.length;i++)h[i].contentWindow===f&&d.modules.ui.trackIframePosition(h[i],a);return d.modules.dispatcher.drill(g)}}})}.call(this,document,window),function(document,window,undefined){"use strict";var worker=!1,workerSourceCodes={},workerCurrentTask={},workerCurrentTaskIndex=!1,workerCurrentStepIndex=!1,workerOnLoadHandler=!1,onLoadHappened=!1,workerTimeout=0,workerSetTimeoutIds=[],workerSetIntervalIds=[],workerWatchdogId=!1,workerGlobals={},workerEventListeners={},resultMessageName=!1,statusMessageName=!1,mainFrameLoaded=!1,workerFrameLoaded=!1,workerCurrentUrl=!1,bootstrapped=!1,highlightedElement=!1,jobDetailsCache={},stepRepeatCounter=0,currentStepEnv={},currentStepWorkerFn,me=this.cartFillerConfiguration,oldTitle,sleepAfterThisStep,useTopWindowForLocalFileOperations,currentInvokeWorkerMessage,relay={isSlave:!1,nextRelay:!1,nextRelayRegistered:!1,nextRelayQueue:[],knownUrls:{},igniteFromLocal:!1,bubbleMessage:function(a){this.isSlave&&postMessage(window.opener,"bubbleRelayMessage",a),this.nextRelay&&(this.nextRelayRegistered?postMessage(this.nextRelay,"bubbleRelayMessage",a):(a.cmd="bubbleRelayMessage",this.nextRelayQueue.push(a)))}},callEventCallbacks=function(a){if(undefined!==workerEventListeners[a])for(var b in workerEventListeners[a])workerEventListeners[a][b]()},postMessage=function(a,b,c,d){undefined===d&&(d="cartFillerMessage"),undefined===c&&(c={}),c.cmd=b,a.postMessage(d+":"+JSON.stringify(c),"*")},resetWorker=function(){clearRegisteredTimeoutsAndIntervals(),workerCurrentTaskIndex=workerCurrentStepIndex=workerOnLoadHandler=!1},fillWorkerCurrentTask=function(a){for(var b in workerCurrentTask)workerCurrentTask.hasOwnProperty(b)&&delete workerCurrentTask[b];var c;for(var d in a)a.hasOwnProperty(d)&&(c=a[d],c instanceof Array&&(c=workerGlobals[decodeAlias(c)]),workerCurrentTask[d]=c)},decodeAlias=function(a){var b=a.map(function(a){return a instanceof Array?String(workerGlobals[decodeAlias(a)]):a});return b.join("")},fillWorkerGlobals=function(a){for(var b in workerGlobals)workerGlobals.hasOwnProperty(b)&&delete workerGlobals[b];for(var c in a)a.hasOwnProperty(c)&&(workerGlobals[c]=a[c])},getLibUrl=function(){return me.localIndexHtml?"":me.baseUrl.replace(/(src|dist)\/?$/,"lib/")},nextTaskFlow,initialized,clearRegisteredTimeoutsAndIntervals=function(){for(;workerSetTimeoutIds.length;)clearTimeout(workerSetTimeoutIds.pop());for(;workerSetIntervalIds.length;)clearInterval(workerSetIntervalIds.pop())},registerWorkerWatchdog=function(){workerWatchdogId&&workerWatchdogId!==!0?removeWatchdogHandler():workerWatchdogId=!1,workerWatchdogId=workerTimeout?setTimeout(function(){workerWatchdogId=!1,workerOnLoadHandler=!1,me.modules.api.result("Timeout happened, worker step cancelled")},workerTimeout):!0},removeWatchdogHandler=function(){workerWatchdogId&&(workerWatchdogId!==!0&&clearTimeout(workerWatchdogId),workerWatchdogId=!1)},openRelay=function(a,b,c){relay.knownUrls[a]=!0,relay.nextRelay&&b?relay.nextRelayRegistered?postMessage(relay.nextRelay,b.cmd,b):relay.nextRelayQueue.push(b):(relay.nextRelay=window.open(a,"_blank","toolbar=yes, location=yes, status=yes, menubar=yes, scrollbars=yes"),c&&setTimeout(function(){relay.nextRelay.blur(),window.focus()},0),b&&relay.nextRelayQueue.push(b),me.localInjectJs&&(relay.igniteFromLocal=!0,setTimeout(function d(){relay.igniteFromLocal&&(relay.nextRelay.postMessage(me.localInjectJs,"*"),setTimeout(d,500))},500)))},workersToEvaluate=[],sharedWorkerFunctions={},currentEvaluatedWorker,workerTaskSources={},evaluateNextWorker=function(){return workersToEvaluate.length?(currentEvaluatedWorker=workersToEvaluate.shift(),eval(workerSourceCodes[currentEvaluatedWorker]),void evaluateNextWorker()):void me.modules.dispatcher.postMessageToWorker("globalsUpdate",{globals:workerGlobals})},evaluateWorkers=function(){workersToEvaluate=[],sharedWorkerFunctions={};for(var a in workerSourceCodes)workersToEvaluate.push(a);evaluateNextWorker()},discoverTaskParameters=function(a,b){var c={};return[/[^a-zA-Z0-9_$]task\.([a-zA-Z0-9_$]+)[^a-zA-Z0-9_$]/g,/[^a-zA-Z0-9_$]task\[['"]([^'"]+)['"]\]/g].filter(function(d){var e=new RegExp(d.source),f=a.toString(),g=f.match(d);g&&g.filter(function(a){var d=e.exec(a);d&&(c[d[1]]=b[d[1]]=!0)});var h=a.cartFillerParameterList;if("undefined"!=typeof h)if(h instanceof Array)h.filter(function(a){c[a]=b[a]=!0});else for(var i in h)c[i]=b[i]=!0}),c},startupWatchDog={fn:function(){var a=[];if(this.workerRegistered||a.push("worker"),a.length){var b="one or more frames were not registered: "+a.join(", ");window.cartFillerEventHandler&&window.cartFillerEventHandler({message:b,filename:"dispatcher.js",lineno:0}),alert(b)}},workerRegistered:!1,chooseJobRegistered:!1,mainRegistered:!1};this.cartFillerConfiguration.scripts.push({getName:function(){return"dispatcher"},init:function(a){a||setTimeout(function(){startupWatchDog.fn()},1e4);var b=this;initialized||(initialized=!0,window.addEventListener("message",function(a){var c=/^cartFillerMessage:(.*)$/;if(c.test(a.data)){var d=c.exec(a.data),e=JSON.parse(d[1]);if(a.source===relay.nextRelay&&"register"!==e.cmd&&"bubbleRelayMessage"!==e.cmd&&"locate"!==e.cmd)"workerStepResult"===e.cmd&&fillWorkerGlobals(e.globals),postMessage(relay.isSlave?window.opener:me.modules.ui.workerFrameWindow,e.cmd,e);else{var f="onMessage_"+e.cmd;undefined!==b[f]&&b[f]instanceof Function?b[f](e,a.source):console.log("unknown message: "+f+":"+a.data)}}else if(0===a.data.indexOf("cartFillerFilePopupUrl")||0===a.data.indexOf("cartFillerFilePopupPing"))window.opener.postMessage(a.data,"*");else if("/^'cartFillerEval'/"===a.data)a.source.postMessage(me.localInjectJs,"*");else if(0===a.data.indexOf("'cartFillerEval';"));else{var g=function(a,b,c){if(c>20)return{};"undefined"==typeof c&&(c=0),"undefined"==typeof b&&(b=[]);var d,e=function(a){return a===d},f={};for(var h in a){d=a[h];try{if(!(d instanceof Window||d instanceof Function||"[object Window]"===d.toString())){var i=null;try{"object"==typeof d&&d.constructor&&(i=d.constructor.name)}catch(d){}"Window"!==i&&(b.filter(e).length||(b.push(d),f[h]="object"==typeof a[h]?g(d,b,c+1):a[h]))}}catch(d){}}return f};me.modules.dispatcher.onMessage_postMessage({cmd:"postMessage",event:g(a),originalEvent:a})}return!1},!1))},onMessage_register:function(a,b){if(b===me.modules.ui.workerFrameWindow)workerFrameLoaded=!0,startupWatchDog.workerRegistered=!0,mainFrameLoaded&&!bootstrapped&&this.bootstrapCartFiller();else if(b===me.modules.ui.chooseJobFrameWindow)startupWatchDog.chooseJobRegistered=!0,this.postMessageToChooseJob("bootstrap",{lib:getLibUrl(),testSuite:!0,src:me.localIndexHtml?"":me.baseUrl.replace(/\/$/,"")+"/",hashUrl:window.location.hash},"cartFillerMessage");else if(b===me.modules.ui.mainFrameWindow)startupWatchDog.mainRegistered=!0,postMessage(b,"bootstrap",{dummy:!0});else if(b===relay.nextRelay){relay.igniteFromLocal=!1,relay.nextRelayRegistered=!0;var c,d=[];for(c in workerSourceCodes)workerSourceCodes.hasOwnProperty(c)&&d.push(c);for(var e=0;e<d.length;e++)relay.nextRelayQueue.push({cmd:"loadWorker",jobDetailsCache:jobDetailsCache,url:d[e],code:workerSourceCodes[d[e]],isFinal:e===d.length-1});for(var f;relay.nextRelayQueue.length;)f=relay.nextRelayQueue.shift(),postMessage(relay.nextRelay,f.cmd,f)}},onMessage_makeSmaller:function(){me.modules.ui.setSize("small")},onMessage_makeBigger:function(){me.modules.ui.setSize("big")},onMessage_toggleSize:function(a){me.modules.ui.setSize(a.size)},onMessage_chooseJob:function(){me.modules.ui.showHideChooseJobFrame(!0),this.postMessageToWorker("chooseJobShown")},onMessage_chooseJobCancel:function(){me.modules.ui.showHideChooseJobFrame(!1),this.postMessageToWorker("chooseJobHidden")},onMessage_jobDetails:function(a){var b=function(a){if(!(a instanceof Array)){var b=[];for(c=0;"undefined"!=typeof a[c];c++)b.push(a[c]);a=b}return a};if(undefined!==a.details){workerSourceCodes={},resultMessageName=a.resultMessage?a.resultMessage:!1,statusMessageName=a.statusMessage?a.statusMessage:!1,me.modules.ui.showHideChooseJobFrame(!1),a.overrideWorkerSrc=me["data-worker"],workerTimeout=a.timeout,workerCurrentTask={},resetWorker();var c;for(c in jobDetailsCache)jobDetailsCache.hasOwnProperty(c)&&delete jobDetailsCache[c];for(c in a)jobDetailsCache[c]=a[c];worker={},workerGlobals=a.globals=a.globals?a.globals:{},a.details=b(a.details),workerEventListeners={}}else{if(undefined===a.$cartFillerTestUpdate){if(undefined!==a.$preventPageReload)return void me.modules.ui.preventPageReload();throw new Error("unknown job details package - should have either details or $cartFillerTestUpdate")}a.$cartFillerTestUpdate.details=b(a.$cartFillerTestUpdate.details)}this.postMessageToWorker("jobDetails",a)},onMessage_sendResult:function(a){me.modules.ui.showHideChooseJobFrame(!0),resultMessageName&&this.postMessageToChooseJob(resultMessageName,a)},onMessage_sendStatus:function(a){statusMessageName&&this.postMessageToChooseJob(statusMessageName,a)},onMessage_loadWorker:function(a){try{a.jobDetailsCache&&(jobDetailsCache=a.jobDetailsCache),workerSourceCodes[a.src]=a.code,a.isFinal&&evaluateWorkers(),relay.nextRelay&&(a.jobDetailsCache=jobDetailsCache,postMessage(relay.nextRelay,a.cmd,a))}catch(b){throw alert(b),console.log(b),b}},onMessage_updateProperty:function(a){if(parseInt(a.index)===parseInt(workerCurrentTaskIndex)){var b=a.value;b instanceof Array&&(b=workerGlobals[decodeAlias(b)]),workerCurrentTask[a.name]=b}},onMessage_invokeWorker:function(a){currentInvokeWorkerMessage=a,a.globals&&fillWorkerGlobals(a.globals);try{me.modules.ui.say()}catch(b){}if(this.reflectMessage(a,a.drillToFrame))return void(a.debug&&console.log("Debugger call went to slave tab - look for it there!"));if(!1!==workerCurrentStepIndex){var c="ERROR: worker task is in still in progress";alert(c)}else{stepRepeatCounter=0,onLoadHappened=!1,nextTaskFlow="normal",workerCurrentTaskIndex!==a.index&&(fillWorkerCurrentTask(a.details),me.modules.api.arrow().highlight()),workerCurrentTaskIndex=a.index,workerCurrentStepIndex=a.step,currentStepEnv={taskIndex:a.index,stepIndex:a.step,task:a.details,repeatCounter:a.repeatCounter,params:{}};try{if(undefined===worker[a.task])alert("invalid worker - no function for "+a.task+" exist");else if(undefined===worker[a.task][2*a.step+1])alert("invalid worker - function for "+a.task+" step "+a.step+" does not exist");else{var d=worker[a.task][2*a.step+1];if("function"!=typeof d){if("function"!=typeof d[0])return void alert("invalid worker - function for "+a.task+" step "+a.step+" is not a function");currentStepEnv.params=d[1],d=d[0]}if(registerWorkerWatchdog(),sleepAfterThisStep=undefined,currentStepWorkerFn=d,a.debug)debugger;d(highlightedElement,currentStepEnv)}}catch(c){throw this.reportErrorResult(c),c}}},reportErrorResult:function(a){if(console.log(a),workerWatchdogId){var b=String(a);b||(b="unknown exception"),me.modules.api.result(b,!1)}},onMessage_focusMainFrameWindow:function(){me.modules.ui.focusMainFrameWindow()},onMessage_resetWorker:function(a){relay.nextRelay&&openRelay("about:blank",a),resetWorker()},onMessage_closePopup:function(){me.modules.ui.closePopup()},onMessage_helloFromPlugin:function(a){this.postMessageToChooseJob(a.message,{useTopWindowForLocalFileOperations:useTopWindowForLocalFileOperations})},onMessage_refreshPage:function(a){this.reflectMessage(a)||me.modules.ui.refreshPage()},onMessage_startReportingMousePointer:function(){me.modules.ui.startReportingMousePointer()},onMessage_evaluateCssSelector:function(details){if(!me.modules.dispatcher.reflectMessage(details)){for(var elements=eval("me.modules.ui.mainFrameWindow.jQuery"+details.selector),arrow=[],i=0;i<elements.length&&16>i;i++)arrow.push(elements[i]);me.modules.ui.arrowTo(arrow,!0),this.postMessageToWorker("cssSelectorEvaluateResult",{count:elements.length})}},onMessage_bubbleRelayMessage:function(a,b){a.cmd="bubbleRelayMessage",relay.isSlave&&b!==window.opener&&!a.notToParents&&postMessage(window.opener,a.cmd,a),relay.nextRelay&&b!==relay.nextRelay&&!a.notToChildren&&(relay.nextRelayRegistered?postMessage(relay.nextRelay,a.cmd,a):relay.nextRelayQueue.push(a)),"onMainFrameLoaded"===a.message?me.modules.dispatcher.onMainFrameLoaded(a.args[0],!0):"openRelayOnHead"!==a.message||relay.isSlave?"openRelayOnTail"!==a.message||relay.nextRelay?"updateTitle"===a.message?me.modules.dispatcher.onMessage_updateTitle(a):"drill"!==a.message||relay.isSlave?"uiAssets"!==a.message||relay.isSlave||me.modules.ui.setSerializedAssets(a):(a.cmd="invokeWorker",me.modules.dispatcher.onMessage_invokeWorker(a)):openRelay(a.args[0],undefined,a.args[1]):relay.knownUrls[a.args[0]]||(relay.knownUrls[a.args[0]]=!0,me.modules.dispatcher.onMessage_bubbleRelayMessage({message:"openRelayOnTail",args:a.args,notToParents:!0}))},onMessage_reportingMousePointerClick:function(a){me.modules.dispatcher.reflectMessage(a)||me.modules.ui.reportingMousePointerClick(a.x,a.y)},onMessage_postMessage:function(a){if(/^cartFillerFilePopup/.test(a.event.data))me.modules.ui.chooseJobFrameWindow.postMessage(a.event.data,"*");else if(!me.modules.dispatcher.reflectMessage(a)){var b;b=new me.modules.ui.mainFrameWindow.CustomEvent("message",a.event);for(var c in a.event)try{b[c]=a.event[c]}catch(d){}me.modules.ui.mainFrameWindow.dispatchEvent(b)}},onMessage_locate:function(){alert("Here I am!")},onMessage_updateHashUrl:function(a){var b=window.location.hash,c=function(a,c){var d=new RegExp("(^#/?|&)"+a+"=([^&]*)(&|$)");c=encodeURIComponent(c);var e=d.exec(b);e?c!==e[2]&&(b=b.replace(e[0],e[1]+a+"="+c+e[3])):b.length<4096&&(b=b+(0===b.replace(/^#?\/?/,"").length?"":"&")+a+"="+c)};c("job",a.jobName),c("task",a.task),c("step",a.step),window.location.hash=b},onMessage_updateTitle:function(a){window.document.title=a.title},onMessage_requestWorkers:function(a){this.postMessageToChooseJob("cartFillerRequestWorkers",a)},onMessage_launchFromSlave:function(){useTopWindowForLocalFileOperations=!0,me.launch(!0)},onMessage_highlightElementForQueryBuilder:function(a){me.modules.ui.highlightElementForQueryBuilder(a.path)},onMainFrameLoaded:function(a,b){if(mainFrameLoaded=!0,workerFrameLoaded&&!bootstrapped?this.bootstrapCartFiller():b||relay.bubbleMessage({message:"onMainFrameLoaded",args:[a]}),workerOnLoadHandler){try{callEventCallbacks("onload"),workerOnLoadHandler(a)}catch(c){this.reportErrorResult(c)}workerOnLoadHandler=!1,onLoadHappened=!1}else onLoadHappened=!0},postMessageToWorker:function(a,b){postMessage(me.modules.ui.workerFrameWindow,a,b)},postMessageToChooseJob:function(a,b,c){postMessage(me.modules.ui.chooseJobFrameWindow,a,b,c?c:a)},bootstrapCartFiller:function(){bootstrapped=!0,this.postMessageToWorker("bootstrap",{lib:getLibUrl(),debug:me["data-debug"]})},registerWorker:function(a){var b=function(a,c){"undefined"==typeof c&&(c=[]);for(var d=0;d<a.length;d++)a[d]instanceof Array&&a[d].length>0&&"string"==typeof a[d][0]?b(a[d],c):c.push(a[d]);return c},c={window:me.modules.ui.mainFrameWindow,document:undefined,api:me.modules.api,task:workerCurrentTask,job:jobDetailsCache,globals:workerGlobals},d=a.toString().split("(")[1].split(")")[0].split(",").map(function(a){return a=a.trim(),c.hasOwnProperty(a)?c[a]:function(){for(;!sharedWorkerFunctions[a]&&workersToEvaluate.length;)evaluateNextWorker();if(!sharedWorkerFunctions[a]){var b="bad worker - shared function was not defined: ["+a+"]";throw alert(b),new Error(b)}return sharedWorkerFunctions[a].apply(worker,arguments)}}),e=a.apply(undefined,d);for(var f in e)e.hasOwnProperty(f)&&(worker[f]=b(e[f]),workerTaskSources[f]=currentEvaluatedWorker);if(!workersToEvaluate.length){var g={},h={};for(f in worker){for(var i=[],j={},k={},l=0;l<worker[f].length;l++)"string"==typeof worker[f][l]&&(i.push(worker[f][l]),worker[f][l+1]instanceof Function&&(j[i.length-1]=discoverTaskParameters(worker[f][l+1],k)));j.all=k,g[f]=i,h[f]=j}this.postMessageToWorker("workerRegistered",{jobTaskDescriptions:g,discoveredParameters:h,workerTaskSources:workerTaskSources})}},manageTaskFlow:function(a){nextTaskFlow=a},submitWorkerResult:function(a,b,c){if(workerCurrentStepIndex===!1)return void alert("You have invalid worker, result is submitted twice, please fix");for(var d in currentStepEnv.task)if(currentStepEnv.task[d]instanceof Array){for(var e=currentStepEnv.task[d][0];e[0]instanceof Array;e=e[0]);workerGlobals[decodeAlias(currentStepEnv.task[d])]=workerCurrentTask[d]}var f,g;if(undefined===a||""===a)f="ok";else{if("string"!=typeof a)throw new Error("invalid message type "+typeof a);f=b?"skip":"error"}if(removeWatchdogHandler(),clearRegisteredTimeoutsAndIntervals(),"ok"!==f){if(stepRepeatCounter++,g=/repeat(\d+)/.exec(currentStepWorkerFn.toString().split(")")[0]),g&&parseInt(g[1])>stepRepeatCounter)return void me.modules.api.setTimeout(function(){currentStepWorkerFn(highlightedElement,currentStepEnv)},1e3)}else"undefined"==typeof sleepAfterThisStep&&(g=/sleep(\d+)/.exec(currentStepWorkerFn.toString().split(")")[0]),g&&(sleepAfterThisStep=parseInt(g[1])));this.postMessageToWorker("workerStepResult",{index:workerCurrentTaskIndex,step:workerCurrentStepIndex,status:f,message:a,response:c,nop:"nop"===b,nextTaskFlow:nextTaskFlow,globals:workerGlobals,sleep:sleepAfterThisStep}),workerCurrentStepIndex=workerOnLoadHandler=!1},registerWorkerOnloadCallback:function(a){if(onLoadHappened){try{callEventCallbacks("onload"),a(!0)}catch(b){this.reportErrorResult(b)}workerOnLoadHandler=!1}else workerOnLoadHandler=a},getWorkerCurrentStepIndex:function(){return workerCurrentStepIndex},setHighlightedElement:function(a){highlightedElement=a},registerWorkerSetTimeout:function(a){workerSetTimeoutIds.push(a)},registerWorkerSetInterval:function(a){workerSetIntervalIds.push(a)},updateCurrentUrl:function(a){workerCurrentUrl!==a&&(this.postMessageToWorker("currentUrl",{url:a}),workerCurrentUrl=a)},reflectMessage:function(a,b){for(var c=!0,d="undefined"==typeof b?[]:b.filter(function(){return 1}),e=me.modules.ui.mainFrameWindow;d.length;)e=e.frames[d.shift()];try{e.location.href}catch(f){c=!1}return c?!1:("invokeWorker"===a.cmd&&(a.globals=workerGlobals),openRelay("about:blank",a),!0)},startSlaveMode:function(){for(var a=document.getElementsByTagName("body")[0];a.children.length;)a.removeChild(a.children[0]);var b=document.createElement("a");try{b.textContent="This tab is used by cartFiller as slave, DO NOT CLOSE IT!, click this message to locate original tab.",b.style.color="red",b.style.display="block",b.style.padding="20px",b.setAttribute("href","#"),b.onclick=function(){window.opener.postMessage('cartFillerMessage:{"cmd":"locate"}',"*")}}catch(c){}a.appendChild(b);try{b.focus()}catch(c){}worker={},me.modules.dispatcher.init(!0),window.opener.postMessage('cartFillerMessage:{"cmd":"register"}',"*"),me.modules.ui.chooseJobFrameWindow=me.modules.ui.workerFrameWindow=window.opener;try{for(var d=window.opener;d&&d!==d.opener;d=d.opener)try{if(d.frames.cartFillerMainFrame){me.modules.ui.mainFrameWindow=d.frames.cartFillerMainFrame;break}}catch(c){}}catch(c){return}return me.modules.ui.mainFrameWindow?(me.modules.dispatcher.registerLoadWatcher(),relay.isSlave=!0,void setInterval(function(){var a=!1;try{me.modules.ui.mainFrameWindow&&me.modules.ui.mainFrameWindow.location&&(a=me.modules.ui.mainFrameWindow.location.href)}catch(b){}a&&me.modules.dispatcher.updateCurrentUrl(a)},100)):void setTimeout(function(){me.uiLaunched||alert("could not find mainFrameWindow in slave mode")},1e4)},registerLoadWatcher:function(){setTimeout(function a(){var b;try{me.modules.ui.mainFrameWindow.document&&"complete"===me.modules.ui.mainFrameWindow.document.readyState&&!me.modules.ui.mainFrameWindow.document.getElementsByTagName("html")[0].getAttribute("data-cartfiller-reload-tracker")&&(me.modules.ui.mainFrameWindow.document.getElementsByTagName("html")[0].setAttribute("data-cartfiller-reload-tracker",0),me.modules.dispatcher.onMainFrameLoaded(!0)),b="undefined"==typeof me.modules.ui.mainFrameWindow.document.title?"":me.modules.ui.mainFrameWindow.document.title}catch(c){}oldTitle!==b&&(oldTitle=b,"undefined"!=typeof b&&(me.modules.dispatcher.onMessage_updateTitle({title:b}),relay.bubbleMessage({message:"updateTitle",title:b}))),setTimeout(a,100)},100)},openRelayOnTheTail:function(a,b){me.modules.dispatcher.onMessage_bubbleRelayMessage({message:"openRelayOnHead",args:[a,b],notToChildren:!0})},registerEventCallback:function(a,b,c){undefined===workerEventListeners[a]&&(workerEventListeners[a]={}),workerEventListeners[a][b]=c},getWorkerTask:function(){return workerCurrentTask},getWorkerGlobals:function(){return workerGlobals},getWorker:function(){return worker},defineSharedWorkerFunction:function(a,b){sharedWorkerFunctions[a]=b},setSleepAfterThisStep:function(a){sleepAfterThisStep=a},drill:function(a){workerCurrentStepIndex=workerOnLoadHandler=!1,currentInvokeWorkerMessage.drillToFrame=this.getFrameToDrill(),currentInvokeWorkerMessage.drillToFrame.push(a),currentInvokeWorkerMessage.message="drill",currentInvokeWorkerMessage.notToChildren=!0,currentInvokeWorkerMessage.notToParents=!1,this.onMessage_bubbleRelayMessage(currentInvokeWorkerMessage)},isDrilling:function(){return"undefined"!=typeof currentInvokeWorkerMessage.drillToFrame},getFrameToDrill:function(){return currentInvokeWorkerMessage.drillToFrame?currentInvokeWorkerMessage.drillToFrame:[]},isSlave:function(){return relay.isSlave}})}.call(this,document,window),function(a,b){"use strict";var c=["dispatcher","ui","api"],d=this,e=function(){for(var a=c.length-1;a>=0;a--){for(var e=!1,f=d.cartFillerConfiguration.scripts.length-1;f>=0;f--)if(d.cartFillerConfiguration.scripts[f].getName()===c[a]){e=!0;break}if(!e)return}b.cartFillerAPI=function(){return d.cartFillerConfiguration.modules.api},d.cartFillerConfiguration.modules={};for(var g=d.cartFillerConfiguration.scripts.length-1;g>=0;g--){var h=d.cartFillerConfiguration.scripts[g];d.cartFillerConfiguration.modules[h.getName()]=h}d.cartFillerConfiguration.launch()};if(this.cartFillerConfiguration.scripts.push=function(a){Array.prototype.push.call(this,a),e()},!this.cartFillerConfiguration.concatenated)for(var f=a.getElementsByTagName("head")[0],g=c.length-1;g>=0;g--){var h=a.createElement("script");h.setAttribute("src",this.cartFillerConfiguration.baseUrl+"/boot/helpers/"+c[g]+".js"),f.appendChild(h)}}.call(this,document,window),function(a,b,c){"use strict";var d=this.cartFillerConfiguration,e="cartFillerOverlayDiv",f="cartFillerMainFrame",g="cartFillerWorkerFrame",h="cartFillerChooseJobFrame",i=!1,j=[],k=[],l={},m={},n="",o=!1,p="",q=0,r=!1,s=!1,t="big",u=!1,v=function(){return d.modules.ui.mainFrameWindow},w=function(){return"rgba(255,0,0,0.3)"},x=function(){var a=v().document.createElement("div");return a.style.position="fixed",a.style.backgroundColor=w(),a.style.zIndex=U(),a.className=e,a.onclick=function(){Q(!0)},v().document.getElementsByTagName("body")[0].appendChild(a),a},y=function(a,b,c){var d=x();d.style.left=a+"px",d.style.top=b+"px",d.style.width="20px",d.style.height=c+"px"},z=function(a,b,c){var d=x();d.style.left=a+"px",d.style.top=b+"px",d.style.width=c+"px",d.style.height="20px"},A=function(a,b){var c=x();c.style.left=a+"px",c.style.top=b-25+"px",c.style.width=c.style.height="0px",c.style.backgroundColor="transparent",c.style.borderTop=c.style.borderBottom="25px solid transparent",c.style.borderLeft="30px solid rgba(255,0,0,0.3)"},B=function(a,b){var c=x();c.style.left=a-25+"px",c.style.top=b+"px",c.style.width=c.style.height="0px",c.style.backgroundColor="transparent",c.style.borderLeft=c.style.borderRight="25px solid transparent",c.style.borderTop="30px solid rgba(255,0,0,0.3)"},C=function(a,b){if(c!==b.ownerDocument&&c!==b.ownerDocument.defaultView&&c!==b.ownerDocument.defaultView.parent&&b.ownerDocument.defaultView.parent!==b.ownerDocument.defaultView){
var d=[];try{d=b.ownerDocument.defaultView.parent.document.getElementsByTagName("iframe")}catch(e){}for(var f=d.length-1;f>=0;f--){var g;try{g=d[f].contentDocument}catch(e){}var h;try{h=d[f].contentWindow}catch(e){}if(g===b.ownerDocument||b.ownerDocument!==c&&b.ownerDocument.defaultView===h){var i=d[f].getBoundingClientRect(),j={top:a.top+i.top,bottom:a.bottom+i.top,left:a.left+i.left,right:a.right+i.left,width:a.width,height:a.height};return C(j,d[f])}}}return a},D=function(a,b){var c=x();c.style.left=a-25+"px",c.style.top=b+"px",c.style.width=c.style.height="0px",c.style.backgroundColor="transparent",c.style.borderLeft=c.style.borderRight="25px solid transparent",c.style.borderBottom="30px solid rgba(255,0,0,0.3)"},E=function(a){var b,d,e,f,g,h,i,j={};if(!(a instanceof Array)){var k=[];for(b in a)k.push(a[b]);a=k}for(b=a.length-1;b>=0;b--){if(h=a[b],h.element)i=h.element.getBoundingClientRect(),h.path&&h.path.length||(i=C(i,h.element));else{i={left:h.rect.left,top:h.rect.top,right:h.rect.right,bottom:h.rect.bottom,width:h.rect.width,height:h.rect.height};for(var l=0;l<h.path.length;l++){var n=h.path.slice(0,l+1).join("/"),o=m[n];o&&(i.left+=o.rect.left,i.top+=o.rect.top,i.right+=o.rect.left,i.bottom+=o.rect.top)}}i.width>0||i.height>0||i.left>0||i.top>0?(d=Math.round(i.top-5),e=Math.round(i.left-5),g=Math.round(i.height+9),f=Math.round(i.width+9)):h.left=h.right=h.top=h.bottom=c,(d!==h.top||e!==h.left||g!==h.height||f!==h.width)&&(h.element&&(j.my=!0),j.any=!0,h.top=d,h.left=e,h.height=g,h.width=f,h.self={top:i.top,left:i.left,right:i.right,bottom:i.bottom,width:i.width,height:i.height})}return j},F=function(){var a,b,d,e;for(a=j.length-1;a>=0;a--){var f=j[a];if(f.left!==c){var g=x();g.style.backgroundColor="transparent",g.style.borderLeft=g.style.borderTop=g.style.borderRight=g.style.borderBottom="5px solid rgba(255,0,0,0.3)",g.style.left=f.left+"px",g.style.top=f.top+"px",g.style.width=f.width+"px",g.style.height=f.height+"px",g.style.boxSizing="border-box",f.left>40?(b=f.top+Math.round(f.height/2),y(0,0,b-10),z(0,b-10,f.left-30),A(f.left-30,b)):f.top>40?(d=f.left+Math.min(30+30*a,Math.round(f.width/2)),z(0,0,d-10),y(d-10,0,f.top-30),B(d,f.top-30)):(d=f.left+Math.min(30,Math.round(f.width/2)),e=f.top+f.height,z(0,e+60,d+10),y(d-10,e+30,30),D(d,e))}}},G=function(a,b){var d,e,f,g,h,i,j,k=[a,b];for(e=k.length-1;e>=0;e--)if(c!==k[e])for(d=k[e].length-1;d>=0;d--)j=k[e][d],f=c===f?j.left:Math.min(f,j.left),h=c===h?j.left+j.width:Math.max(h,j.left+j.width),g=c===g?j.top:Math.min(g,j.top),i=c===i?j.top+j.height:Math.max(i,j.top+j.height);return{left:f,right:h,top:g,bottom:i}},H=function(a){var b;for(b=a.length-1;b>=0;b--)a[b].left=a[b].top=a[b].width=a[b].height=c},I=function(){var a=G(k);if(a.left!==c){var b=d.modules.ui.mainFrameWindow.innerHeight,e=d.modules.ui.mainFrameWindow.innerWidth,f=5;O(0,0,Math.max(0,a.left-f),b),O(Math.min(e,a.right+f),0,e,b),O(Math.max(0,a.left-f),0,Math.min(e,a.right+f),Math.min(b,a.top-f)),O(Math.max(0,a.left-f),Math.max(0,a.bottom+f),Math.min(e,a.right+f),b)}},J=function(){var a=G(j,k);if(a.left===c&&(a={top:0,bottom:0,left:0,right:0}),"string"==typeof n&&n.length>0||"string"!=typeof n&&c!==n&&null!==n&&!isNaN(n)){var b=v().document.createElement("div");if(b.style.display="block",b.style.backgroundColor="#fff",b.style.padding="10px",b.style.fontSize="20px;",b.style.zIndex=U()+1,b.style.border="#bbb solid 10px",b.style.borderRadius="20px",b.style.overflow="auto",b.style.opacity="0",b.style.top=a.bottom+5+"px",b.style.left=Math.max(0,Math.round((a.left+a.right)/2)-r)+"px",b.style.width=r+"px",b.style.height="auto",b.style.maxHeight="100%",b.style.position="fixed",b.style.fontSize="20px",b.className=e,o){var f=v().document.createElement("pre");b.appendChild(f),f.textContent=n,f.style.backgroundColor="#fff",f.style.border="none"}else b.textContent=n;b.onclick=function(){Q(!0)},v().document.getElementsByTagName("body")[0].appendChild(b),q=100,d.modules.ui.adjustMessageDiv(b)}p=n},K=function(){var a=function(a){var b=function(a){return{rect:{left:a.self.left,top:a.self.top,right:a.self.right,bottom:a.self.bottom,width:a.self.width,height:a.self.height,url:a.element.ownerDocument.defaultView.location.href},path:a.path}};if(a instanceof Array)return a.filter(function(a){return a.element}).map(b);var c=[];for(var d in a)c.push(b(a[d]));return c};try{var b=E(j),c=E(k),e=E(l),f=p!==n;(b.my||c.my||f||e.my)&&d.modules.dispatcher.isDrilling()&&d.modules.dispatcher.onMessage_bubbleRelayMessage({message:"uiAssets",arrows:b.my?a(j):null,highlighted:c.my?a(k):null,iframes:e.my?a(l):null,say:f?n:null,notToChildren:!0}),(b.any||c.any||f||e.any)&&(d.modules.dispatcher.isSlave()||(Q(),F(),I(),J()))}catch(g){}},L={width:!1,height:!1,outerWidth:!1,outerHeight:!1,workerFrameSize:!1},M=function(){var a=b.innerWidth,c=b.innerHeight,e=s?!1:b.outerWidth,f=s?!1:b.outerHeight;if(d.modules.ui.mainFrameWindow&&d.modules.ui.mainFrameWindow.location){var g=!1;try{g=d.modules.ui.mainFrameWindow.location.href}catch(h){}g&&d.modules.dispatcher.updateCurrentUrl(g)}(L.width!==a||L.height!==c||L.outerWidth!==e||L.outerHeight!==f||L.workerFrameSize!==t)&&(!function(){var b=.8*a-1,g=.2*a-1,h=.8*a-1,i=.2*a-1,j=c-15,k=.02*a+(s?0:200),l=.76*a-(s?0:200),m=.02*c,n=.96*c;s&&(d.modules.ui.mainFrame.style.height=j+"px");try{d.modules.ui.workerFrame.style.height=j+"px"}catch(o){}try{d.modules.ui.chooseJobFrame.style.height=n+"px",d.modules.ui.chooseJobFrame.style.top=m+"px",d.modules.ui.chooseJobFrame.style.left=k+"px",d.modules.ui.chooseJobFrame.style.width=l+"px"}catch(o){}if("big"===t)if(s){try{d.modules.ui.workerFrame.style.width=h+"px",d.modules.ui.workerFrame.style.left=g+"px"}catch(o){}try{d.modules.ui.mainFrame.style.width=g+"px"}catch(o){}}else{try{d.modules.ui.mainFrameWindow.resizeTo(1,1)}catch(o){}try{d.modules.ui.workerFrame.style.width=h+"px",d.modules.ui.workerFrame.style.left=a-h-5+"px"}catch(o){}}else if("small"===t)if(s){try{d.modules.ui.workerFrame.style.width=i+"px",d.modules.ui.workerFrame.style.left=b+"px"}catch(o){}try{d.modules.ui.mainFrame.style.width=b+"px"}catch(o){}}else{try{d.modules.ui.mainFrameWindow.resizeTo(Math.round(.8*e-10),Math.round(f))}catch(o){}try{d.modules.ui.workerFrame.style.width=i+"px",d.modules.ui.workerFrame.style.left=a-i-5+"px"}catch(o){}}}(),L.width=a,L.height=c,L.outerWidth=e,L.outerHeight=f,L.workerFrameSize=t)},N=function(){return d.modules.ui.mainFrameWindow.document},O=function(a,b,c,d){a=Math.round(a),b=Math.round(b),c=Math.round(c),d=Math.round(d);var f=N().createElement("div");f.style.position="fixed",f.style.left=a+"px",f.style.top=b+"px",f.style.width=c-a+"px",f.style.height=d-b+"px",f.style.backgroundColor="rgba(0,0,0,0.3)",f.style.zIndex=U(),f.className=e,f.onclick=function(){Q(!0)},N().getElementsByTagName("body")[0].appendChild(f)},P=function(a){var b,e,f,g,h,i,j,k=d.modules.ui.mainFrameWindow.innerHeight,l=d.modules.ui.mainFrameWindow.innerWidth;a.length>0&&"function"==typeof a[0].element.scrollIntoView&&a[0].element.scrollIntoView();for(var m=1e3;m&&(E(a),b=G(a),g=Math.round((b.right+b.left)/2),j=Math.round((b.bottom+b.top)/2),!(c!==e&&g>=e&&f>=g&&j>=h&&i>=j));m--)e=c===e?g:Math.min(e,g),f=c===f?g:Math.max(f,g),h=c===h?j:Math.min(h,j),i=c===i?j:Math.max(i,j),d.modules.ui.mainFrameWindow.scrollBy(g-Math.round(l/2),j-Math.round(k/2));H(a)},Q=function(a){var b,c=N().getElementsByTagName("div");for(b=c.length-1;b>=0;b--)c[b].className===e&&c[b].parentNode.removeChild(c[b]);for(c=v().document.getElementsByTagName("div"),b=c.length-1;b>=0;b--)c[b].className===e&&c[b].parentNode.removeChild(c[b]);!0===a&&(j=k=[],n="")},R=function(){return d["data-wfu"]?d["data-wfu"]:d.baseUrl+"/index"+(d.concatenated?"":".uncompressed")+".html"+(d.gruntBuildTimeStamp?"?"+d.gruntBuildTimeStamp:"")},S=!1,T=!1,U=function(){return 1e7};setInterval(K,200),d.scripts.push({getName:function(){return"ui"},setSize:function(){},showHideChooseJobFrame:function(a){a&&!i&&(0===d["data-choose-job"].indexOf("#")&&d.localIndexHtml?this.chooseJobFrameWindow.document.write(d.localIndexHtml.replace(/data-local-href=""/,'data-local-href="'+d["data-choose-job"]+'"')):this.chooseJobFrameWindow.location.href=d["data-choose-job"],i=!0),this.chooseJobFrame.style.display=a?"block":"none"},closePopup:function(){},focusMainFrameWindow:function(){},highlight:function(a,b){n="";var e,f=this.mainFrameWindow.document.getElementsByTagName("body")[0],g=d.modules.dispatcher.getFrameToDrill();if(k=[],null!==a&&"object"==typeof a&&"string"==typeof a.jquery&&c!==a.length&&"function"==typeof a.each)a.each(function(a,c){return k.push({element:c,path:g}),b?void 0:!1});else if(a instanceof Array)for(e=a.length-1;e>=0&&(k.push({element:a[e],path:g}),!0===b);e--);else c!==a&&k.push({element:a,path:g});k.length>0&&(f.style.paddingBottom=this.mainFrameWindow.innerHeight+"px",setTimeout(function(){P(k)},0))},arrowTo:function(a,b){var e=d.modules.dispatcher.getFrameToDrill();if(j=[],null!==a&&"object"==typeof a&&"string"==typeof a.jquery&&c!==a.length&&"function"==typeof a.each)a.each(function(a,c){return j.push({element:c,path:e}),b?void 0:!1});else if(a instanceof Array)for(var f=0;f<a.length&&(j.push({element:a[f],path:e}),b);f++);else c!==a?j.push({element:a,path:e}):(j=[],Q(!0));j.length>0&&setTimeout(function(){try{P(j)}catch(a){}},0)},arrowToSingleElementNoScroll:function(a){j=[{element:a,path:d.modules.dispatcher.getFrameToDrill()}]},say:function(a,b){n=c===a?"":a,o=b,r=Math.max(100,Math.round(.5*this.mainFrameWindow.innerWidth)),q=100},adjustMessageDiv:function(a){var b=this;setTimeout(function(){var d=!0;if(q>0){d=!1;var e=a.getBoundingClientRect();if(e.bottom>b.mainFrameWindow.innerHeight?e.width>.95*b.mainFrameWindow.innerWidth?e.top-(T-S)-10<.05*b.mainFrameWindow.innerHeight?d=!0:b.mainFrameWindow.scrollBy(0,Math.round(.05*b.mainFrameWindow.innerHeight)):r=Math.min(b.mainFrameWindow.innerWidth,parseInt(a.style.width.replace("px",""))+Math.round(.04*b.mainFrameWindow.innerWidth)):d=!0,d){a.style.opacity="1";var f=a.parentNode;f&&f.removeChild(a),v().document.getElementsByTagName("body")[0].appendChild(a),q=0}else q--,H(j),H(k),p=c}else a.style.opacity="1"},0)},popup:function(a,b){d.modules.dispatcher.init(),this.mainFrameWindow=b.open(b.location.href,"_blank","resizable=1, height=1, width=1, scrollbars=1"),this.closePopup=function(){this.mainFrameWindow.close()},this.focusMainFrameWindow=function(){this.mainFrameWindow.focus()},d.modules.dispatcher.registerLoadWatcher();for(var e=b.document.getElementsByTagName("body")[0];e.children.length;)e.removeChild(e.children[0]);this.setSize=function(a){c===a&&(a="big"===t?"small":"big"),t=a,M(),"small"===a&&this.mainFrameWindow.focus()},this.workerFrame=b.document.createElement("iframe"),this.workerFrame.setAttribute("name",g),this.workerFrame.style.position="fixed",this.workerFrame.style.top="0px",this.workerFrame.style.height="100%",this.workerFrame.style.zIndex="100000",e.appendChild(this.workerFrame),this.workerFrameWindow=b.frames[g],d.localIndexHtml?this.workerFrameWindow.document.write(d.localIndexHtml):this.workerFrameWindow.location.href=R(),this.chooseJobFrame=b.document.createElement("iframe"),this.chooseJobFrame.setAttribute("name",h),this.chooseJobFrame.style.position="fixed",this.chooseJobFrame.style.height="0px",this.chooseJobFrame.style.top="0px",this.chooseJobFrame.style.left="0px",this.chooseJobFrame.style.width="0px",this.chooseJobFrame.style.zIndex="10000002",this.chooseJobFrame.style.background="white",e.appendChild(this.chooseJobFrame),this.chooseJobFrameWindow=b.frames[h],this.setSize("big"),setInterval(M,2e3)},framed:function(a,b){s=!0,d.modules.dispatcher.init();for(var e=a.getElementsByTagName("body")[0],i=b.location.href;e.children.length;)e.removeChild(e.children[0]);this.mainFrame=a.createElement("iframe"),this.mainFrame.setAttribute("name",f),this.mainFrame.style.height="0px",this.mainFrame.style.position="fixed",this.mainFrame.style.left="0px",this.mainFrame.style.top="0px",this.mainFrame.style.borderWidth="0px",this.workerFrame=a.createElement("iframe"),this.workerFrame.setAttribute("name",g),this.workerFrame.style.height="0px",this.workerFrame.style.position="fixed",this.workerFrame.style.top="0px",this.chooseJobFrame=a.createElement("iframe"),this.chooseJobFrame.setAttribute("name",h),this.chooseJobFrame.style.display="none",this.chooseJobFrame.style.height="0px",this.chooseJobFrame.style.top="0px",this.chooseJobFrame.style.left="0px",this.chooseJobFrame.style.width="0px",this.chooseJobFrame.style.position="fixed",this.chooseJobFrame.style.background="white",this.chooseJobFrame.style.zIndex="10000002",e.appendChild(this.mainFrame),this.mainFrameWindow=b.frames[f],d.modules.dispatcher.registerLoadWatcher(),this.mainFrameWindow.location.href=i,e.appendChild(this.workerFrame),this.workerFrameWindow=b.frames[g],d.localIndexHtml?this.workerFrameWindow.document.write(d.localIndexHtml):this.workerFrameWindow.location.href=R(),e.appendChild(this.chooseJobFrame),this.chooseJobFrameWindow=b.frames[h],this.setSize=function(a){c===a&&(a="big"===t?"small":"big"),t=a,M()},this.setSize("big"),setInterval(M,2e3)},refreshPage:function(){this.mainFrameWindow.location.reload()},reportingMousePointerClick:function(b,c){for(var e,f,g,h=d.modules.ui.mainFrameWindow.document.elementFromPoint(b,c),i=[];h&&"BODY"!==h.nodeName&&"HTML"!==h.nodeName&&h!==a;){var j=[];for(f=h.attributes.length-1;f>=0;f--)g=h.attributes[f].name,"id"!==g&&"class"!==g&&j.push({n:g,v:h.attributes[f].value});for(e=h,f=0;e;e=e.previousElementSibling)e.nodeName===h.nodeName&&f++;i.unshift({element:h.nodeName.toLowerCase(),attrs:j,classes:h.className.split(" ").filter(function(a){return a}),id:h.id,index:f,text:String(h.textContent).length<200?String(h.innerText):""}),h=h.parentNode}d.modules.dispatcher.postMessageToWorker("mousePointer",{x:b,y:c,stack:i})},startReportingMousePointer:function(){if(Q(!0),!u){var c=a.createElement("div");c.style.height=b.innerHeight+"px",c.style.width=b.innerWidth+"px",c.zindex=1e3,c.style.position="absolute",c.style.left="0px",c.style.top="0px",c.style.backgroundColor="transparent",a.getElementsByTagName("body")[0].appendChild(c),u=c;var e,f;c.addEventListener("mousemove",function(a){e=a.clientX,f=a.clientY},!1),c.addEventListener("click",function(){a.getElementsByTagName("body")[0].removeChild(u),u=!1,d.modules.dispatcher.reflectMessage({cmd:"reportingMousePointerClick",x:e,y:f})||d.modules.ui.reportingMousePointerClick(e,f)})}},preventPageReload:function(){setInterval(function(){b.onbeforeunload=function(){return setTimeout(function(){d.modules.ui.mainFrameWindow.location.reload()},0),"This will cause CartFiller to reload. Choose not to reload if you want just to refresh the main frame."}},2e3)},getMessageToSay:function(){return n},highlightElementForQueryBuilder:function(a){if(a){for(var b=this.mainFrameWindow.document.getElementsByTagName("body")[0],c=0;c<a.length;c++){for(var d=a[c][0],e=b.children.length,f=0;e>f;f++)if(b.children[f].nodeName.toLowerCase()===d){if(!a[c][1]){b=b.children[f],d=!1;break}a[c][1]--}if(d)return void this.arrowToSingleElementNoScroll()}this.arrowToSingleElementNoScroll(b)}else this.arrowToSingleElementNoScroll()},setSerializedAssets:function(a){if(null!==a.iframes)for(var b=0;b<a.iframes.length;b++)m[a.iframes[b].path.join("/")]=a.iframes[b];null!==a.arrows&&(j=a.arrows),null!==a.highlighted&&(k=a.highlighted),null!==a.say&&(n=a.say)},trackIframePosition:function(a,b){j=[],k=[],n="",l[b.join("/")]={element:a,path:b}}})}.call(this,document,window)}).call({cartFillerConfiguration:{},cartFillerEval:this.cartFillerEval});