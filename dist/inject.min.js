/*
 *  cartFiller - v0.0.1
 *  Tool for automating cart filling process when doing big purchases
 *  https://andrey012.github.com/cartFiller
 *
 *  Made by Andrey Grinenko
 *  Under MIT License
 */
(function(){(function(a,b,c){"use strict";var d,e="undefined"!=typeof this.cartFillerConfiguration,f="undefined"!=typeof this.cartFillerEval;if(f&&!e?(b.cartFillerConfiguration={},d=b.cartFillerConfiguration):(this.cartFillerConfiguration={},d=this.cartFillerConfiguration),d.concatenated=e,d.scripts=[],d.launch=function(){"0"===String(d["data-type"])?this.modules.ui.framed(a,b):"1"===String(d["data-type"])?this.modules.ui.popup(a,b):alert("Type not specified, should be 0 for framed, 1 for popup")},d.baseUrl="",d["data-type"]=0,d["data-choose-job"]="",d["data-debug"]=!1,d["data-worker"]="",f)d.baseUrl=this.cartFillerEval[0],d["data-type"]=this.cartFillerEval[1],d["data-choose-job"]=this.cartFillerEval[2],d["data-debug"]=this.cartFillerEval[3],d["data-worker"]=this.cartFillerEval[4];else for(var g=a.getElementsByTagName("head")[0].getElementsByTagName("script"),h=g[g.length-1],i=h.attributes,j=i.length-1;j>=0;j--)/^data-/.test(i[j].name)&&("data-base-url"===i[j].name?d.baseUrl=i[j].value:d[i[j].name]=i[j].value);if(!e){var k=a.createElement("script");k.setAttribute("src",d.baseUrl+"/boot/helpers/loader.js"),a.getElementsByTagName("head")[0].appendChild(k)}}).call(this,document,window),function(a,b,c){"use strict";var d=this.cartFillerConfiguration;d.scripts.push({getName:function(){return"api"},registerWorker:function(a){return d.modules.dispatcher.registerWorker(a,this),this},result:function(a,b){return d.modules.dispatcher.submitWorkerResult(a,b),this},nop:function(){return d.modules.dispatcher.submitWorkerResult("","nop"),this},onload:function(a){return d.modules.dispatcher.registerWorkerOnloadCallback(a),this},waitFor:function(a,b,e,f){c===e&&(e=2e4),c===f&&(f=200);var g=Math.round(e/f),h=function(){var c=a();!1!==d.modules.dispatcher.getWorkerCurrentStepIndex()&&(c?b(c):(g--,g>0?setTimeout(h,f):b(!1)))};return setTimeout(h,f),this},highlight:function(a,b){return d.modules.ui.highlight(a,b),d.modules.dispatcher.setHighlightedElement(a),this}})}.call(this,document,window),function(document,window,undefined){"use strict";var worker=!1,workerCurrentTask={},workerCurrentTaskIndex=!1,workerCurrentStepIndex=!1,workerOnLoadHandler=!1,resultMessageName=!1,mainFrameLoaded=!1,workerFrameLoaded=!1,bootstrapped=!1,highlightedElement=!1,me=this.cartFillerConfiguration,postMessage=function(a,b,c,d){undefined===d&&(d="cartFillerMessage"),undefined===c&&(c={}),c.cmd=b,a.postMessage(d+":"+JSON.stringify(c),"*")},resetWorker=function(){workerCurrentTaskIndex=workerCurrentStepIndex=workerOnLoadHandler=!1};this.cartFillerConfiguration.scripts.push({getName:function(){return"dispatcher"},init:function(){var a=this;window.addEventListener("message",function(b){var c=/^cartFillerMessage:(.*)$/,d=c.exec(b.data);if(null!=d){var e=JSON.parse(d[1]),f="onMessage_"+e.cmd;a[f](e)}},!1)},onMessage_register:function(){workerFrameLoaded=!0,mainFrameLoaded&&!bootstrapped&&this.bootstrapCartFiller()},onMessage_makeSmaller:function(){me.modules.ui.setSize("small")},onMessage_makeBigger:function(){me.modules.ui.setSize("big")},onMessage_toggleSize:function(){me.modules.ui.setSize()},onMessage_chooseJob:function(){me.modules.ui.showHideChooseJobFrame(!0)},onMessage_chooseJobCancel:function(){me.modules.ui.showHideChooseJobFrame(!1)},onMessage_jobDetails:function(a){resultMessageName=a.resultMessage?a.resultMessage:!1,me.modules.ui.showHideChooseJobFrame(!1),a.overrideWorkerSrc=me["data-worker"],this.postMessageToWorker("jobDetails",a)},onMessage_sendResult:function(a){me.modules.ui.showHideChooseJobFrame(!0),resultMessageName&&this.postMessageToChooseJob(resultMessageName,a)},onMessage_loadWorker:function(message){try{eval(message.code)}catch(e){throw alert(e),e}},onMessage_invokeWorker:function(a){if(!1!==workerCurrentTaskIndex||!1!==workerCurrentStepIndex){var b="ERROR: worker task is in still in progress";alert(b),this.postMessage("workerStepResult",{index:a.index,step:a.step,result:b})}else{if(workerCurrentTaskIndex!==a.index){for(var c in workerCurrentTask)delete workerCurrentTask[c];for(var d in a.details)workerCurrentTask[d]=a.details[d]}workerCurrentTaskIndex=a.index,workerCurrentStepIndex=a.step;var e={stepIndex:a.index,task:a.details};try{worker[a.task][2*a.step+1](highlightedElement,e)}catch(b){throw alert(b),b}}},onMessage_resetWorker:function(){resetWorker()},onMessage_closePopup:function(){me.modules.ui.closePopup()},onMainFrameLoaded:function(a){mainFrameLoaded=!0,workerFrameLoaded&&!bootstrapped&&this.bootstrapCartFiller(),workerOnLoadHandler&&(workerOnLoadHandler(a),workerOnLoadHandler=!1)},postMessageToWorker:function(a,b){postMessage(me.modules.ui.workerFrameWindow,a,b)},postMessageToChooseJob:function(a,b){postMessage(me.modules.ui.chooseJobFrameWindow,a,b,a)},bootstrapCartFiller:function(){bootstrapped=!0,this.postMessageToWorker("bootstrap",{lib:me.baseUrl.replace(/(src|dist)\/?$/,"lib/"),debug:me["data-debug"]})},registerWorker:function(a,b){worker=a(me.modules.ui.mainFrameWindow,undefined,b,workerCurrentTask);var c={};for(var d in worker)if(worker.hasOwnProperty(d)){for(var e=[],f=0;f<worker[d].length;f++)"string"==typeof worker[d][f]&&e.push(worker[d][f]);c[d]=e}this.postMessageToWorker("workerRegistered",{jobTaskDescriptions:c})},submitWorkerResult:function(a,b){var c;if(undefined===a||""===a)c="ok";else{if("string"!=typeof a)throw"invalid message type "+typeof a;c=b?"skip":"error"}this.postMessageToWorker("workerStepResult",{index:workerCurrentTaskIndex,step:workerCurrentStepIndex,status:c,message:a,nop:"nop"===b}),resetWorker()},registerWorkerOnloadCallback:function(a){workerOnLoadHandler=a},getWorkerCurrentStepIndex:function(){return workerCurrentStepIndex},setHighlightedElement:function(a){highlightedElement=a}})}.call(this,document,window),function(a,b,c){"use strict";var d=["dispatcher","ui","api"],e=this,f=function(){for(var a=d.length-1;a>=0;a--){for(var c=!1,f=e.cartFillerConfiguration.scripts.length-1;f>=0;f--)if(e.cartFillerConfiguration.scripts[f].getName()===d[a]){c=!0;break}if(!c)return}b.cartFillerAPI=function(){return e.cartFillerConfiguration.modules.api},e.cartFillerConfiguration.modules={};for(var g=e.cartFillerConfiguration.scripts.length-1;g>=0;g--){var h=e.cartFillerConfiguration.scripts[g];e.cartFillerConfiguration.modules[h.getName()]=h}e.cartFillerConfiguration.launch()};if(this.cartFillerConfiguration.scripts.push=function(a){Array.prototype.push.call(this,a),f()},!this.cartFillerConfiguration.concatenated)for(var g=a.getElementsByTagName("head")[0],h=d.length-1;h>=0;h--){var i=a.createElement("script");i.setAttribute("src",this.cartFillerConfiguration.baseUrl+"/boot/helpers/"+d[h]+".js"),g.appendChild(i)}}.call(this,document,window),function(a,b,c){"use strict";var d,e=this.cartFillerConfiguration,f="cartFillerOverlayDiv",g="cartFillerMainFrame",h="cartFillerWorkerFrame",i="cartFillerChooseJobFrame",j=function(){return e.modules.ui.mainFrameWindow.document},k=function(){return j().documentElement.scrollLeft||j().body.scrollLeft},l=function(){return j().documentElement.scrollTop||j().body.scrollTop},m=function(a,b,c,d){a=Math.round(a),b=Math.round(b),c=Math.round(c),d=Math.round(d);var e=j().createElement("div");e.style.position="absolute",e.style.left=a+"px",e.style.top=b+"px",e.style.width=c-a+"px",e.style.height=d-b+"px",e.style.backgroundColor="rgba(0,0,0,0.3)",e.style.zIndex=1e5,e.className=f,e.onclick=function(){o()},j().getElementsByTagName("body")[0].appendChild(e)},n=function(a,b,c,d){for(var f,g,h=(c+a)/2,i=(d+b)/2,m=h-j().documentElement.clientWidth/2,n=i-j().documentElement.clientHeight/2,o=1e3;o&&(f=k(),g=l(),e.modules.ui.mainFrameWindow.scrollBy(m-f,n-g),k()!==f||l()!==g);o--);},o=function(){for(var a=j().getElementsByClassName(f),b=a.length-1;b>=0;b--)a[b].parentNode.removeChild(a[b])},p=function(){return e.baseUrl+"/index.html"};e.scripts.push({getName:function(){return"ui"},setSize:function(){},showHideChooseJobFrame:function(a){this.chooseJobFrame.style.display=a?"block":"none"},closePopup:function(){},highlight:function(a,b){var d;c!==this.mainFrameWindow.jQuery&&a instanceof this.mainFrameWindow.jQuery?1>a.length?a=c:!0===b?(d={left:c,right:c,top:c,bottom:c},a.each(function(a,b){var e=b.getBoundingClientRect();d.left=c===d.left?e.left:Math.min(d.left,e.left),d.right=c===d.right?e.right:Math.max(d.right,e.right),d.top=c===d.top?e.top:Math.min(d.top,e.top),d.bottom=c===d.bottom?e.bottom:Math.max(d.bottom,e.bottom)})):d=a[0].getBoundingClientRect():c!==a&&(d=a.getBoundingClientRect());var e=this.mainFrameWindow.document.getElementsByTagName("body")[0],f=e.getBoundingClientRect(),g=l(),h=k(),i=Math.max(f.right+h,e.scrollWidth,this.mainFrameWindow.innerWidth)-1,j=Math.max(f.bottom+g,e.scrollHeight,this.mainFrameWindow.innerHeight)-1;if(o(),c!==a){var p=5;m(0,0,Math.max(0,d.left+h-p),j),m(Math.min(i,d.right+h+p),0,i,j),m(Math.max(0,d.left+h-p),0,Math.min(i,d.right+h+p),Math.min(j,d.top+g-p)),m(Math.max(0,d.left+h-p),Math.max(0,d.bottom+g+p),Math.min(i,d.right+h+p),j),n(d.left+h,d.top+g,d.right+h,d.bottom+g)}else m(0,0,i,j)},popup:function(a,b){var f=b.innerWidth,g=b.innerHeight,j=.02*f,k=.76*f,l=.02*g,m=.96*g,n=.8*f-1,o=.2*f-1;e.modules.dispatcher.init(),this.mainFrameWindow=b.open(b.location.href,"_blank","height="+Math.round(b.outerHeight)+", width="+Math.round(.8*b.outerWidth)),this.closePopup=function(){this.mainFrameWindow.close()},this.mainFrameWindow.addEventListener("load",function(){e.modules.dispatcher.onMainFrameLoaded()},!0);var q=this;setTimeout(function s(){q.mainFrameWindow.document&&"complete"===q.mainFrameWindow.document.readyState&&e.modules.dispatcher.onMainFrameLoaded(!0),setTimeout(s,100)},100);for(var r=b.document.getElementsByTagName("body")[0];r.children.length;)r.removeChild(r.children[0]);this.setSize=function(a){c===a&&(a="big"===d?"small":"big"),d=a,"big"===a?(this.workerFrame.style.width=n+"px",this.workerFrame.style.left=f-n-5+"px"):"small"===a&&(this.workerFrame.style.width=o+"px",this.workerFrame.style.left=f-o-5+"px")},this.workerFrame=b.document.createElement("iframe"),this.workerFrame.setAttribute("name",h),this.workerFrame.style.position="fixed",this.workerFrame.style.top="0px",this.workerFrame.style.height="100%",this.workerFrame.style.zIndex="100000",this.setSize("big"),r.appendChild(this.workerFrame),this.workerFrameWindow=b.frames[h],this.workerFrameWindow.location.href=p(),this.chooseJobFrame=b.document.createElement("iframe"),this.chooseJobFrame.setAttribute("name",i),this.chooseJobFrame.style.position="fixed",this.chooseJobFrame.style.height=m+"px",this.chooseJobFrame.style.top=l+"px",this.chooseJobFrame.style.left=j+"px",this.chooseJobFrame.style.width=k+"px",this.chooseJobFrame.style.zIndex="1000000",this.chooseJobFrame.style.background="white",r.appendChild(this.chooseJobFrame),this.chooseJobFrameWindow=b.frames[i],this.chooseJobFrameWindow.location.href=e["data-choose-job"]},framed:function(a,b){e.modules.dispatcher.init();for(var d=a.getElementsByTagName("body")[0],f=b.location.href,j=e["data-choose-job"],k=b.innerWidth,l=b.innerHeight,m=.8*k-1,n=.2*k-1,o=.8*k-1,q=.2*k-1,r=l-15,s=.02*k,t=.76*k,u=.02*l,v=.96*l,w="big";d.children.length;)d.removeChild(d.children[0]);this.mainFrame=a.createElement("iframe"),this.mainFrame.setAttribute("name",g),this.mainFrame.style.height=r+"px",this.mainFrame.style.position="fixed",this.mainFrame.style.left="0px",this.mainFrame.style.top="0px",this.workerFrame=a.createElement("iframe"),this.workerFrame.setAttribute("name",h),this.workerFrame.style.height=r+"px",this.workerFrame.style.position="fixed",this.workerFrame.style.top="0px",this.chooseJobFrame=a.createElement("iframe"),this.chooseJobFrame.setAttribute("name",i),this.chooseJobFrame.style.display="none",this.chooseJobFrame.style.height=v+"px",this.chooseJobFrame.style.top=u+"px",this.chooseJobFrame.style.left=s+"px",this.chooseJobFrame.style.width=t+"px",this.chooseJobFrame.style.position="fixed",this.chooseJobFrame.style.background="white",d.appendChild(this.mainFrame),this.mainFrameWindow=b.frames[g],this.mainFrame.onload=function(){e.modules.dispatcher.onMainFrameLoaded()},this.mainFrameWindow.location.href=f,d.appendChild(this.workerFrame),this.workerFrameWindow=b.frames[h],this.workerFrameWindow.location.href=p(),d.appendChild(this.chooseJobFrame),this.chooseJobFrameWindow=b.frames[i],this.chooseJobFrameWindow.location.href=j,this.setSize=function(a){c===a&&(a="big"===w?"small":"big"),w=a,"big"===a?(this.workerFrame.style.width=o+"px",this.mainFrame.style.width=n+"px",this.workerFrame.style.left=n+"px"):"small"===a&&(this.workerFrame.style.width=q+"px",this.mainFrame.style.width=m+"px",this.workerFrame.style.left=m+"px")},this.setSize("big")}})}.call(this,document,window)}).call({cartFillerConfiguration:{},cartFillerEval:this.cartFillerEval});