/*
 *  cartFiller - v0.0.1
 *  Tool for automating cart filling process when doing big purchases
 *  https://andrey012.github.com/cartFiller
 *
 *  Made by Andrey Grinenko
 *  Under MIT License
 */
(function(){(function(a,b){"use strict";var c,d="undefined"!=typeof this.cartFillerConfiguration,e="undefined"!=typeof this.cartFillerEval;if(e&&!d?(b.cartFillerConfiguration={},c=b.cartFillerConfiguration):(this.cartFillerConfiguration={},c=this.cartFillerConfiguration),c.concatenated=d,c.scripts=[],c.launch=function(){b.opener&&b.opener!==b?this.modules.dispatcher.startSlaveMode():"0"===String(c["data-type"])?this.modules.ui.framed(a,b):"1"===String(c["data-type"])?this.modules.ui.popup(a,b):alert("Type not specified, should be 0 for framed, 1 for popup")},c.baseUrl="",c["data-type"]=0,c["data-choose-job"]="",c["data-debug"]=!1,c["data-worker"]="",c.gruntBuildTimeStamp="1459891814021",e)c.baseUrl=this.cartFillerEval[0],c["data-type"]=this.cartFillerEval[1],c["data-choose-job"]=this.cartFillerEval[2],c["data-debug"]=this.cartFillerEval[3],c["data-worker"]=this.cartFillerEval[4];else{var f,g=a.getElementsByTagName("head")[0].getElementsByTagName("script");for(f=0;f<g.length;f++){var h=g[f];if(null!==h.getAttribute("data-type")&&null!==h.getAttribute("data-base-url")&&null!==h.getAttribute("data-choose-job")){for(var i=h.attributes,j=i.length-1;j>=0;j--)/^data-/.test(i[j].name)&&("data-base-url"===i[j].name?c.baseUrl=i[j].value:c[i[j].name]=i[j].value);break}}}if(!d){var k=a.createElement("script");k.setAttribute("src",c.baseUrl+"/boot/helpers/loader.js"),a.getElementsByTagName("head")[0].appendChild(k)}}).call(this,document,window),function(a,b,c){"use strict";var d=this.cartFillerConfiguration;d.scripts.push({getName:function(){return"api"},registerWorker:function(a){return d.modules.dispatcher.registerWorker(a,this),this},result:function(a,b,c){return d.modules.dispatcher.submitWorkerResult(a,b,c),this},skipTask:function(){return d.modules.dispatcher.manageTaskFlow("skipTask"),this},repeatTask:function(){return d.modules.dispatcher.manageTaskFlow("repeatTask"),this},nop:function(){return d.modules.dispatcher.submitWorkerResult("","nop"),this},onload:function(a){return c===a&&(a=function(){d.modules.api.result()}),d.modules.dispatcher.registerWorkerOnloadCallback(a),this},waitFor:function(a,b,e,f){c===e&&(e=2e4),c===f&&(f=200);var g=Math.round(e/f);b||(b=""),"string"==typeof b&&(b=function(a){return function(b){d.modules.api.result(b?"":a.length?a:"timeout")}}(b));var h=function(){var c;try{c=a()}catch(e){return void d.modules.dispatcher.reportErrorResult(e)}if(!1!==d.modules.dispatcher.getWorkerCurrentStepIndex())if(c)try{b(c)}catch(e){return void d.modules.dispatcher.reportErrorResult(e)}else if(g--,g>0)d.modules.api.setTimeout(h,f);else try{b(!1)}catch(e){return void d.modules.dispatcher.reportErrorResult(e)}};return d.modules.api.setTimeout(h,f),this},highlight:function(a,b){try{d.modules.ui.highlight(a,b),d.modules.dispatcher.setHighlightedElement(a)}catch(c){}return this},arrow:function(a,b){try{d.modules.ui.arrowTo(a,b),d.modules.dispatcher.setHighlightedElement(a)}catch(c){}return this},say:function(a){return d.modules.ui.say(a),this},each:function(a,b,d){var e,f=!1;if(a instanceof Array||a.constructor&&("HTMLCollection"===a.constructor.name||"[object HTMLCollection]"===String(a.constructor)||"NodeListConstructor"===a.constructor.name||"[object NodeListConstructor]"===String(a.constructor))||"[object NodeList]"===String(a)){for(e=0;e<a.length;e++)if(!1===b(e,a[e])){f=!0;break}}else if(null!==a&&"object"==typeof a&&"string"==typeof a.jquery&&c!==a.length&&"function"==typeof a.each)a.each(function(a,c){var d=b(a,c);return!1===d&&(f=!0),d});else for(e in a)if(a.hasOwnProperty(e)&&!1===b(e,a[e])){f=!0;break}!f&&d instanceof Function&&d()},compare:function(a,b){if(a=String(a),b=String(b),a===b)return"";for(var c="[",d=0;d<Math.max(a.length,b.length);d++){if(a.substr(d,1)!==b.substr(d,1)){c+="] <<< expected: ["+a.substr(d)+"], have: ["+b.substr(d)+"]";break}c+=a.substr(d,1)}return c},setTimeout:function(a,b){d.modules.dispatcher.registerWorkerSetTimeout(setTimeout(a,b))},setInterval:function(a,b){d.modules.dispatcher.registerWorkerSetInterval(setInterval(a,b))},click:function(a){return["click",function(b){"object"==typeof b&&"string"==typeof b.jquery&&c!==b.length?b[0].click():b instanceof Array?b[0].click():b.click(),c===a?d.modules.api.result():a()}]},openRelay:function(a,b){d.modules.dispatcher.openRelayOnTheTail(a,b)},registerOnloadCallback:function(a,b){d.modules.dispatcher.registerEventCallback("onload",b?a:"",b?b:a)},type:function(a,b){return["type key sequence",function(e){var f;f="object"==typeof e&&"string"==typeof e.jquery&&c!==e.length?e[0]:e instanceof Array?e[0]:e,f.focus();var g;if(a instanceof Function)g=a();else if(c!==d.modules.dispatcher.getWorkerTask()[a])g=d.modules.dispatcher.getWorkerTask()[a];else{if(c===d.modules.dispatcher.getWorkerGlobals()[a])return void d.modules.api.result("Value ty type ["+a+"] not found neither in the task properties nor in globals");g=d.modules.dispatcher.getWorkerGlobals()[a]}var h=d.modules.ui.mainFrameWindow.document;d.modules.api.each(g.split(""),function(a,b){var c=b.charCodeAt(0),e={get:function(){return c}},g={get:function(){return!1}};for(var i in{keydown:0,keypress:0,keyup:0}){var j=h.createEvent("KeyboardEvent");if(Object.defineProperty(j,"keyCode",e),Object.defineProperty(j,"charCode",e),Object.defineProperty(j,"metaKey",g),Object.defineProperty(j,"which",e),j.initKeyboardEvent?j.initKeyboardEvent(i,!0,!0,h.defaultView,!1,!1,!1,!1,c,c):j.initKeyEvent(i,!0,!0,h.defaultView,!1,!1,!1,!1,c,c),j.keyCode!==c||j.charCode!==c)return d.modules.api.result("could not set correct keyCode or charCode for "+i+": keyCode returns ["+j.keyCode+"] , charCode returns ["+j.charCode+"] instead of ["+c+"]"),!1;if(j.metaKey)return d.modules.api.result("could not set metaKey to false"),!1;f.dispatchEvent(j)&&"keypress"===i&&(f.value=f.value+b)}},function(){var a=new Event("change");f.dispatchEvent(a),d.modules.api.arrow(e),c===b?d.modules.api.result(""):b(e)})}]}})}.call(this,document,window),function(document,window,undefined){"use strict";var worker=!1,workerSourceCodes={},workerCurrentTask={},workerCurrentTaskIndex=!1,workerCurrentStepIndex=!1,workerOnLoadHandler=!1,onLoadHappened=!1,workerTimeout=0,workerSetTimeoutIds=[],workerSetIntervalIds=[],workerWatchdogId=!1,workerGlobals={},workerEventListeners={},resultMessageName=!1,statusMessageName=!1,mainFrameLoaded=!1,workerFrameLoaded=!1,workerCurrentUrl=!1,bootstrapped=!1,highlightedElement=!1,jobDetailsCache={},stepRepeatCounter=0,currentStepEnv={},currentStepWorkerFn,me=this.cartFillerConfiguration,relay={isSlave:!1,nextRelay:!1,nextRelayRegistered:!1,nextRelayQueue:[],knownUrls:{},bubbleMessage:function(a){this.isSlave&&postMessage(window.opener,"bubbleRelayMessage",a),this.nextRelay&&(this.nextRelayRegistered?postMessage(this.nextRelay,"bubbleRelayMessage",a):(a.cmd="bubbleRelayMessage",this.nextRelayQueue.push(a)))}},callEventCallbacks=function(a){if(undefined!==workerEventListeners[a])for(var b in workerEventListeners[a])workerEventListeners[a][b]()},postMessage=function(a,b,c,d){undefined===d&&(d="cartFillerMessage"),undefined===c&&(c={}),c.cmd=b,a.postMessage(d+":"+JSON.stringify(c),"*")},resetWorker=function(){workerCurrentTaskIndex=workerCurrentStepIndex=workerOnLoadHandler=!1},fillWorkerCurrentTask=function(a){for(var b in workerCurrentTask)workerCurrentTask.hasOwnProperty(b)&&delete workerCurrentTask[b];for(var c in a)a.hasOwnProperty(c)&&(workerCurrentTask[c]=a[c])},fillWorkerGlobals=function(a){for(var b in workerGlobals)workerGlobals.hasOwnProperty(b)&&delete workerGlobals[b];for(var c in a)a.hasOwnProperty(c)&&(workerGlobals[c]=a[c])},getLibUrl=function(){return me.baseUrl.replace(/(src|dist)\/?$/,"lib/")},nextTaskFlow,clearRegisteredTimeoutsAndIntervals=function(){for(;workerSetTimeoutIds.length;)clearTimeout(workerSetTimeoutIds.pop());for(;workerSetIntervalIds.length;)clearInterval(workerSetIntervalIds.pop())},registerWorkerWatchdog=function(){workerWatchdogId&&workerWatchdogId!==!0?removeWatchdogHandler():workerWatchdogId=!1,workerWatchdogId=workerTimeout?setTimeout(function(){workerWatchdogId=!1,workerOnLoadHandler=!1,me.modules.api.result("Timeout happened, worker step cancelled")},workerTimeout):!0},removeWatchdogHandler=function(){workerWatchdogId&&(workerWatchdogId!==!0&&clearTimeout(workerWatchdogId),workerWatchdogId=!1)},openRelay=function(a,b,c){relay.knownUrls[a]=!0,relay.nextRelay&&b?relay.nextRelayRegistered?postMessage(relay.nextRelay,b.cmd,b):relay.nextRelayQueue.push(b):(relay.nextRelay=window.open(a,"_blank","toolbar=yes, location=yes, status=yes, menubar=yes, scrollbars=yes"),c&&setTimeout(function(){relay.nextRelay.blur(),window.focus()},0),b&&relay.nextRelayQueue.push(b))};this.cartFillerConfiguration.scripts.push({getName:function(){return"dispatcher"},init:function(){var a=this;window.addEventListener("message",function(b){var c=/^cartFillerMessage:(.*)$/;if(c.test(b.data)){var d=c.exec(b.data),e=JSON.parse(d[1]);if(b.source===relay.nextRelay&&"register"!==e.cmd&&"bubbleRelayMessage"!==e.cmd)"workerStepResult"===e.cmd&&fillWorkerGlobals(e.globals),postMessage(relay.isSlave?window.opener:me.modules.ui.workerFrameWindow,e.cmd,e);else{var f="onMessage_"+e.cmd;undefined!==a[f]&&a[f]instanceof Function?a[f](e,b.source):console.log("unknown message: "+f+":"+b.data)}}},!1)},onMessage_register:function(a,b){if(b===me.modules.ui.workerFrameWindow)workerFrameLoaded=!0,mainFrameLoaded&&!bootstrapped&&this.bootstrapCartFiller();else if(b===me.modules.ui.chooseJobFrameWindow)this.postMessageToChooseJob("bootstrap",{lib:getLibUrl(),testSuite:!0,src:me.baseUrl.replace(/\/$/,"")+"/"},"cartFillerMessage");else if(b===relay.nextRelay){relay.nextRelayRegistered=!0;var c;for(c in workerSourceCodes)workerSourceCodes.hasOwnProperty(c)&&relay.nextRelayQueue.push({cmd:"loadWorker",url:c,code:workerSourceCodes[c]});for(var d;relay.nextRelayQueue.length;)d=relay.nextRelayQueue.shift(),postMessage(relay.nextRelay,d.cmd,d)}},onMessage_makeSmaller:function(){me.modules.ui.setSize("small")},onMessage_makeBigger:function(){me.modules.ui.setSize("big")},onMessage_toggleSize:function(){me.modules.ui.setSize()},onMessage_chooseJob:function(){me.modules.ui.showHideChooseJobFrame(!0),this.postMessageToWorker("chooseJobShown")},onMessage_chooseJobCancel:function(){me.modules.ui.showHideChooseJobFrame(!1),this.postMessageToWorker("chooseJobHidden")},onMessage_jobDetails:function(a){var b=function(a){if(!(a instanceof Array)){var b=[];for(c=0;"undefined"!=typeof a[c];c++)b.push(a[c]);a=b}return a};if(undefined!==a.details){workerSourceCodes={},resultMessageName=a.resultMessage?a.resultMessage:!1,statusMessageName=a.statusMessage?a.statusMessage:!1,me.modules.ui.showHideChooseJobFrame(!1),a.overrideWorkerSrc=me["data-worker"],workerTimeout=a.timeout,workerCurrentTask={},resetWorker();var c;for(c in jobDetailsCache)jobDetailsCache.hasOwnProperty(c)&&delete jobDetailsCache[c];for(c in a)jobDetailsCache[c]=a[c];worker={},workerGlobals=a.globals=a.globals?a.globals:{},a.details=b(a.details),workerEventListeners={}}else{if(undefined===a.$cartFillerTestUpdate){if(undefined!==a.$preventPageReload)return void me.modules.ui.preventPageReload();throw"unknown job details package - should have either details or $cartFillerTestUpdate"}a.$cartFillerTestUpdate.details=b(a.$cartFillerTestUpdate.details)}this.postMessageToWorker("jobDetails",a)},onMessage_sendResult:function(a){me.modules.ui.showHideChooseJobFrame(!0),resultMessageName&&this.postMessageToChooseJob(resultMessageName,a)},onMessage_sendStatus:function(a){statusMessageName&&this.postMessageToChooseJob(statusMessageName,a)},onMessage_loadWorker:function(message){try{workerSourceCodes[message.src]=message.code,eval(message.code),relay.nextRelay&&postMessage(relay.nextRelay,message.cmd,message)}catch(e){throw alert(e),e}},onMessage_updateProperty:function(a){parseInt(a.index)===parseInt(workerCurrentTaskIndex)&&(workerCurrentTask[a.name]=a.value)},onMessage_invokeWorker:function(a){a.globals&&fillWorkerGlobals(a.globals);try{me.modules.ui.say()}catch(b){}if(!this.reflectMessage(a))if(!1!==workerCurrentStepIndex){var c="ERROR: worker task is in still in progress";alert(c)}else{stepRepeatCounter=0,onLoadHappened=!1,nextTaskFlow="normal",workerCurrentTaskIndex!==a.index&&(fillWorkerCurrentTask(a.details),me.modules.api.arrow().highlight()),workerCurrentTaskIndex=a.index,workerCurrentStepIndex=a.step,currentStepEnv={taskIndex:a.index,stepIndex:a.step,task:a.details,repeatCounter:a.repeatCounter,params:{}};try{if(undefined===worker[a.task])alert("invalid worker - no function for "+a.task+" exist");else if(undefined===worker[a.task][2*a.step+1])alert("invalid worker - function for "+a.task+" step "+a.step+" does not exist");else{var d=worker[a.task][2*a.step+1];if("function"!=typeof d){if("function"!=typeof d[0])return void alert("invalid worker - function for "+a.task+" step "+a.step+" is not a function");env.params=d[1],d=d[0]}if(registerWorkerWatchdog(),a.debug)debugger;currentStepWorkerFn=d,d(highlightedElement,currentStepEnv)}}catch(c){throw this.reportErrorResult(c),c}}},reportErrorResult:function(a){if(console.log(a),workerWatchdogId){var b=String(a);b||(b="unknown exception"),me.modules.api.result(b,!1)}},onMessage_focusMainFrameWindow:function(){me.modules.ui.focusMainFrameWindow()},onMessage_resetWorker:function(a){this.reflectMessage(a)||resetWorker()},onMessage_closePopup:function(){me.modules.ui.closePopup()},onMessage_helloFromPlugin:function(a){this.postMessageToChooseJob(a.message,{})},onMessage_refreshPage:function(a){this.reflectMessage(a)||me.modules.ui.refreshPage()},onMessage_startReportingMousePointer:function(){me.modules.ui.startReportingMousePointer()},onMessage_evaluateCssSelector:function(details){this.postMessageToWorker("cssSelectorEvaluateResult",{count:eval('(function(j){j.each(function(i,el){(function(o){if (o !== "0") {el.style.opacity=0; setTimeout(function(){el.style.opacity=o;},200);}})(el.style.opacity);}); return j.length;})(me.modules.ui.mainFrameWindow.jQuery'+details.selector+")")})},onMessage_bubbleRelayMessage:function(a,b){relay.isSlave&&b!==window.opener&&!a.notToParents&&postMessage(window.opener,a.cmd,a),relay.nextRelay&&b!==relay.nextRelay&&!a.notToChildren&&(relay.nextRelayRegistered?postMessage(relay.nextRelay,a.cmd,a):relay.nextRelayQueue.push(a)),"onMainFrameLoaded"===a.message?me.modules.dispatcher.onMainFrameLoaded(a.args[0],!0):"openRelayOnHead"!==a.message||relay.isSlave?"openRelayOnTail"!==a.message||relay.nextRelay||openRelay(a.args[0],undefined,a.args[1]):relay.knownUrls[a.args[0]]||me.modules.dispatcher.onMessage_bubbleRelayMessage({message:"openRelayOnTail",args:a.args,notToParents:!0})},onMainFrameLoaded:function(a,b){if(mainFrameLoaded=!0,workerFrameLoaded&&!bootstrapped?this.bootstrapCartFiller():b||relay.bubbleMessage({message:"onMainFrameLoaded",args:[a]}),workerOnLoadHandler){try{callEventCallbacks("onload"),workerOnLoadHandler(a)}catch(c){this.reportErrorResult(c)}workerOnLoadHandler=!1,onLoadHappened=!1}else onLoadHappened=!0},postMessageToWorker:function(a,b){postMessage(me.modules.ui.workerFrameWindow,a,b)},postMessageToChooseJob:function(a,b,c){postMessage(me.modules.ui.chooseJobFrameWindow,a,b,c?c:a)},bootstrapCartFiller:function(){bootstrapped=!0,this.postMessageToWorker("bootstrap",{lib:getLibUrl(),debug:me["data-debug"]})},registerWorker:function(a,b){var c=function(a,b){"undefined"==typeof b&&(b=[]);for(var d=0;d<a.length;d++)a[d]instanceof Array&&a[d].length>0&&"string"==typeof a[d][0]?c(a[d],b):b.push(a[d]);return b},d=a(me.modules.ui.mainFrameWindow,undefined,b,workerCurrentTask,jobDetailsCache,workerGlobals),e={};for(var f in d)d.hasOwnProperty(f)&&(worker[f]=c(d[f]));for(f in worker){for(var g=[],h=0;h<worker[f].length;h++)"string"==typeof worker[f][h]&&g.push(worker[f][h]);e[f]=g}this.postMessageToWorker("workerRegistered",{jobTaskDescriptions:e})},manageTaskFlow:function(a){nextTaskFlow=a},submitWorkerResult:function(a,b,c){if(workerCurrentStepIndex===!1)return void alert("You have invalid worker, result is submitted twice, please fix");var d;if(undefined===a||""===a)d="ok";else{if("string"!=typeof a)throw"invalid message type "+typeof a;d=b?"skip":"error"}if(removeWatchdogHandler(),clearRegisteredTimeoutsAndIntervals(),"ok"!==d){stepRepeatCounter++;var e=/repeat(\d+)/.exec(currentStepWorkerFn.toString());if(e&&e[1]>stepRepeatCounter)return void setTimeout(function(){currentStepWorkerFn(highlightedElement,currentStepEnv)},1e3)}this.postMessageToWorker("workerStepResult",{index:workerCurrentTaskIndex,step:workerCurrentStepIndex,status:d,message:a,response:c,nop:"nop"===b,nextTaskFlow:nextTaskFlow,globals:workerGlobals}),workerCurrentStepIndex=workerOnLoadHandler=!1},registerWorkerOnloadCallback:function(a){if(onLoadHappened){try{callEventCallbacks("onload"),a(!0)}catch(b){this.reportErrorResult(b)}workerOnLoadHandler=!1}else workerOnLoadHandler=a},getWorkerCurrentStepIndex:function(){return workerCurrentStepIndex},setHighlightedElement:function(a){highlightedElement=a},registerWorkerSetTimeout:function(a){workerSetTimeoutIds.push(a)},registerWorkerSetInterval:function(a){workerSetIntervalIds.push(a)},updateCurrentUrl:function(a){workerCurrentUrl!==a&&(this.postMessageToWorker("currentUrl",{url:a}),workerCurrentUrl=a)},reflectMessage:function(a){var b=!0;try{me.modules.ui.mainFrameWindow.location.href}catch(c){b=!1}return b?!1:("invokeWorker"===a.cmd&&(a.globals=workerGlobals),openRelay("about:blank",a),!0)},startSlaveMode:function(){for(var a=document.getElementsByTagName("body")[0];a.children.length;)a.removeChild(a.children[0]);var b=document.createElement("span");b.innerText="this frame is used by cartFiller as slave, do not close it",a.appendChild(b),worker={},me.modules.dispatcher.init(),window.opener.postMessage('cartFillerMessage:{"cmd":"register"}',"*"),me.modules.ui.chooseJobFrameWindow=me.modules.ui.workerFrameWindow=window.opener;for(var c=window.opener;c&&c!==c.opener;c=c.opener)c.frames.cartFillerMainFrame&&(me.modules.ui.mainFrameWindow=c.frames.cartFillerMainFrame);me.modules.ui.mainFrameWindow||alert("could not find mainFrameWindow in slave mode"),me.modules.dispatcher.registerLoadWatcher(),relay.isSlave=!0},registerLoadWatcher:function(){setTimeout(function a(){try{me.modules.ui.mainFrameWindow.document&&"complete"===me.modules.ui.mainFrameWindow.document.readyState&&!me.modules.ui.mainFrameWindow.document.getElementsByTagName("html")[0].getAttribute("data-cartfiller-reload-tracker")&&(me.modules.ui.mainFrameWindow.document.getElementsByTagName("html")[0].setAttribute("data-cartfiller-reload-tracker",0),me.modules.dispatcher.onMainFrameLoaded(!0))}catch(b){}setTimeout(a,100)},100)},openRelayOnTheTail:function(a,b){me.modules.dispatcher.onMessage_bubbleRelayMessage({message:"openRelayOnHead",args:[a,b],notToChildren:!0})},registerEventCallback:function(a,b,c){undefined===workerEventListeners[a]&&(workerEventListeners[a]={}),workerEventListeners[a][b]=c},getWorkerTask:function(){return workerCurrentTask},getWorkerGlobals:function(){return workerGlobals}})}.call(this,document,window),function(a,b){"use strict";var c=["dispatcher","ui","api"],d=this,e=function(){for(var a=c.length-1;a>=0;a--){for(var e=!1,f=d.cartFillerConfiguration.scripts.length-1;f>=0;f--)if(d.cartFillerConfiguration.scripts[f].getName()===c[a]){e=!0;break}if(!e)return}b.cartFillerAPI=function(){return d.cartFillerConfiguration.modules.api},d.cartFillerConfiguration.modules={};for(var g=d.cartFillerConfiguration.scripts.length-1;g>=0;g--){var h=d.cartFillerConfiguration.scripts[g];d.cartFillerConfiguration.modules[h.getName()]=h}d.cartFillerConfiguration.launch()};if(this.cartFillerConfiguration.scripts.push=function(a){Array.prototype.push.call(this,a),e()},!this.cartFillerConfiguration.concatenated)for(var f=a.getElementsByTagName("head")[0],g=c.length-1;g>=0;g--){var h=a.createElement("script");h.setAttribute("src",this.cartFillerConfiguration.baseUrl+"/boot/helpers/"+c[g]+".js"),f.appendChild(h)}}.call(this,document,window),function(a,b,c){"use strict";var d=this.cartFillerConfiguration,e="cartFillerOverlayDiv",f="cartFillerMainFrame",g="cartFillerWorkerFrame",h="cartFillerChooseJobFrame",i=!1,j=[],k=[],l="",m="",n=0,o=!1,p=!1,q="big",r=!1,s=function(){return d.modules.ui.mainFrameWindow},t=function(){return"rgba(255,0,0,0.3)"},u=function(){var a=s().document.createElement("div");return a.style.position="fixed",a.style.backgroundColor=t(),a.style.zIndex=R(),a.className=e,a.onclick=function(){N(!0)},s().document.getElementsByTagName("body")[0].appendChild(a),a},v=function(a,b,c){var d=u();d.style.left=a+"px",d.style.top=b+"px",d.style.width="20px",d.style.height=c+"px"},w=function(a,b,c){var d=u();d.style.left=a+"px",d.style.top=b+"px",d.style.width=c+"px",d.style.height="20px"},x=function(a,b){var c=u();c.style.left=a+"px",c.style.top=b-25+"px",c.style.width=c.style.height="0px",c.style.backgroundColor="transparent",c.style.borderTop=c.style.borderBottom="25px solid transparent",c.style.borderLeft="30px solid rgba(255,0,0,0.3)"},y=function(a,b){var c=u();c.style.left=a-25+"px",c.style.top=b+"px",c.style.width=c.style.height="0px",c.style.backgroundColor="transparent",c.style.borderLeft=c.style.borderRight="25px solid transparent",c.style.borderTop="30px solid rgba(255,0,0,0.3)"},z=function(a,b){if(c!==b.ownerDocument&&c!==b.ownerDocument.defaultView&&c!==b.ownerDocument.defaultView.parent&&b.ownerDocument.defaultView.parent!==b.ownerDocument.defaultView){var d=[];try{d=b.ownerDocument.defaultView.parent.document.getElementsByTagName("iframe")}catch(e){}for(var f=d.length-1;f>=0;f--){var g;try{g=d[f].contentDocument}catch(e){}var h;try{h=d[f].contentWindow}catch(e){}if(g===b.ownerDocument||b.ownerDocument!==c&&b.ownerDocument.defaultView===h){var i=d[f].getBoundingClientRect(),j={top:a.top+i.top,bottom:a.bottom+i.top,left:a.left+i.left,right:a.right+i.left,width:a.width,height:a.height};return z(j,d[f])}}}return a},A=function(a,b){var c=u();c.style.left=a-25+"px",c.style.top=b+"px",c.style.width=c.style.height="0px",c.style.backgroundColor="transparent",c.style.borderLeft=c.style.borderRight="25px solid transparent",c.style.borderBottom="30px solid rgba(255,0,0,0.3)"},B=function(a){var b,d,e,f,g,h,i,j=!1;for(b=a.length-1;b>=0;b--)h=a[b],i=h.element.getBoundingClientRect(),i=z(i,h.element),i.width>0||i.height>0||i.left>0||i.top>0?(d=Math.round(i.top-5),e=Math.round(i.left-5),g=Math.round(i.height+9),f=Math.round(i.width+9)):h.left=h.right=h.top=h.bottom=c,(d!==h.top||e!==h.left||g!==h.height||f!==h.width)&&(j=!0,h.top=d,h.left=e,h.height=g,h.width=f);return j},C=function(){var a,b,d,e;for(a=j.length-1;a>=0;a--){var f=j[a];if(f.left!==c){var g=u();g.style.backgroundColor="transparent",g.style.borderLeft=g.style.borderTop=g.style.borderRight=g.style.borderBottom="5px solid rgba(255,0,0,0.3)",g.style.left=f.left+"px",g.style.top=f.top+"px",g.style.width=f.width+"px",g.style.height=f.height+"px",g.style.boxSizing="border-box",f.left>40?(b=f.top+Math.round(f.height/2),v(0,0,b-10),w(0,b-10,f.left-30),x(f.left-30,b)):f.top>40?(d=f.left+Math.min(30,Math.round(f.width/2)),w(0,0,d-10),v(d-10,0,f.top-30),y(d,f.top-30)):(d=f.left+Math.min(30,Math.round(f.width/2)),e=f.top+f.height,w(0,e+60,d+10),v(d-10,e+30,30),A(d,e))}}},D=function(a,b){var d,e,f,g,h,i,j,k=[a,b];for(e=k.length-1;e>=0;e--)if(c!==k[e])for(d=k[e].length-1;d>=0;d--)j=k[e][d],f=c===f?j.left:Math.min(f,j.left),h=c===h?j.left+j.width:Math.max(h,j.left+j.width),g=c===g?j.top:Math.min(g,j.top),i=c===i?j.top+j.height:Math.max(i,j.top+j.height);return{left:f,right:h,top:g,bottom:i}},E=function(a){var b;for(b=a.length-1;b>=0;b--)a[b].left=a[b].top=a[b].width=a[b].height=c},F=function(){var a=D(k);if(a.left!==c){var b=d.modules.ui.mainFrameWindow.innerHeight,e=d.modules.ui.mainFrameWindow.innerWidth,f=5;L(0,0,Math.max(0,a.left-f),b),L(Math.min(e,a.right+f),0,e,b),L(Math.max(0,a.left-f),0,Math.min(e,a.right+f),Math.min(b,a.top-f)),L(Math.max(0,a.left-f),Math.max(0,a.bottom+f),Math.min(e,a.right+f),b)}},G=function(){var a=D(j,k);if(a.left===c&&(a={top:0,bottom:0,left:0,right:0}),"string"==typeof l&&l.length>0||"string"!=typeof l&&c!==l&&null!==l&&!isNaN(l)){var b=s().document.createElement("div");b.style.display="block",b.style.backgroundColor="#fff",b.style.padding="10px",b.style.fontSize="20px;",b.style.zIndex=R()+1,b.style.border="#bbb solid 10px",b.style.borderRadius="20px",b.style.overflow="auto",b.style.opacity="0",b.style.top=a.bottom+5+"px",b.style.left=Math.max(0,Math.round((a.left+a.right)/2)-o)+"px",b.style.width=o+"px",b.style.height="auto",b.style.position="fixed",b.style.fontSize="20px",b.className=e,b.textContent=l,b.onclick=function(){N(!0)},s().document.getElementsByTagName("body")[0].appendChild(b),n=100,d.modules.ui.adjustMessageDiv(b),m=l}},H=function(){try{var a=B(j),b=B(k),c=m!==l;(a||b||c)&&(N(),C(),F(),G())}catch(d){}},I={width:!1,height:!1,outerWidth:!1,outerHeight:!1,workerFrameSize:!1},J=function(){var a=b.innerWidth,c=b.innerHeight,e=p?!1:b.outerWidth,f=p?!1:b.outerHeight;if(d.modules.ui.mainFrameWindow&&d.modules.ui.mainFrameWindow.location){var g=!1;try{g=d.modules.ui.mainFrameWindow.location.href}catch(h){}g&&d.modules.dispatcher.updateCurrentUrl(g)}(I.width!==a||I.height!==c||I.outerWidth!==e||I.outerHeight!==f||I.workerFrameSize!==q)&&(!function(){var b=.8*a-1,g=.2*a-1,h=.8*a-1,i=.2*a-1,j=c-15,k=.02*a+(p?0:200),l=.76*a-(p?0:200),m=.02*c,n=.96*c;p&&(d.modules.ui.mainFrame.style.height=j+"px");try{d.modules.ui.workerFrame.style.height=j+"px"}catch(o){}try{d.modules.ui.chooseJobFrame.style.height=n+"px",d.modules.ui.chooseJobFrame.style.top=m+"px",d.modules.ui.chooseJobFrame.style.left=k+"px",d.modules.ui.chooseJobFrame.style.width=l+"px"}catch(o){}if("big"===q)if(p){try{d.modules.ui.workerFrame.style.width=h+"px",d.modules.ui.workerFrame.style.left=g+"px"}catch(o){}try{d.modules.ui.mainFrame.style.width=g+"px"}catch(o){}}else{try{d.modules.ui.mainFrameWindow.resizeTo(1,1)}catch(o){}try{d.modules.ui.workerFrame.style.width=h+"px",d.modules.ui.workerFrame.style.left=a-h-5+"px"}catch(o){}}else if("small"===q)if(p){try{d.modules.ui.workerFrame.style.width=i+"px",d.modules.ui.workerFrame.style.left=b+"px"}catch(o){}try{d.modules.ui.mainFrame.style.width=b+"px"}catch(o){}}else{try{d.modules.ui.mainFrameWindow.resizeTo(Math.round(.8*e-10),Math.round(f))}catch(o){}try{d.modules.ui.workerFrame.style.width=i+"px",d.modules.ui.workerFrame.style.left=a-i-5+"px"}catch(o){}}}(),I.width=a,I.height=c,I.outerWidth=e,I.outerHeight=f,I.workerFrameSize=q)},K=function(){return d.modules.ui.mainFrameWindow.document},L=function(a,b,c,d){a=Math.round(a),b=Math.round(b),c=Math.round(c),d=Math.round(d);var f=K().createElement("div");f.style.position="fixed",f.style.left=a+"px",f.style.top=b+"px",f.style.width=c-a+"px",f.style.height=d-b+"px",f.style.backgroundColor="rgba(0,0,0,0.3)",f.style.zIndex=R(),f.className=e,f.onclick=function(){N(!0)},K().getElementsByTagName("body")[0].appendChild(f)},M=function(a){var b,e,f,g,h,i,j,k=d.modules.ui.mainFrameWindow.innerHeight,l=d.modules.ui.mainFrameWindow.innerWidth;a.length>0&&"function"==typeof a[0].element.scrollIntoView&&a[0].element.scrollIntoView();for(var m=1e3;m&&(B(a),b=D(a),g=Math.round((b.right+b.left)/2),j=Math.round((b.bottom+b.top)/2),!(c!==e&&g>=e&&f>=g&&j>=h&&i>=j));m--)e=c===e?g:Math.min(e,g),f=c===f?g:Math.max(f,g),h=c===h?j:Math.min(h,j),i=c===i?j:Math.max(i,j),d.modules.ui.mainFrameWindow.scrollBy(g-Math.round(l/2),j-Math.round(k/2));E(a)},N=function(a){var b,c=K().getElementsByTagName("div");for(b=c.length-1;b>=0;b--)c[b].className===e&&c[b].parentNode.removeChild(c[b]);for(c=s().document.getElementsByTagName("div"),b=c.length-1;b>=0;b--)c[b].className===e&&c[b].parentNode.removeChild(c[b]);!0===a&&(j=k=[],l="")},O=function(){return d.baseUrl+"/index"+(d.concatenated?"":".uncompressed")+".html"+(d.gruntBuildTimeStamp?"?"+d.gruntBuildTimeStamp:"")},P=!1,Q=!1,R=function(){return 1e7};setInterval(H,200),d.scripts.push({getName:function(){return"ui"},setSize:function(){},showHideChooseJobFrame:function(a){a&&!i&&(this.chooseJobFrameWindow.location.href=d["data-choose-job"],i=!0),this.chooseJobFrame.style.display=a?"block":"none",this.setSize(a?"big":"small")},closePopup:function(){},focusMainFrameWindow:function(){},highlight:function(a,b){l="";var d,e=this.mainFrameWindow.document.getElementsByTagName("body")[0];if(e.style.paddingBottom=this.mainFrameWindow.innerHeight+"px",k=[],null!==a&&"object"==typeof a&&"string"==typeof a.jquery&&c!==a.length&&"function"==typeof a.each)a.each(function(a,c){return k.push({element:c}),b?void 0:!1});else if(a instanceof Array)for(d=a.length-1;d>=0&&(k.push({element:a[d]}),!0===b);d--);else c!==a&&k.push({element:a});k.length>0&&setTimeout(function(){M(k)},0)},arrowTo:function(a,b){if(j=[],null!==a&&"object"==typeof a&&"string"==typeof a.jquery&&c!==a.length&&"function"==typeof a.each)a.each(function(a,c){return j.push({element:c}),b?void 0:!1});else if(a instanceof Array)for(var d=0;d<a.length&&(j.push({element:a[d]}),b);d++);else c!==a?j.push({element:a}):(j=[],N(!0));j.length>0&&setTimeout(function(){M(j)},0)},say:function(a){l=c===a?"":a,o=Math.max(100,Math.round(.5*this.mainFrameWindow.innerWidth)),n=100},adjustMessageDiv:function(a){var b=this;setTimeout(function(){var c=!0;if(n>0){c=!1;var d=a.getBoundingClientRect();if(d.bottom>b.mainFrameWindow.innerHeight?d.width>.95*b.mainFrameWindow.innerWidth?d.top-(Q-P)-10<.05*b.mainFrameWindow.innerHeight?c=!0:b.mainFrameWindow.scrollBy(0,Math.round(.05*b.mainFrameWindow.innerHeight)):o=Math.min(b.mainFrameWindow.innerWidth,parseInt(a.style.width.replace("px",""))+Math.round(.04*b.mainFrameWindow.innerWidth)):c=!0,c){a.style.opacity="1";var e=a.parentNode;e&&e.removeChild(a),s().document.getElementsByTagName("body")[0].appendChild(a),n=0}else n--,E(j),E(k)}},0)},popup:function(a,b){d.modules.dispatcher.init(),this.mainFrameWindow=b.open(b.location.href,"_blank","resizable=1, height=1, width=1, scrollbars=1"),this.closePopup=function(){this.mainFrameWindow.close()},this.focusMainFrameWindow=function(){this.mainFrameWindow.focus()},d.modules.dispatcher.registerLoadWatcher();for(var e=b.document.getElementsByTagName("body")[0];e.children.length;)e.removeChild(e.children[0]);this.setSize=function(a){c===a&&(a="big"===q?"small":"big"),q=a,J(),"small"===a&&this.mainFrameWindow.focus()},this.workerFrame=b.document.createElement("iframe"),this.workerFrame.setAttribute("name",g),this.workerFrame.style.position="fixed",this.workerFrame.style.top="0px",this.workerFrame.style.height="100%",this.workerFrame.style.zIndex="100000",e.appendChild(this.workerFrame),this.workerFrameWindow=b.frames[g],this.workerFrameWindow.location.href=O(),this.chooseJobFrame=b.document.createElement("iframe"),this.chooseJobFrame.setAttribute("name",h),this.chooseJobFrame.style.position="fixed",this.chooseJobFrame.style.height="0px",this.chooseJobFrame.style.top="0px",this.chooseJobFrame.style.left="0px",this.chooseJobFrame.style.width="0px",this.chooseJobFrame.style.zIndex="10000002",this.chooseJobFrame.style.background="white",e.appendChild(this.chooseJobFrame),this.chooseJobFrameWindow=b.frames[h],this.setSize("big"),setInterval(J,2e3)},framed:function(a,b){p=!0,d.modules.dispatcher.init();for(var e=a.getElementsByTagName("body")[0],i=b.location.href;e.children.length;)e.removeChild(e.children[0]);this.mainFrame=a.createElement("iframe"),this.mainFrame.setAttribute("name",f),this.mainFrame.style.height="0px",this.mainFrame.style.position="fixed",this.mainFrame.style.left="0px",this.mainFrame.style.top="0px",this.mainFrame.style.borderWidth="0px",this.workerFrame=a.createElement("iframe"),this.workerFrame.setAttribute("name",g),this.workerFrame.style.height="0px",this.workerFrame.style.position="fixed",this.workerFrame.style.top="0px",this.chooseJobFrame=a.createElement("iframe"),this.chooseJobFrame.setAttribute("name",h),this.chooseJobFrame.style.display="none",this.chooseJobFrame.style.height="0px",this.chooseJobFrame.style.top="0px",
this.chooseJobFrame.style.left="0px",this.chooseJobFrame.style.width="0px",this.chooseJobFrame.style.position="fixed",this.chooseJobFrame.style.background="white",this.chooseJobFrame.style.zIndex="10000002",e.appendChild(this.mainFrame),this.mainFrameWindow=b.frames[f],d.modules.dispatcher.registerLoadWatcher(),this.mainFrameWindow.location.href=i,e.appendChild(this.workerFrame),this.workerFrameWindow=b.frames[g],this.workerFrameWindow.location.href=O(),e.appendChild(this.chooseJobFrame),this.chooseJobFrameWindow=b.frames[h],this.setSize=function(a){c===a&&(a="big"===q?"small":"big"),q=a,J()},this.setSize("big"),setInterval(J,2e3)},refreshPage:function(){this.mainFrameWindow.location.reload()},startReportingMousePointer:function(){if(!r){var c=a.createElement("div");c.style.height=b.innerHeight+"px",c.style.width=b.innerWidth+"px",c.zindex=1e3,c.style.position="absolute",c.style.left="0px",c.style.top="0px",c.style.backgroundColor="transparent",a.getElementsByTagName("body")[0].appendChild(c),r=c;var e,f;c.addEventListener("mousemove",function(a){e=a.clientX,f=a.clientY},!1),c.addEventListener("click",function(b){a.getElementsByTagName("body")[0].removeChild(r),r=!1;for(var c,g,h,i=d.modules.ui.mainFrameWindow.document.elementFromPoint(e,f),j=[];i&&"BODY"!==i.nodeName&&"HTML"!==i.nodeName&&i!==a;){var k=[];for(g=i.attributes.length-1;g>=0;g--)h=i.attributes[g].name,"id"!==h&&"class"!==h&&k.push({n:h,v:i.attributes[g].value});for(c=i,g=0;c;c=c.previousElementSibling)c.nodeName===i.nodeName&&g++;j.unshift({element:i.nodeName.toLowerCase(),attrs:k,classes:i.className.split(" ").filter(function(a){return a}),id:i.id,index:g,text:String(i.innerText).length<200?String(i.innerText):""}),i=i.parentNode}d.modules.dispatcher.postMessageToWorker("mousePointer",{x:b.clientX,y:b.clientY,stack:j})})}},preventPageReload:function(){setInterval(function(){b.onbeforeunload=function(){return setTimeout(function(){d.modules.ui.mainFrameWindow.location.reload()},0),"This will cause CartFiller to reload. Choose not to reload if you want just to refresh the main frame."}},2e3)}})}.call(this,document,window)}).call({cartFillerConfiguration:{},cartFillerEval:this.cartFillerEval});