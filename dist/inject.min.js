/*
 *  cartFiller - v0.0.1
 *  Tool for automating cart filling process when doing big purchases
 *  https://andrey012.github.com/cartFiller
 *
 *  Made by Andrey Grinenko
 *  Under MIT License
 */
(function(){(function(a,b){"use strict";var c,d="undefined"!=typeof this.cartFillerConfiguration,e="undefined"!=typeof this.cartFillerEval;if(e&&!d?(b.cartFillerConfiguration={},c=b.cartFillerConfiguration):(this.cartFillerConfiguration={},c=this.cartFillerConfiguration),c.concatenated=d,c.scripts=[],c.launch=function(){"0"===String(c["data-type"])?this.modules.ui.framed(a,b):"1"===String(c["data-type"])?this.modules.ui.popup(a,b):alert("Type not specified, should be 0 for framed, 1 for popup")},c.baseUrl="",c["data-type"]=0,c["data-choose-job"]="",c["data-debug"]=!1,c["data-worker"]="",c.gruntBuildTimeStamp="1434576366959",e)c.baseUrl=this.cartFillerEval[0],c["data-type"]=this.cartFillerEval[1],c["data-choose-job"]=this.cartFillerEval[2],c["data-debug"]=this.cartFillerEval[3],c["data-worker"]=this.cartFillerEval[4];else for(var f=a.getElementsByTagName("head")[0].getElementsByTagName("script"),g=f[f.length-1],h=g.attributes,i=h.length-1;i>=0;i--)/^data-/.test(h[i].name)&&("data-base-url"===h[i].name?c.baseUrl=h[i].value:c[h[i].name]=h[i].value);if(!d){var j=a.createElement("script");j.setAttribute("src",c.baseUrl+"/boot/helpers/loader.js"),a.getElementsByTagName("head")[0].appendChild(j)}}).call(this,document,window),function(a,b,c){"use strict";var d=this.cartFillerConfiguration;d.scripts.push({getName:function(){return"api"},registerWorker:function(a){return d.modules.dispatcher.registerWorker(a,this),this},result:function(a,b){return d.modules.dispatcher.submitWorkerResult(a,b),this},nop:function(){return d.modules.dispatcher.submitWorkerResult("","nop"),this},onload:function(a){return d.modules.dispatcher.registerWorkerOnloadCallback(a),this},waitFor:function(a,b,e,f){c===e&&(e=2e4),c===f&&(f=200);var g=Math.round(e/f),h=function(){var c=a();!1!==d.modules.dispatcher.getWorkerCurrentStepIndex()&&(c?b(c):(g--,g>0?setTimeout(h,f):b(!1)))};return setTimeout(h,f),this},highlight:function(a,b){return d.modules.ui.highlight(a,b),d.modules.dispatcher.setHighlightedElement(a),this},arrow:function(a,b){return d.modules.ui.arrowTo(a,b),d.modules.dispatcher.setHighlightedElement(a),this},say:function(a){return d.modules.ui.say(a),this}})}.call(this,document,window),function(document,window,undefined){"use strict";var worker=!1,workerSrcPretendent="",workerCurrentTask={},workerCurrentTaskIndex=!1,workerCurrentStepIndex=!1,workerOnLoadHandler=!1,resultMessageName=!1,mainFrameLoaded=!1,workerFrameLoaded=!1,bootstrapped=!1,highlightedElement=!1,me=this.cartFillerConfiguration,postMessage=function(a,b,c,d){undefined===d&&(d="cartFillerMessage"),undefined===c&&(c={}),c.cmd=b,a.postMessage(d+":"+JSON.stringify(c),"*")},resetWorker=function(){workerCurrentTaskIndex=workerCurrentStepIndex=workerOnLoadHandler=!1},fillWorkerCurrentTask=function(a){for(var b in workerCurrentTask)workerCurrentTask.hasOwnProperty(b)&&delete workerCurrentTask[b];for(var c in a)a.hasOwnProperty(c)&&(workerCurrentTask[c]=a[c])};this.cartFillerConfiguration.scripts.push({getName:function(){return"dispatcher"},init:function(){var a=this;window.addEventListener("message",function(b){var c=/^cartFillerMessage:(.*)$/;if(c.test(b.data)){var d=c.exec(b.data),e=JSON.parse(d[1]),f="onMessage_"+e.cmd;undefined!==a[f]&&a[f]instanceof Function?a[f](e):console.log("unknown message: "+f+":"+b.data)}},!1)},onMessage_register:function(){workerFrameLoaded=!0,mainFrameLoaded&&!bootstrapped&&this.bootstrapCartFiller()},onMessage_makeSmaller:function(){me.modules.ui.setSize("small")},onMessage_makeBigger:function(){me.modules.ui.setSize("big")},onMessage_toggleSize:function(){me.modules.ui.setSize()},onMessage_chooseJob:function(){me.modules.ui.showHideChooseJobFrame(!0)},onMessage_chooseJobCancel:function(){me.modules.ui.showHideChooseJobFrame(!1)},onMessage_jobDetails:function(a){resultMessageName=a.resultMessage?a.resultMessage:!1,me.modules.ui.showHideChooseJobFrame(!1),a.overrideWorkerSrc=me["data-worker"],resetWorker(),this.postMessageToWorker("jobDetails",a)},onMessage_sendResult:function(a){me.modules.ui.showHideChooseJobFrame(!0),resultMessageName&&this.postMessageToChooseJob(resultMessageName,a)},onMessage_loadWorker:function(message){try{workerSrcPretendent=message.src,eval(message.code),resetWorker()}catch(e){throw alert(e),e}},onMessage_invokeWorker:function(a){if(!1!==workerCurrentStepIndex){var b="ERROR: worker task is in still in progress";alert(b),this.postMessage("workerStepResult",{index:a.index,step:a.step,result:b})}else{workerCurrentTaskIndex!==a.index&&fillWorkerCurrentTask(a.details),workerCurrentTaskIndex=a.index,workerCurrentStepIndex=a.step;var c={stepIndex:a.index,task:a.details,params:{}};try{undefined===worker[a.task][2*a.step+1]?alert("invalid worker - function for "+a.task+" step "+a.step+" does not exist"):"function"!=typeof worker[a.task][2*a.step+1]?"function"==typeof worker[a.task][2*a.step+1][0]?(c.params=worker[a.task][2*a.step+1][1],worker[a.task][2*a.step+1][0](highlightedElement,c)):alert("invalid worker - function for "+a.task+" step "+a.step+" is not a function"):worker[a.task][2*a.step+1](highlightedElement,c)}catch(b){throw alert(b),b}}},onMessage_resetWorker:function(){resetWorker()},onMessage_closePopup:function(){me.modules.ui.closePopup()},onMessage_helloFromPlugin:function(a){this.postMessageToChooseJob(a.message,{})},onMainFrameLoaded:function(a){mainFrameLoaded=!0,workerFrameLoaded&&!bootstrapped&&this.bootstrapCartFiller(),workerOnLoadHandler&&(workerOnLoadHandler(a),workerOnLoadHandler=!1)},postMessageToWorker:function(a,b){postMessage(me.modules.ui.workerFrameWindow,a,b)},postMessageToChooseJob:function(a,b){postMessage(me.modules.ui.chooseJobFrameWindow,a,b,a)},bootstrapCartFiller:function(){bootstrapped=!0,this.postMessageToWorker("bootstrap",{lib:me.baseUrl.replace(/(src|dist)\/?$/,"lib/"),debug:me["data-debug"]})},registerWorker:function(a,b){workerCurrentTask={},worker=a(me.modules.ui.mainFrameWindow,undefined,b,workerCurrentTask);var c={};for(var d in worker)if(worker.hasOwnProperty(d)){for(var e=[],f=0;f<worker[d].length;f++)"string"==typeof worker[d][f]&&e.push(worker[d][f]);c[d]=e}this.postMessageToWorker("workerRegistered",{jobTaskDescriptions:c,src:workerSrcPretendent})},submitWorkerResult:function(a,b){var c;if(undefined===a||""===a)c="ok";else{if("string"!=typeof a)throw"invalid message type "+typeof a;c=b?"skip":"error"}this.postMessageToWorker("workerStepResult",{index:workerCurrentTaskIndex,step:workerCurrentStepIndex,status:c,message:a,nop:"nop"===b}),workerCurrentStepIndex=workerOnLoadHandler=!1},registerWorkerOnloadCallback:function(a){workerOnLoadHandler=a},getWorkerCurrentStepIndex:function(){return workerCurrentStepIndex},setHighlightedElement:function(a){highlightedElement=a}})}.call(this,document,window),function(a,b){"use strict";var c=["dispatcher","ui","api"],d=this,e=function(){for(var a=c.length-1;a>=0;a--){for(var e=!1,f=d.cartFillerConfiguration.scripts.length-1;f>=0;f--)if(d.cartFillerConfiguration.scripts[f].getName()===c[a]){e=!0;break}if(!e)return}b.cartFillerAPI=function(){return d.cartFillerConfiguration.modules.api},d.cartFillerConfiguration.modules={};for(var g=d.cartFillerConfiguration.scripts.length-1;g>=0;g--){var h=d.cartFillerConfiguration.scripts[g];d.cartFillerConfiguration.modules[h.getName()]=h}d.cartFillerConfiguration.launch()};if(this.cartFillerConfiguration.scripts.push=function(a){Array.prototype.push.call(this,a),e()},!this.cartFillerConfiguration.concatenated)for(var f=a.getElementsByTagName("head")[0],g=c.length-1;g>=0;g--){var h=a.createElement("script");h.setAttribute("src",this.cartFillerConfiguration.baseUrl+"/boot/helpers/"+c[g]+".js"),f.appendChild(h)}}.call(this,document,window),function(a,b,c){"use strict";var d,e=this.cartFillerConfiguration,f="cartFillerOverlayDiv",g="cartFillerMainFrame",h="cartFillerWorkerFrame",i="cartFillerChooseJobFrame",j=!1,k=[],l=[],m="",n=0,o=!1,p=!1,q=function(){return p?b:e.modules.ui.mainFrameWindow},r=function(){return"rgba(255,0,0,0.3)"},s=function(){var a=q().document.createElement("div");return a.style.position="fixed",a.style.backgroundColor=r(),a.style.zIndex=M(),a.className=f,a.onclick=function(){I(!0)},q().document.getElementsByTagName("body")[0].appendChild(a),a},t=function(a,b,c){var d=s();d.style.left=a+"px",d.style.top=b+"px",d.style.width="20px",d.style.height=c+"px"},u=function(a,b,c){var d=s();d.style.left=a+"px",d.style.top=b+"px",d.style.width=c+"px",d.style.height="20px"},v=function(a,b){var c=s();c.style.left=a+"px",c.style.top=b-25+"px",c.style.width=c.style.height="0px",c.style.backgroundColor="transparent",c.style.borderTop=c.style.borderBottom="25px solid transparent",c.style.borderLeft="30px solid rgba(255,0,0,0.3)"},w=function(a,b){var c=s();c.style.left=a-25+"px",c.style.top=b+"px",c.style.width=c.style.height="0px",c.style.backgroundColor="transparent",c.style.borderLeft=c.style.borderRight="25px solid transparent",c.style.borderTop="30px solid rgba(255,0,0,0.3)"},x=function(a,b){var c=s();c.style.left=a-25+"px",c.style.top=b+"px",c.style.width=c.style.height="0px",c.style.backgroundColor="transparent",c.style.borderLeft=c.style.borderRight="25px solid transparent",c.style.borderBottom="30px solid rgba(255,0,0,0.3)"},y=function(a){var b,d,e,f,g,h,i,j=!1;for(b=a.length-1;b>=0;b--)h=a[b],i=h.element.getBoundingClientRect(),i.width>0||i.height>0||i.left>0||i.top>0?(d=Math.round(i.top-5),e=Math.round(i.left-5),g=Math.round(i.height+9),f=Math.round(i.width+9),(d!==h.top||e!==h.left||g!==h.height||f!==h.width)&&(j=!0,h.top=d,h.left=e,h.height=g,h.width=f)):h.left=h.right=h.top=h.bottom=c;return j},z=function(){var a,b,d,e;for(a=k.length-1;a>=0;a--){var f=k[a];if(f.left!==c){var g=s();g.style.backgroundColor="transparent",g.style.borderLeft=g.style.borderTop=g.style.borderRight=g.style.borderBottom="5px solid rgba(255,0,0,0.3)",g.style.left=f.left+"px",g.style.top=f.top+"px",g.style.width=f.width+"px",g.style.height=f.height+"px",g.style.boxSizing="border-box",f.left>40?(b=f.top+Math.round(f.height/2),t(0,0,b-10),u(0,b-10,f.left-30),v(f.left-30,b)):f.top>40?(d=f.left+Math.min(30,Math.round(f.width/2)),u(0,0,d-10),t(d-10,0,f.top-30),w(d,f.top-30)):(d=f.left+Math.min(30,Math.round(f.width/2)),e=f.top+f.height,u(0,e+60,d+10),t(d-10,e+30,30),x(d,e))}}},A=function(a,b){var d,e,f,g,h,i,j,k=[a,b];for(e=k.length-1;e>=0;e--)if(c!==k[e])for(d=k[e].length-1;d>=0;d--)j=k[e][d],f=c===f?j.left:Math.min(f,j.left),h=c===h?j.left+j.width:Math.max(h,j.left+j.width),g=c===g?j.top:Math.min(g,j.top),i=c===i?j.top+j.height:Math.max(i,j.top+j.height);return{left:f,right:h,top:g,bottom:i}},B=function(a){var b;for(b=a.length-1;b>=0;b--)a[b].left=a[b].top=a[b].width=a[b].height=c},C=function(){var a=A(l);if(a.left!==c){var b=e.modules.ui.mainFrameWindow.innerHeight,d=e.modules.ui.mainFrameWindow.innerWidth,f=5;G(0,0,Math.max(0,a.left-f),b),G(Math.min(d,a.right+f),0,d,b),G(Math.max(0,a.left-f),0,Math.min(d,a.right+f),Math.min(b,a.top-f)),G(Math.max(0,a.left-f),Math.max(0,a.bottom+f),Math.min(d,a.right+f),b)}},D=function(){var a=A(k,l);if(a.left!==c&&("string"==typeof m&&m.length>0||"string"!=typeof m&&c!==m&&null!==m&&!isNaN(m))){var b=q().document.createElement("div");b.style.display="block",b.style.backgroundColor="#fff",b.style.padding="10px",b.style.fontSize="20px;",b.style.zIndex=M()+1,b.style.border="#bbb solid 10px",b.style.borderRadius="20px",b.style.overflow="auto",b.style.visibility="hidden",b.style.top=a.bottom+5+"px",b.style.left=Math.max(0,Math.round((a.left+a.right)/2)-o)+"px",b.style.width=o+"px",b.style.height="auto",b.style.position="fixed",b.style.fontSize="20px",b.className=f,b.textContent=m,b.onclick=function(){I(!0)},q().document.getElementsByTagName("body")[0].appendChild(b),n=100,e.modules.ui.adjustMessageDiv(b)}},E=function(){try{var a=y(k),b=y(l);(a||b)&&(I(),z(),C(),D())}catch(c){}},F=function(){return e.modules.ui.mainFrameWindow.document},G=function(a,b,c,d){a=Math.round(a),b=Math.round(b),c=Math.round(c),d=Math.round(d);var e=F().createElement("div");e.style.position="fixed",e.style.left=a+"px",e.style.top=b+"px",e.style.width=c-a+"px",e.style.height=d-b+"px",e.style.backgroundColor="rgba(0,0,0,0.3)",e.style.zIndex=M(),e.className=f,e.onclick=function(){I(!0)},F().getElementsByTagName("body")[0].appendChild(e)},H=function(a){var b,d,f,g,h,i,j,k=e.modules.ui.mainFrameWindow.innerHeight,l=e.modules.ui.mainFrameWindow.innerWidth;a.length>0&&"function"==typeof a[0].element.scrollIntoView&&a[0].element.scrollIntoView();for(var m=1e3;m&&(y(a),b=A(a),g=Math.round((b.right+b.left)/2),j=Math.round((b.bottom+b.top)/2),!(c!==d&&g>=d&&f>=g&&j>=h&&i>=j));m--)d=c===d?g:Math.min(d,g),f=c===f?g:Math.max(f,g),h=c===h?j:Math.min(h,j),i=c===i?j:Math.max(i,j),e.modules.ui.mainFrameWindow.scrollBy(g-Math.round(l/2),j-Math.round(k/2));B(a)},I=function(a){var b,c=F().getElementsByClassName(f);for(b=c.length-1;b>=0;b--)c[b].parentNode.removeChild(c[b]);for(c=q().document.getElementsByClassName(f),b=c.length-1;b>=0;b--)c[b].parentNode.removeChild(c[b]);!0===a&&(k=l=[],m="")},J=function(){return e.baseUrl+"/index"+(e.concatenated?".min":"")+".html"+(e.gruntBuildTimeStamp?"?"+e.gruntBuildTimeStamp:"")},K=!1,L=!1,M=function(){return 1e7};setInterval(E,200),e.scripts.push({getName:function(){return"ui"},setSize:function(){},showHideChooseJobFrame:function(a){a&&!j&&(this.chooseJobFrameWindow.location.href=e["data-choose-job"],j=!0),this.chooseJobFrame.style.display=a?"block":"none"},closePopup:function(){},highlight:function(a,b){m="";var d,e=this.mainFrameWindow.document.getElementsByTagName("body")[0];e.style.paddingBottom=this.mainFrameWindow.innerHeight+"px";var f=this;if(l=[],c!==f.mainFrameWindow.jQuery&&a instanceof f.mainFrameWindow.jQuery)for(d=a.length-1;d>=0&&(l.push({element:a[d]}),!0===b);d--);else if(a instanceof Array)for(d=a.length-1;d>=0&&(l.push({element:a[d]}),!0===b);d--);else c!==a&&l.push({element:a});l.length>0&&setTimeout(function(){H(l)},0)},arrowTo:function(a,b){if(k=[],c!==this.mainFrameWindow.jQuery&&a instanceof this.mainFrameWindow.jQuery)a.each(function(a,c){return k.push({element:c}),b?void 0:!1});else if(a instanceof Array)for(var d=0;d<a.length&&(k.push({element:a[d]}),b);d++);else c!==a?k.push({element:a}):(k=[],I())},say:function(a){m=c===a?"":a,o=Math.max(100,Math.round(.5*this.mainFrameWindow.innerWidth)),n=100},adjustMessageDiv:function(a){var b=this;setTimeout(function(){var c=!0;if(n>0){c=!1;var d=a.getBoundingClientRect();d.bottom>b.mainFrameWindow.innerHeight?d.width>.95*b.mainFrameWindow.innerWidth?d.top-(L-K)-10<.05*b.mainFrameWindow.innerHeight?c=!0:b.mainFrameWindow.scrollBy(0,Math.round(.05*b.mainFrameWindow.innerHeight)):o=Math.min(b.mainFrameWindow.innerWidth,parseInt(a.style.width.replace("px",""))+Math.round(.04*b.mainFrameWindow.innerWidth)):c=!0,c?(a.style.visibility="visible",n=0):(n--,B(k),B(l))}},0)},popup:function(a,b){var f=b.innerWidth,g=b.innerHeight,j=.02*f,k=.76*f,l=.02*g,m=.96*g,n=.8*f-1,o=.2*f-1;e.modules.dispatcher.init(),this.mainFrameWindow=b.open(b.location.href,"_blank","height="+Math.round(b.outerHeight)+", width="+Math.round(.8*b.outerWidth)),this.closePopup=function(){this.mainFrameWindow.close()},this.mainFrameWindow.addEventListener("load",function(){e.modules.dispatcher.onMainFrameLoaded()},!0);var p=this;setTimeout(function r(){p.mainFrameWindow.document&&"complete"===p.mainFrameWindow.document.readyState&&e.modules.dispatcher.onMainFrameLoaded(!0),setTimeout(r,100)},100);for(var q=b.document.getElementsByTagName("body")[0];q.children.length;)q.removeChild(q.children[0]);this.setSize=function(a){c===a&&(a="big"===d?"small":"big"),d=a,"big"===a?(this.workerFrame.style.width=n+"px",this.workerFrame.style.left=f-n-5+"px"):"small"===a&&(this.workerFrame.style.width=o+"px",this.workerFrame.style.left=f-o-5+"px")},this.workerFrame=b.document.createElement("iframe"),this.workerFrame.setAttribute("name",h),this.workerFrame.style.position="fixed",this.workerFrame.style.top="0px",this.workerFrame.style.height="100%",this.workerFrame.style.zIndex="100000",this.setSize("big"),q.appendChild(this.workerFrame),this.workerFrameWindow=b.frames[h],this.workerFrameWindow.location.href=J(),this.chooseJobFrame=b.document.createElement("iframe"),this.chooseJobFrame.setAttribute("name",i),this.chooseJobFrame.style.position="fixed",this.chooseJobFrame.style.height=m+"px",this.chooseJobFrame.style.top=l+"px",this.chooseJobFrame.style.left=j+"px",this.chooseJobFrame.style.width=k+"px",this.chooseJobFrame.style.zIndex="1000000",this.chooseJobFrame.style.background="white",q.appendChild(this.chooseJobFrame),this.chooseJobFrameWindow=b.frames[i]},framed:function(a,b){p=!0,e.modules.dispatcher.init();for(var d=a.getElementsByTagName("body")[0],f=b.location.href,j=b.innerWidth,k=b.innerHeight,l=.8*j-1,m=.2*j-1,n=.8*j-1,o=.2*j-1,q=k-15,r=.02*j,s=.76*j,t=.02*k,u=.96*k,v="big";d.children.length;)d.removeChild(d.children[0]);this.mainFrame=a.createElement("iframe"),this.mainFrame.setAttribute("name",g),this.mainFrame.style.height=q+"px",this.mainFrame.style.position="fixed",this.mainFrame.style.left="0px",this.mainFrame.style.top="0px",this.mainFrame.style.borderWidth="0px",this.workerFrame=a.createElement("iframe"),this.workerFrame.setAttribute("name",h),this.workerFrame.style.height=q+"px",this.workerFrame.style.position="fixed",this.workerFrame.style.top="0px",this.chooseJobFrame=a.createElement("iframe"),this.chooseJobFrame.setAttribute("name",i),this.chooseJobFrame.style.display="none",this.chooseJobFrame.style.height=u+"px",this.chooseJobFrame.style.top=t+"px",this.chooseJobFrame.style.left=r+"px",this.chooseJobFrame.style.width=s+"px",this.chooseJobFrame.style.position="fixed",this.chooseJobFrame.style.background="white",d.appendChild(this.mainFrame),this.mainFrameWindow=b.frames[g],this.mainFrame.onload=function(){e.modules.dispatcher.onMainFrameLoaded()},this.mainFrameWindow.location.href=f,d.appendChild(this.workerFrame),this.workerFrameWindow=b.frames[h],this.workerFrameWindow.location.href=J(),d.appendChild(this.chooseJobFrame),this.chooseJobFrameWindow=b.frames[i],this.setSize=function(a){c===a&&(a="big"===v?"small":"big"),v=a,"big"===a?(this.workerFrame.style.width=n+"px",this.mainFrame.style.width=m+"px",this.workerFrame.style.left=m+"px"):"small"===a&&(this.workerFrame.style.width=o+"px",this.mainFrame.style.width=l+"px",this.workerFrame.style.left=l+"px")},this.setSize("big")}})}.call(this,document,window)}).call({cartFillerConfiguration:{},cartFillerEval:this.cartFillerEval});