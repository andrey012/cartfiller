/*
 *  cartFiller - v0.0.1
 *  Tool for automating cart filling process when doing big purchases
 *  https://andrey012.github.com/cartFiller
 *
 *  Made by Andrey Grinenko
 *  Under MIT License
 */
(function concatenatedInjectFunction(){(function(){(function a(b,c){"use strict";var d,e="undefined"!=typeof this.cartFillerConfiguration,f="undefined"!=typeof this.cartFillerEval;if(c.cartFillerAPI)throw c.postMessage("cartFillerMessage:"+JSON.stringify({cmd:"reinitialize"}),"*"),new Error("preventing duplicate launch on ["+c.location.href+"]");if(f&&!e?(c.cartFillerConfiguration={},d=c.cartFillerConfiguration):(this.cartFillerConfiguration={},d=this.cartFillerConfiguration),d.concatenated=e,d.localIndexHtml="",d.localInjectJs="",d.scripts=[],d.uiLaunched=!1,d.launch=function(a){console.log(""),b.getElementsByTagName("body")[0].getAttribute("data-old-cartfiller-version-detected")||(!a&&c.opener&&c.opener!==c&&"2"!==String(d["data-type"])||c.parent&&/\#?\/?launchSlaveInFrame$/.test(c.location.hash)?this.modules.dispatcher.startSlaveMode():!a&&"2"===String(d["data-type"])&&d.localIndexHtml?c.opener&&c.opener!==c&&c.opener.opener&&c.opener.opener!==c.opener?this.modules.dispatcher.startSlaveMode(c.opener.opener):alert("to be done"):d.uiLaunched||(d.uiLaunched=!0,"0"===String(d["data-type"])?this.modules.ui.framed(b,c):"1"===String(d["data-type"])?this.modules.ui.popup(b,c):"2"===String(d["data-type"])?this.modules.ui.clean(b,c):alert("Type not specified, should be 0 for framed, 1 for popup")))},d.baseUrl="",d["data-type"]=0,d["data-choose-job"]="",d["data-debug"]=!1,d.log=function(){},d["data-worker"]="",d.gruntBuildTimeStamp="1521311581143",f)d.baseUrl=this.cartFillerEval[0],d["data-type"]=this.cartFillerEval[1],d["data-choose-job"]=this.cartFillerEval[2],d["data-debug"]=this.cartFillerEval[3],d["data-worker"]=this.cartFillerEval[4],d["data-wfu"]=this.cartFillerEval[5],d.localInjectJs=this.cartFillerEval[6];else{var g,h=b.getElementsByTagName("head")[0].getElementsByTagName("script");for(g=0;g<h.length;g++){var i=h[g];if(null!==i.getAttribute("data-type")&&null!==i.getAttribute("data-base-url")&&null!==i.getAttribute("data-choose-job")){for(var j=i.attributes,k=j.length-1;k>=0;k--)/^data-/.test(j[k].name)&&("data-base-url"===j[k].name?d.baseUrl=j[k].value:d[j[k].name]=j[k].value);break}}}var l=[d.baseUrl,d["data-type"],d["data-choose-job"],d["data-debug"],d["data-worker"],d["data-wfu"]];if(d.injectFunction=e?"("+concatenatedInjectFunction.toString()+").call("+JSON.stringify(this)+");":"("+a.toString()+").call({cartFillerEval: "+JSON.stringify(l)+"}, document, window);",!e){var m=b.createElement("script");m.setAttribute("src",d.baseUrl+"/boot/helpers/loader.js"),b.getElementsByTagName("head")[0].appendChild(m)}}).call(this,document,window),function(a,b,c){"use strict";var d=this.cartFillerConfiguration,e=function(a){return String(a).replace(/\s+/g," ").trim().toLowerCase()},f=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c]);return b},g=function(){var a;try{a=d.modules.ui.mainFrameWindow.document}catch(b){}return a},h=/^(([^\:\[.# ]+)|(\#[^\:\[.# ]+)|(\.[^\:\[.# ]+)|(\[([^\]"]|("[^"]*"))*\])|(\:([^\:\[.#" \()]|("[^"]*")|\([^)]+\))+))(.*)$/,i=/^((([^\:\[.# ]+)|(\#[^\:\[.# ]+)|(\.[^\:\[.# ]+)|(\[([^\]"]|("[^"]*"))*\])|(\:([^\:\[.#" \(]|("[^"]*")|\([^)]+\))+))+)(\s(.*))?$/,j=function(a){var b=/^([^\^\$=]+)(\^=|\$=|=)"([^"]*)"$/.exec(a);if(!b)throw new Error("unable to parse attribute selector: ["+a+"]");return{attribute:b[1],equals:b[2],value:b[3]}},k=function(a,b,d){if(d===c)throw new Error("self should not be undefined");if(this.self=d||c,a){this.length=a.length,this.description=b||"["+a.length+"]";for(var e=0;e<a.length;e++)this[e]=a[e]}else this.length=0,this.description=""};k.prototype=Object.create({}),k.prototype.find=function(a){if("object"==typeof a){if(a.nodeName)return new k([a],this.description+" ["+a.nodeName+"]",[this,"find",a]);if(a.hasOwnProperty("length"))return new k(a,c,[this,"find",a])}var b=i.exec(d.modules.dispatcher.interpolateText(a.trim()));if(!b)throw new Error("invalid selector: ["+a+"]");var e=b[1],f=b[13],g=new k([],this.description+" "+e,null);this.each(function(a,b){g=g.add(v(b,e))});var h;return h=f?g.find(f):g,new k(h,this.description+" "+a,[this,"find",a])};var l=function(a){return function(b){return t(a,b)}};k.prototype.css=function(a,b){for(var c=0;c<this.length;c++)this[c].style[a]=b;return this},k.prototype.closest=function(a){var b=n(a),c=this.description+" closest("+a+")";if(this.length){for(var d=[],e=0;e<this.length;e++)for(var f=this[e].parentNode;f;f=f.parentNode)if(b.length===b.filter(l(f)).length){d.push(f);break}return new k(d,c,[this,"closest",a])}return new k([],c,[this,"closest",a])},k.prototype.parent=function(){return new k(this.length?[this[0].parentNode]:[],"parent",[this,"parent"])},k.prototype.text=function(){return this.length?String(this[0].textContent):""},k.prototype.is=function(a){if(this.length){var b=n(a);return b.length===b.filter(l(this[0])).length}},k.prototype.index=function(){if(this.length){for(var a=this[0].previousSibling,b=0;a;a=a.previousSibling)b+=a.nodeName===this[0].nodeName?1:0;return b}},k.prototype.val=function(){return this.length?arguments.length?(this[0].value=d.modules.dispatcher.interpolateText(arguments[0]),this):this[0].value:void 0},k.prototype.attr=function(a,b){if(1===arguments.length){if(this.length)return this[0].getAttribute(a)}else{if(2!==arguments.length)throw new Error("incorrect use of .attr - should have 1 or 2 arguments");for(var c=0;c<this.length;c++)this[c].setAttribute(a,b)}return this},k.prototype.add=function(a){var b;if(a instanceof k||a instanceof Array||"string"==typeof a){var c=[];for(b=0;b<this.length;b++)c.push(this[b]);"string"==typeof a&&(a=d.modules.api.find(a));var e=this.description+" + "+(a instanceof k?a.description:"["+a.length+"]");for(b=0;b<a.length;b++)-1===c.indexOf(a[b])&&c.push(a[b]);return new k(c,e,[this,"add",a])}for(b=this.length;b>=0;b--)if(this[b]===a)return this;return this[this.length]=a,this.length++,this},k.prototype.filter=function(a){for(var b=[],c=0;c<this.length;c++)a.apply(g(),[c,this[c]])&&b.push(this[c]);return new k(b,this.description+" filter("+a.toString()+")",[this,"filter",a])},k.prototype.each=function(a){for(var b=0;b<this.length;b++){var c=a(b,this[b]);if(c===!1||c===d.modules.api)break}return this},k.prototype.map=function(a){var b=[];return this.each(function(c,e){var f=a(c,d.modules.api.find(e));f instanceof k?f.each(function(a,c){b.push(c)}):f&&b.push(f)}),d.modules.api.find(b)},k.prototype.arrow=function(a){return d.modules.api.arrow(this,a),this},k.prototype.exists=function(a){return c===a&&(a="element(s) not found: "+this.description),d.modules.api.arrow(this,!0).result(this.length>0?"":a),this},k.prototype.exactly=function(a,b){return c===b&&(b="element(s) not found: "+this.description),d.modules.api.arrow(this,!0).result(this.length===parseInt(a)?"":b),this},k.prototype.absent=function(a){return c===a&&(a="element(s) should not exist, but they are: "+this.description),d.modules.api.arrow(this,!0).result(this.length>0?a:""),this},k.prototype.say=function(a,b,c){return d.modules.api.say(a,b,c),this},k.prototype.change=function(){if(this.length){var b=a.createEvent("HTMLEvents");b.initEvent("change",!1,!0),this[0].dispatchEvent(b)}},k.prototype.next=function(a){if(a!==c)throw new Error("not implemented");var b=this.description+" next("+a+")";if(this.length){var d=this[0].nextElementSibling;return d?new k([d],b,[this,"next",a]):new k([],b,[this,"next",a])}return new k([],b,[this,"next",a])},k.prototype.first=function(){return new k(this.length?[this[0]]:[],this.description+" first()",[this,"first"])},k.prototype.last=function(){return new k(this.length?[this[this.length-1]]:[],this.description+" last()",[this,"last"])},k.prototype.nthOfType=function(a){return"string"==typeof a&&(a=parseInt(d.modules.dispatcher.interpolateText(String(a)))),this.filter(function(b,c){for(var d=0,e=c.previousSibling;e;e=e.previousSibling)d+=e.nodeName===c.nodeName?1:0;return d===a})},k.prototype.select=function(){if(!this.length||"OPTION"!==this[0].nodeName)throw new Error("Invalid use of select() - selector should be not empty and OPTION should be first element");this.parent().val(this.attr("value")).change()};var m=function(a,b){if(b){for(var c=[],d=0;d<a.childNodes.length;d++){var e=a.childNodes[d];3===e.nodeType&&c.push(e.textContent)}return c.join("")}return a.textContent};k.prototype.withText=function(a,b,c){if(a instanceof RegExp){var e=a.flags||"";return b&&-1===e.indexOf("i")&&(e+="i"),a=new RegExp(d.modules.dispatcher.interpolateText(a.source),e),this.filter(function(b,d){return a.test(m(d,c).trim())})}return a=d.modules.dispatcher.interpolateText(a),b&&(a=a.toLowerCase()),this.filter(function(e,f){return d.modules.api.compareCleanText(a,b?m(f,c).toLowerCase():m(f,c))})},k.prototype.reevaluate=function(){var a;if(this.self){var b;for("function"==typeof this.self?b=this.self():(this.self[0]&&this.self[0].reevaluate(),"add"===this.self[1]&&this.self[2]instanceof k&&this.self[2].reevaluate(),b=this.self[0][this.self[1]].apply(this.self[0],this.self.slice(2))),a=0;a<b.length;a++)this[a]=b[a];for(a=b.length;a<this.length;a++)delete this[a];this.length=b.length}return this},["result","nop","skipStep","skipTask","repeatStep","repeatTask","repeatJob","skipJob","stop"].filter(function(a){k.prototype[a]=function(){return d.modules.api[a].apply(d.modules.api,arguments),this}});var n=function(a){for(var b=[];a.length;){var c=h.exec(a);if(!c)throw new Error("invalid selector: ["+a+"]");if(c[2])b.push(["nodeName",c[2]]);else if(c[3])b.push(["id",c[3].substr(1)]);else if(c[4])b.push(["class",c[4].substr(1)]);else if(c[5])b.push(["attribute",j(c[5].substr(1,c[5].length-2))]);else{if(!c[8])throw new Error("bad selector: ["+a+"]");var d=/^:not\((.*)\)$/.exec(c[8]);b.push(d?["not",n(d[1])]:["modifier",c[8].substr(1)])}a=c[11]}return b},o=function(a,b){switch(b[0]){case"nodeName":return new k(a.getElementsByTagName(b[1]),c,null);case"id":if("#document"===a.nodeName){var d=a.getElementById(b[1]);return new k(d?[d]:[],c,null)}return u(new k(a.getElementsByTagName("*"),c,null),b);case"class":return new k(a.getElementsByClassName(b[1]),c,null);case"attribute":case"modifier":case"not":return u(new k(a.getElementsByTagName("*"),c,null),b);default:throw new Error("unknown or invalid criterion type for first step: ["+b[0]+"]")}},p=function(a,b){if(!a)return!0;if(!b&&"function"==typeof a.getBoundingClientRect){var c=a.getBoundingClientRect();if(!(c.width>0&&c.height>0))return!1}return!a.style||"none"!==a.style.display&&"hidden"!==a.style.visibility&&(""===a.style.opacity||parseFloat(a.style.opacity)>0)&&p(a.parentNode,!0)},q=function(a){for(var b=0;b<a.parentNode.childElementCount;b++)if(a===a.parentNode.children[b])return b+1;throw new Error("something went wrong, element is not a child of its parent???")},r=function(a){switch(a.nodeName){case"OPTION":return a.selected;case"INPUT":switch(a.getAttribute("type").toLowerCase()){case"checkbox":case"radio":return a.checked}}},s=function(a,b){var c;if("visible"===a)return p(b);if("checked"===a)return r(b);if(c=/^contains\(\"(.*)"\)$/.exec(a))return-1!==b.textContent.toLowerCase().indexOf(c[1].toLowerCase());if(c=/^nth-child\((\d+)\)$/.exec(a))return parseInt(c[1])===q(b);throw new Error("unknown modifier: ["+a+"]")},t=function(a,b){switch(b[0]){case"id":return a.id===b[1];case"nodeName":return a.nodeName.toLowerCase()===b[1].toLowerCase();case"class":return-1!==(" "+a.className+" ").indexOf(" "+b[1]+" ");case"attribute":var c=String(a.getAttribute(b[1].attribute));switch(b[1].equals){case"=":return c===b[1].value;case"^=":return 0===c.indexOf(b[1].value);case"$=":return c.substr(c.length-b[1].value.length)===b[1].value;default:throw new Error("unknown equality expression: ["+b[1].equals+"]")}break;case"modifier":return s(b[1],a);case"not":return 0===b[1].filter(function(b){return t(a,b)}).length;default:throw new Error("unknown criterion type: ["+b[0]+"]")}},u=function(a,b){return a.filter(function(a,c){return t(c,b)})},v=function(a,b){var c=n(b);if(0===c.length)throw new Error("wrong selector: ["+b+"]");var d=o(a,c.shift());return c.filter(function(a){d=u(d,a)}),d},w=0,x=function(a,b){var c;if(a.ownerDocument.createEvent){if(c=a.ownerDocument.createEvent("MouseEvents"),c.initMouseEvent)c.initMouseEvent(b,!0,!0,a.ownerDocument.defaultView,0,1,1,1,1,!1,!1,!1,!1,0,null);else{if(!c.initEvent)throw new Error("cant init MouseEvent");c.initEvent(b,!0,!0)}a.dispatchEvent(c)}else a.ownerDocument&&a.ownerDocument.defaultView&&a.ownerDocument.defaultView.MouseEvent&&(c=new a.ownerDocument.defaultView.MouseEvent(b),a.dispatchEvent(c))},y=function(a){try{x(a,"mouseover")}catch(b){}try{x(a,"mousedown")}catch(b){}try{x(a,"mouseup")}catch(b){}try{x(a,"click")}catch(b){}},z=function(a){try{return new a.ownerDocument.defaultView.InputEvent("input",{bubbles:!0})}catch(b){}try{return new a.ownerDocument.defaultView.Event("input",{bubbles:!0})}catch(b){}try{var c=a.createEvent("UIEvent");return c.initUIEvent("input"),c}catch(b){}};d.scripts.push({env:{},debug:!1,getName:function(){return"api"},registerWorker:function(a){return d.modules.dispatcher.registerWorker(a),this},result:function(a,b,c){return d.modules.dispatcher.submitWorkerResult(a,b,c),this},skipTask:function(a){return a=a||1,d.modules.dispatcher.manageTaskFlow("skipTask,"+a),this},switchTestSuite:function(a){return d.modules.dispatcher.manageTaskFlow({switchTestSuite:a}),this},skipStep:function(a){return"undefined"==typeof a&&(a=1),d.modules.dispatcher.manageTaskFlow("skipStep,"+a),this},stop:function(){return d.modules.dispatcher.manageTaskFlow("stop"),this},closeCartFiller:function(){return d.modules.ui.closeCartFiller(),this},skipJob:function(){return d.modules.dispatcher.manageTaskFlow("skipJob"),this},repeatTask:function(a){return a=a||1,d.modules.dispatcher.manageTaskFlow("repeatTask,"+a),this},repeatJob:function(){return d.modules.dispatcher.manageTaskFlow("repeatJob"),this},repeatStep:function(a){return c===a&&(a=1),d.modules.dispatcher.manageTaskFlow("repeatStep,"+String(a)),this},nop:function(){return d.modules.dispatcher.submitWorkerResult("","nop"),this},onload:function(a,b){return c===a&&(a=function(){d.modules.api.result()}),d.modules.dispatcher.registerWorkerOnloadCallback(a,b),this},waitFor:function(a,b,e,f,h){h=h||[],c===e&&(e=2e4),c===f&&(f=200);var i=Math.round(e/f);b||(b=""),"string"==typeof b&&(b=function(a){return function(b){d.modules.api.result(b?"":a.length?a:"timeout")}}(b));var j=function(){var c;try{c=a.apply(g(),h)}catch(e){return void d.modules.dispatcher.reportErrorResult(e)}if(!1!==d.modules.dispatcher.getWorkerCurrentStepIndex())if(c)try{h.unshift(c),b.apply(g(),h)}catch(e){return void d.modules.dispatcher.reportErrorResult(e)}else if(i--,i>0)d.modules.api.setTimeout(j,f);else try{h.unshift(!1),b.apply(g(),h)}catch(e){return void d.modules.dispatcher.reportErrorResult(e)}};return d.modules.api.setTimeout(j,0),this},waiter:function(a,b,c,e){return function(){d.modules.api.waitFor(a,b,c,e,f(arguments))}},highlight:function(a,b,c){try{d.modules.ui.highlight(a,b,c),d.modules.dispatcher.setReturnedValueOfStep(a,!0)}catch(e){}return this},arrow:function(a,b,c){try{d.modules.ui.arrowTo(a,b,c),d.modules.dispatcher.setReturnedValueOfStep(a,!0)}catch(e){}return this},"return":function(a){return d.modules.dispatcher.setReturnedValueOfStep(a,!1),this},say:function(a,b,e){return d.modules.ui.say(a===c||null===a?a:String(a),b,e),this},modal:function(a,b){return d.modules.ui.say(a,c,c,!0,b),this},each:function(a,b,e){var f,h=!1,i=function(a){return a===!1||0===a||a===d.modules.api};if(a instanceof Array||a.constructor&&("HTMLCollection"===a.constructor.name||"[object HTMLCollection]"===String(a.constructor)||"NodeListConstructor"===a.constructor.name||"[object NodeListConstructor]"===String(a.constructor))||"[object NodeList]"===String(a)){for(f=0;f<a.length;f++)if(i(b.call(g(),f,a[f]))){h=!0;break}}else if(null!==a&&"object"==typeof a&&"string"==typeof a.jquery&&c!==a.length&&"function"==typeof a.each)a.each(function(a,c){return i(b.call(g(),a,c))?(h=!0,!1):void 0});else for(f in a)if(a.hasOwnProperty(f)&&i(b.call(g(),f,a[f]))){h=!0;break}!h&&e instanceof Function&&e.call(g())},map:function(a,b,e){var f=[];f.map=function(a,b){return d.modules.api.map(f,a,b)};var g=function(a){f.push(a)},h=function(a){f.unshift(a)};return d.modules.api.each(a,function(a,c){return b.apply(f,[a,c,g,h])},e?function(){return e.apply(f,[g,h])}:c),f},compare:function(a,b,c){if(a=String(a),b=String(b),a===b)return"";for(var d=(c?c+": ":"")+"[",e=0;e<Math.max(a.length,b.length);e++){if(a.substr(e,1)!==b.substr(e,1)){d+="] <<< expected: ["+a.substr(e)+"], have: ["+b.substr(e)+"]";break}d+=a.substr(e,1)}return d},setTimeout:function(a,b){d.modules.dispatcher.registerWorkerSetTimeout(setTimeout(d.modules.api.applier(a),b))},setInterval:function(a,b){d.modules.dispatcher.registerWorkerSetInterval(setInterval(d.modules.api.applier(a),b))},click:function(a){return d.modules.api.clicker(a)},clicker:function(a,b){return["click",function(e){if(d.modules.api.debug&&d.modules.api.debug.stop)debugger;return b&&b.apply(g(),arguments),e?(y("object"==typeof e&&"string"==typeof e.jquery&&c!==e.length?e[0]:e instanceof Array||e instanceof k?e[0]:e),void(d.modules.dispatcher.getWorkerCurrentStepIndex()!==!1&&(c===a||a===d.modules.api.result?d.modules.api.result():a===d.modules.api.onload?d.modules.api.onload():a.apply(g(),arguments)))):d.modules.api.result()}]},confirmer:function(a,b,c){return["confirm",function(){d.modules.api.confirm("function"==typeof a?a:a[1],b,c,arguments)}]},confirm:function(a,b,c,e){if(d.modules.api.debug&&d.modules.api.debug.stop)debugger;var f,h=d.modules.ui.mainFrameWindow.confirm,i=!1,j=!1;d.modules.ui.mainFrameWindow.confirm=function(a){return i=!0,f=a,j="undefined"!=typeof c?"object"==typeof c?c.test(a):String(c)===String(a):!0,d.modules.ui.mainFrameWindow.confirm=h,b||"undefined"==typeof b},a.apply(g(),e)},openRelay:function(a,b){return d.modules.dispatcher.openRelayOnTheTail(a,b),this},registerOnloadCallback:function(a,b){return d.modules.dispatcher.registerEventCallback("onload",b?a:"",b?b:a),this},type:function(a,b,c,e){return d.modules.api.typer(a,b,c,e)},typer:function(a,e,f,h,i){var j=[i?"paste value":"type key sequence",function(j){var l=arguments;if(d.modules.api.debug&&d.modules.api.debug.stop)debugger;var m,n=function(){c===e||e===d.modules.api.result?d.modules.api.result():e===d.modules.api.onload?d.modules.api.onload():e.apply(g(),l)};if(!j)return d.modules.api.result();m="object"==typeof j&&"string"==typeof j.jquery&&c!==j.length?j[0]:j instanceof Array||j instanceof k?j[0]:j,m.focus();var o;if(a instanceof Function)o=a.apply(g(),l);else if(c!==d.modules.dispatcher.getWorkerTask()[a])o=d.modules.dispatcher.getWorkerTask()[a];else{if(c===d.modules.dispatcher.getWorkerGlobals()[a])return void d.modules.api.result("Value to type ["+a+"] not found neither in the task properties nor in globals");o=d.modules.dispatcher.getWorkerGlobals()[a]}if(o=String(o),!f)try{m.value=""}catch(p){}var q=m.ownerDocument,r=function(a,c,e){var f=i?"v":a.substr(0,1),g=f.charCodeAt(0);13===g&&(g=0);var k,l=f.charCodeAt(0),m=i?"":a.substr(1),o={get:function(){return g}},p={get:function(){return l}},s={get:function(){return!1}},t=!0;for(var u in{keydown:0,keypress:0,input:0,keyup:0})if(("keypress"!==u||t)&&(f.length||"keypress"!==u)){var v=!1,w=!1;if("input"===u){if(v=z(c),!v)continue}else{if(b.callPhantom){b.callPhantom({keyboardEvent:u,"char":f});continue}v=c.ownerDocument.createEvent("KeyboardEvent");try{Object.defineProperty(v,"keyCode",p)}catch(v){w=!0}try{Object.defineProperty(v,"charCode",o)}catch(v){w=!0}try{Object.defineProperty(v,"metaKey",s)}catch(v){w=!0}try{Object.defineProperty(v,"which",o)}catch(v){w=!0}if(v.initKeyboardEvent?v.initKeyboardEvent(u,!0,!0,q.defaultView,!1,!1,!1,!1,g,l):v.initKeyEvent(u,!0,!0,q.defaultView,!1,!1,!1,!1,l,g),h&&(v.keyCode!==l||v.charCode!==g))return d.modules.api.result("could not set correct keyCode or charCode for "+u+": keyCode returns ["+v.keyCode+"] instead of ["+l+"], charCode returns ["+v.charCode+"] instead of ["+g+"]"),!1;if(h&&v.metaKey)return d.modules.api.result("could not set metaKey to false"),!1}k=!0;try{k=c.dispatchEvent(v)}catch(v){}if(k||"keydown"!==u||(t=!1),(w||k)&&"keypress"===u){var x=c.value+(i?a:f),y=!1;try{if(Object.getOwnPropertyDescriptor&&"function"==typeof Object.getOwnPropertyDescriptor){var A=Object.getOwnPropertyDescriptor(c.constructor.prototype,"value");A&&A.set&&"function"==typeof A.set&&(A.set.apply(c,[x]),y=!0)}}catch(v){}y||(c.value=x)}}if(0===m.length){try{var B=new c.ownerDocument.defaultView.Event("change",{bubbles:!0});c.dispatchEvent(B)}catch(v){}try{var C=z(c);C&&c.dispatchEvent(C)}catch(v){}try{"function"==typeof c.ownerDocument.defaultView.jQuery&&c.ownerDocument.defaultView.jQuery(c).change()}catch(v){}d.modules.api.arrow(j),n()}else d.modules.api.setTimeout(function(){r(m,c,e)},0)};r(o,m,e)}],l={};[a,e].filter(function(a){"function"==typeof a?d.modules.dispatcher.discoverTaskParameters(a,l):c!==a&&(l[a]=!0)}),j[1].cartFillerParameterList=[];for(var m in l)j[1].cartFillerParameterList.push(m);return j},paster:function(a,b,c,d){return this.typer(a,b,c,d,!0)},apply:function(a){try{for(var b=[],c=1;c<arguments.length;c++)b.push(arguments[c]);a.apply(d.modules.dispatcher.getWorker(),b)}catch(e){throw d.modules.dispatcher.reportErrorResult(e),e}},applier:function(a){return function(){for(var b=[a],c=0;c<arguments.length;c++)b.push(arguments[c]);d.modules.api.apply.apply(d.modules.api,b)}},define:function(a,b){if(a instanceof Function){var c=/^\s*function\s+([^(]+)\(/;if(!c.test(a.toString())){var e="invalid shared function definition, if name is not specified as first parameter of api.define() call, then function should be named";throw alert(e),new Error(e)}var f=c.exec(a.toString());b=a,a=f[1]}return d.modules.dispatcher.defineSharedWorkerFunction(a,b),this},sleep:function(a){if("undefined"==typeof a){var b=d.modules.ui.getMessageToSay();a="undefined"===b?0:1e3+Math.floor(20*String(b).length)}return d.modules.dispatcher.setSleepAfterThisStep(a),this},window:function(){var a=d.modules.ui.getMainFrameWindow();return d.modules.dispatcher.getFrameToDrill().filter(function(b){a=a.frames[b]}),a},document:function(){return d.modules.ui.getMainFrameWindowDocument(this.window())},drill:function(a,b){var c=this.window(),e=d.modules.dispatcher.getFrameToDrill().length;w++;try{if(e>=w)b.apply(c.document);else{var f=a.apply(c.document);if(!f)throw new Error("frame was not selected for drill function");for(var g=0;g<c.frames.length;g++)if(f===c.frames[g]){for(var h=c.document.getElementsByTagName("iframe"),i=0;i<h.length;i++)h[i].contentWindow===f&&(d.log("adding iframe to track"),d.modules.ui.addElementToTrack("iframe",h[i],!0,[i]));return d.modules.dispatcher.drill(g)}}}catch(j){throw w--,j}return w--,this},compareCleanText:function(a,b){return e(a)===e(b)},containsCleanText:function(a,b){return-1!==e(a).indexOf(e(b))},suspendRequests:function(a){d.modules.dispatcher.onMessage_toggleEditorMode({enable:!1,cb:a})},setAdditionalWindows:function(a){return a=a||[],d.modules.dispatcher.setAdditionalWindows(a),this},switchToWindow:function(a){return d.modules.dispatcher.switchToWindow(a),this},find:function(a,b){return c===a||""===a?new k([],c,function(){return[]}):new k([b||this.document()],c,function(){return[b||d.modules.api.document()]}).find(a)},getSelectorClass:function(){return k},openUrl:function(a){if(!a)throw new Error("empty url specified for api.openUrl");var b=d.modules.ui.mainFrameWindow.location.href.split("#")[0];return d.modules.ui.mainFrameWindow.location.href=a,a.split("#")[0]===b&&d.modules.ui.mainFrameWindow.location.reload(),this},isRelayRegistered:function(a){return d.modules.dispatcher.isRelayRegistered(a)},getDocument:function(){return g()},internalDebugger:function(){if(this.debug&&this.debug.stop)debugger;return this},resetDrillDepth:function(){w=0},exportCsv:function(a,d,e,f){f=f||"text/csv",e=e||[];var g={},h=function(a){return a===c||null===a?"":String(a)};e.filter(function(a){g[a]=a}),a.filter(function(a){for(var b in a)g[b]||(g[b]=b,e.push(b))});var i=0;a.unshift(g),a.filter(function(a){i+=2,e.filter(function(b){i+=h(a[b]).length+3})});var j=new ArrayBuffer(2*i+2),k=new Uint16Array(j);k[0]=65279;var l=1;a.filter(function(a){(e.map(function(b){return'"'+h(a[b]).replace(/"/g,'""')+'"'}).join("	")+"\r\n").split("").filter(function(a){k[l++]=a.charCodeAt(0)})});var m=k.buffer,n=new Blob([m],{type:f}),o=b.document.createElement("a");return o.setAttribute("href",b.URL.createObjectURL(n)),o.setAttribute("download",d),b.document.getElementsByTagName("body")[0].appendChild(o),o.click(),o.parentNode.removeChild(o),this}})}.call(this,document,window),function(a,b,c){"use strict";var d,e,f,g=this.cartFillerConfiguration,h=function(a,b){return g.modules.api[a].apply(g.modules.api,b)},i=function(a){return JSON.stringify(a.map(function(a){return a instanceof RegExp?String(a):a})).replace(/^\[/,"(").replace(/\]$/,")")},j=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c]);return b},k=function(a,b){for(var c=0;c<a.length;c++)if("name"===a[c][0]&&a[c][1][0]===b)return a.slice(c);throw new Error('when trying to do .since("'+b+'") the preceding .name("'+b+'") was not found')},l=function(a,b){var c=g.modules.dispatcher.recursivelyCollectSteps(a);return b&&c instanceof Array&&c.length>0&&"string"==typeof c[0]&&(c[0]=b),c},m=function(a,b){for(var c=b.length-2;c>=0;c-=2)if(b[c]===a)return c/2;throw new Error("step not found: ["+a+"]")},n=!1,o=function(a){return"function"==typeof a[1]&&(a[1].cartFillerMakePauseBeforeStep=!0),a},p=function(a){return!0===a?["return true",function(){h("nop")}]:!1===a?["return false",function(){h("result",["false"])}]:"string"==typeof a?["check string: "+a,function(){if(g.modules.api.debug&&g.modules.api.debug.stop)debugger;h("result",[g.modules.dispatcher.interpolateText(a).length?"":"empty string"])}]:void 0},q=function(a,b){var c=function(){if(g.modules.api.debug&&g.modules.api.debug.stop)debugger;b&&h("skipStep",[b]),h("nop")};return c.cartFillerBreakFactor=0===a.length?1:a[0],["break: "+i(a),c]},r=function(a,b){var c={};for(var d in a)c[d]=a[d];for(d in b)c[d]=b[d];return c},s=function(){f=function(){},f.prototype=Object.create({}),["find","result","say","onload","nop"].filter(function(a){f.prototype[a]=function(){return h(a,arguments)}}),e=function(){this.mode=0,this.tasks={},this.shares={},this.lib={},this.unexportedTasks={};var a=this;n=this,this.runtime=new f;var b=this.LibReferencePromise=function(a){this.name=a},e=this.BuilderPromise=function(b,c,d){this.arr=(1===d.length&&""===d[0][0]?[]:d.slice()).concat(b?[[b,c]]:[]);var e=d.filter(function(a){return"task"===a[0]});e.length&&(a.unexportedTasks[e[e.length-1][1][0]]=this.arr)},s=function(c){return"get"===c[0][0]&&c[0][1][0]instanceof b?a.lib[c[0][1][0].name].arr.concat(c.slice(1)):"lib"===c[0][0]||"uselib"===c[0][0]?a.lib[c[0][1][0]].arr.concat(c.slice(1)):c},t=this.wrapSelectorBuilderPromise=function(a){if(a=s(a),1===a.length){if("get"!==a[0][0])throw new Error("only get is allowed as first step of selector promise, we have ["+a[0][0]+"] instead");return a[0][1][0]instanceof e?t(a[0][1][0].arr):g.modules.dispatcher.injectTaskParameters(function(){return h("find",a[0][1])},[a[0][1]])}var b=a.slice(),c=b.pop(),d=t(b);return g.modules.dispatcher.injectTaskParameters(function(){var a=d();return a[c[0]].apply(a,c[1])},[d].concat(c[1]))};if(e.prototype=Object.create({}),e.prototype["export"]=function(b){if(!b&&("task"===this.arr[0][0]&&(b=this.arr[0][1][0]),!b))throw new Error("When using export without parameters, you should name task at the very beginning using cf.task('thename')");if(a.tasks[b]||a.shares[b])throw new Error("task or share or generator ["+b+"] already exists, looks like you try to overwrite it by cf.export() another time");return a.tasks[b]=this.$since?k(this.arr,this.$since[0]):this.arr,this},e.prototype.lib=function(b,c){if(a.lib[b])throw new Error("lib ["+b+"] is already defined, you are trying to redefined it");return("function"==typeof c||c instanceof e)&&(a.lib[b]=c),new e("lib",[b],this.arr)},e.prototype["const"]=function(a){return function(){return a}},e.prototype.share=function(b){if(a.tasks[b]||a.shares[b])throw new Error("task or share or generator ["+b+"] already exists, looks like you try to overwrite it by cf.share() another time");return a.shares[b]=this.$since?k(this.arr,this.$since[0]):this.arr,this},e.prototype.generator=function(b,c){if(a.tasks[b]||a.shares[b])throw new Error("task or share or generator ["+b+"] already exists, looks like you try to overwrite it by cf.generator() another time");return a.shares[b]=c,this},["since"].filter(function(a){e.prototype[a]=function(){var b=new e(c,c,this.arr);return b["$"+a]=j(arguments),b}}),this.cf=new e("",[],[]),!this.cf)throw console.log("no this.cf, checking BuilderPromise"),console.log(e),console.log(typeof e),console.log(e.prototype),console.log(typeof e.prototype),new Error("unable to use declarative mode - probably browser incompatibility");var u=this.Builder=function(){this.namedResults={}};u.prototype=Object.create({}),u.prototype.uselib=function(c,d,f){if(c[0]instanceof e||c[0]instanceof b)return c[0]instanceof e?"lib"===c[0].arr[0][0]?this.build(a.lib[c[0].arr[0][1][0]].arr,[],d,f):this.build(c[0].arr,[],d,f):this.build(a.lib[c[0].name].arr,d,f);if(!a.lib[c[0]])throw new Error("lib entry '"+c[0]+"' is not defined");var g=this.build(a.lib[c[0]].arr).map(function(a,b){return b%2===0?"uselib('"+c[0]+"')->"+a:a});return g},u.prototype.clear=function(){return["remove all arrows",function(){h("arrow"),h("nop")}]},u.prototype.set=function(a){if(2!==a.length)throw new Error("cf.set only makes sense with 2 arguments - global variable name and value");var b=a[0],c=a[1];return["set global variable ["+b+"] to ["+c+"]",function(){g.modules.dispatcher.getWorkerGlobals()[b]=g.modules.dispatcher.interpolateText(c),h("nop")}]},u.prototype.inc=function(a){if(1!==a.length)throw new Error("cf.inc only makes sense with 1 argument - global variable name to increment");var b=a[0];return["inc global variable ["+b+"]",function(){g.modules.dispatcher.getWorkerGlobals()[b]++,h("nop")}]},u.prototype.asglobal=u.prototype.asGlobal=function(a){if(1!==a.length)throw new Error("cf.asglobals only makes sense with 1 argument - global variable name");var b=a[0];return["set global variable ["+b+"]",function(a){if(a instanceof g.modules.api.getSelectorClass())throw new Error(".asglobal is only applicable to scalars");g.modules.dispatcher.getWorkerGlobals()[b]=a,h("nop")}]},u.prototype.stop=function(){return["stop letting user interact",function(){h("stop").result()}]},u.prototype.closeCartfiller=function(){return["exit CartFiller",function(){h("closeCartFiller").result()}]},u.prototype.get=function(c,d,f){return c[0]instanceof e||c[0]instanceof b?c[0]instanceof e?"lib"===c[0].arr[0][0]?this.build(a.lib[c[0].arr[0][1][0]].arr,[],d,f):this.build(c[0].arr,[],d,f):this.build(a.lib[c[0].name].arr,d,f):["get"+i(c),function(){if(g.modules.api.debug&&g.modules.api.debug.stop)debugger;h("find",c).arrow(1).nop()}]},u.prototype.as=function(a,b){return this.namedResults[a[0]]=b,[]};var v=function(a,b){return['with("'+a+'")',function(){if(g.modules.api.debug&&g.modules.api.debug.stop)debugger;arguments[b]instanceof g.modules.api.getSelectorClass()?arguments[b].arrow().nop():h("return",[arguments[b]]).nop()}]};u.prototype["with"]=function(a,b){for(var c=[],d=0,e=a.length-1;e>=0;e--)c.push.apply(c,v(a[e],d+b-this.namedResults[a[e]])),d++;return c};var w=function(a,b,d,e,f){return a?x(b,d,e,f):function(a){if(f)h("waitFor",[function(){if(g.modules.api.debug&&g.modules.api.debug.stop)debugger;return a.reevaluate(),b(a)},e||function(){a.arrow(1).result(b(a)?"":d,!0)},f||c,c,[a]]);else{if(g.modules.api.debug&&g.modules.api.debug.stop)debugger;a.reevaluate(),h("result",[b(a)?"":d])}}},x=function(a,b,d,e){return g.modules.dispatcher.injectTaskParameters(function(f){h("waitFor",[function(){if(g.modules.api.debug&&g.modules.api.debug.stop)debugger;

return f.reevaluate(),a(f)},d||function(a){f.arrow(1).result(a?"":b)},e||c,c,[f]])},[a,b,d])},y=function(a,b,c){return function(d,e,f){var j=this;if("exists"===a||"absent"===a||"exactly"===a){if(f.condition&&b)throw new Error("You shouldn't use "+b+" within evaluation block of if/ifNot/while/whileNot");return[(b||a)+i(d),w(!f.condition,function(b){return"exists"===a?b.length:"exactly"===a?b.length===parseInt(g.modules.dispatcher.interpolateText(d[0])):!b.length},"exists"===a?"element did not appear within timeout":"element did not disappear within timeout",c,"exactly"===a?d[1]:d[0])]}if("add"===a){if(1!==d.length)throw new Error("add can only have 1 argument");var k=j.get([d[0]],e,f);return k.concat([(b||a)+i(d),g.modules.dispatcher.injectTaskParameters(function(){if(g.modules.api.debug&&g.modules.api.debug.stop)debugger;var a=arguments[k.length/2],b=a.add(arguments[0]);b.arrow(1).nop()},d)])}if("is"===a||"isNot"===a)return[(b||a)+i(d),w(!f.condition,function(b){if(g.modules.api.debug&&g.modules.api.debug.stop)debugger;return"is"===a?b.arrow(1).is(d[0]):!b.arrow(1).is(d[0])},"is"===a?"element.is('"+d[0]+"') is not true":"element.is('"+d[0]+"') is true but should not be",c,d[1])];if("val"===a&&d.length>1)throw new Error("cf.val at build stage only makes sense with one argument to set element.value or with no arguments to get element value");if("attr"===a&&(d.length>2||d.length<1))throw new Error("cf.attr at build stage only makes sense with two arguments to set element attribute to or one argument to get attribute value");return[(b||a)+i(d),g.modules.dispatcher.injectTaskParameters(function(b){if(g.modules.api.debug&&g.modules.api.debug.stop)debugger;var c=b[a].apply(b,d);"val"===a&&d.length>0&&(c=b),c instanceof g.modules.api.getSelectorClass()?c.arrow(1).nop():h("return",[c]).nop()},d)]}};for(d in g.modules.api.getSelectorClass().prototype)"arrow"!==d&&"highlight"!==d&&"result"!==d&&"nop"!==d&&"stop"!==d&&(u.prototype[d]=y(d));["say","repeatTask","repeatStep","skipTask","skipStep","repeatJob","skipJob","openUrl","sleep"].filter(function(b){a.Builder.prototype[b]=function(a,c){return[b+i(a),function(d){if(g.modules.api.debug&&g.modules.api.debug.stop)debugger;var e;if("repeatStep"===b||"skipStep"===b){var f=m(a[0],g.modules.api.env.taskSteps);e=["repeatStep"===b?c-f+1:f-c+1].concat(a.slice(1))}else e=a.slice();var i=!0;"say"===b?(e[0]=g.modules.dispatcher.interpolateText(e[0]),e[2]&&(i=!1)):"openUrl"===b&&(e[0]=g.modules.dispatcher.interpolateText(e[0]));var j;return j="say"===b&&d instanceof g.modules.api.getSelectorClass()?d[b].apply(d,e):h(b,e),"say"===b&&!e[2]&&(h("sleep"),i)?void h("waitFor",[function(){return g.modules.ui.isMessageStable()}]):void("openUrl"===b?h("onload"):i&&j.result())}]}}),u.prototype.pause=function(a){var b=a[0];return["pause for ["+b+"] ms",function(){h("setTimeout",[function(){h("result")},b])}]},u.prototype.nop=function(){return["nop",function(){if(g.modules.api.debug&&g.modules.api.debug.stop)debugger;h("nop")}]},u.prototype.click=function(a,b,c){return o(y("exists","click",function(a,b){a?h("clicker")[1](b.arrow(1)):b.result("element did not appear within timeout")})(a,b,c))},u.prototype.isNot=function(a,b,c){return y("isNot")(a,b,c)},u.prototype.ready=function(){return["wait for readyState become complete",function(){h("waitFor",[function(){return"complete"===h("getDocument").readyState}])}]},u.prototype.type=function(a,b,d){return o(y("exists","type",function(b,d){b?h("typer",[function(){return g.modules.dispatcher.interpolateText(a[0])},c,a[1]])[1](d.arrow(1)):d.result("element did not appear within timeout")})([],b,d))},u.prototype.paste=function(a,b,d){return o(y("exists","type",function(b,d){b?h("paster",[function(){return g.modules.dispatcher.interpolateText(a[0])},c,a[1]])[1](d.arrow(1)):d.result("element did not appear within timeout")})([],b,d))},u.prototype.enter=function(a,b,d){return o(y("exists","enter",function(a,b){a?h("typer",[function(){return"\r"},c,!0])[1](b.arrow(1)):b.result("element did not appear within timeout")})([],b,d))},u.prototype.then=function(a){return["then("+i(a)+")",g.modules.dispatcher.injectTaskParameters(a[0],a)]},u.prototype.onload=function(a){return["onload("+i(a)+")",g.modules.dispatcher.injectTaskParameters(function(){h("onload",[a[0],!0])},a)]},u.prototype.tbd=function(a){return["tbd("+i(a)+")",g.modules.dispatcher.injectTaskParameters(function(){h("result",["tbd"])},a)]},u.prototype.use=function(b){if("string"==typeof b[0]){var c=b[0],d=a.tasks[c]||a.shares[c];if(!d)throw new Error("share or task or generator ["+c+"] is not defined");return d instanceof Function&&(d=d.apply(null,b.slice(1)).arr),this.build(d)}return b[0]instanceof e?this.build(b[0].arr):void 0},u.prototype.useIf=function(a){return a[0]?this.use(a.slice(1)):[]},u.prototype.useIfNot=function(a){return a[0]?[]:this.use(a.slice(1))},u.prototype.name=function(){return[]};var z=function(a,b,d,e,f,i){var j=a[0],k=a[1],l=e?c:a[2],m=p(a[0])||b.build(j.arr,[],r(i,{condition:!0}),f),n=m.length/2,o=k?b.build(k.arr,[],c,f+n+1):[],s=o.length/2,t=l?b.build(l.arr,[],c,f+n+1+s+1):[],u=t.length/2,v=t.length?!0:!1;return e&&(s++,o.push("repeat",function(){if(g.modules.api.debug&&g.modules.api.debug.stop)debugger;h("repeatStep",[s+n+1]),h("nop")}),o=o.map(function(a,b){return b%2&&a.cartFillerBreakFactor?q([a.cartFillerBreakFactor-1],s-b/2)[1]:a})),v&&(s++,o.push("skip else section",function(){if(g.modules.api.debug&&g.modules.api.debug.stop)debugger;h("skipStep",[u]),h("nop")})),m.filter(function(a,b){b%2&&(a.cartFillerCaptureResult=n-(b-1)/2)}),m.push((e?"while":"if")+(d?"Not":"")+" - check condition evaluation result",function(a){if(g.modules.api.debug&&g.modules.api.debug.stop)debugger;a[2]?h("arrow",[a[1],1]):h("return",[a[1]]),(!d&&a[0]||d&&!a[0])&&h("skipStep",[s]),h("nop")}),m.concat(o).concat(t)};u.prototype.inside=function(a,b,c){var d=this.build(a[0].arr,[],r(c,{inside:!0}),b);return d.map(function(a,b){if(b%2){var c=function(){if(g.modules.api.debug&&g.modules.api.debug.stop)debugger;var c=arguments[(b-1)/2],d=j(arguments);h("drill",[function(){return c[0].contentWindow},function(){a.apply(this,d)}])};return a.cartFillerCaptureResult&&(c.cartFillerCaptureResult=a.cartFillerCaptureResult),c}return a})},u.prototype["if"]=function(a,b,c){return z(a,this,!1,!1,b,c)},u.prototype.ifNot=function(a,b,c){return z(a,this,!0,!1,b,c)},u.prototype["while"]=function(a,b,c){return z(a,this,!1,!0,b,c)},u.prototype.whileNot=function(a,b,c){return z(a,this,!0,!0,b,c)},u.prototype["break"]=function(a){return q(a)},u.prototype.task=function(){return[]};var A=function(b){return function(){return a.mode?this.runtime[b].apply(this.runtime,arguments):new e(b,j(arguments),this.arr)}};for(d in u.prototype)u.prototype.hasOwnProperty(d)&&(e.prototype[d]=A(d));u.prototype.build=function(a,b,d,e){d=d||{},e=e||0;var f,g=(b||[]).slice(),h=this;return a.filter(function(a){if("lib"!==a[0]){if(!h[a[0]])throw new Error("step ["+a[0]+"] is not known to builder");g.push.apply(g,l(h[a[0]](a[1],g.length/2+e,d),f)),f="name"===a[0]?f?f:a[1][0]:c}}),g}},e.prototype=Object.create({}),e.prototype.switchMode=function(){this.mode=1},e.prototype.getCf=function(){return this.cf},e.prototype.libFunction=function(){var a=arguments[0];if(0===this.mode){if(a instanceof this.BuilderPromise){var b=a.arr.filter(function(a){return"lib"===a[0]});b.length&&(a=b[0][1][0])}if("function"==typeof this.lib[a])throw new Error("this is not implemented");return this.lib[a]instanceof this.BuilderPromise?this.lib[a]:new this.LibReferencePromise(a)}throw new Error("lib is not available in runtime")},e.prototype.getLib=function(){var a=this;return function(){return a.libFunction.apply(a,arguments)}},e.prototype.buildTasks=function(a){var b;for(b in this.unexportedTasks)this.tasks[b]||(this.tasks[b]=this.unexportedTasks[b]);var c=a||{};for(b in this.tasks)c[b]=this.buildTask(this.tasks[b]);return c},e.prototype.buildTask=function(a){var b=new this.Builder;return b.build(a,[])}};g.scripts.push({getName:function(){return"cf"},onLoaded:function(){s()},create:function(){return new e},getlib:function(a){return n?n.wrapSelectorBuilderPromise(n.lib[a].arr)():g.modules.api.find()},getLibSelectors:function(){var a={};if(n)for(var b in n.lib)if(n.lib[b]instanceof n.BuilderPromise)try{var c=n.wrapSelectorBuilderPromise(n.lib[b].arr)();c.length&&(a[b]=c)}catch(d){}return a}})}.call(this,document,window),function(document,window,undefined){"use strict";var worker=!1,postMessageFromWindowToWindow=function(a,b,c,d){c.tmpReference1892049810jf10jfa=d,b.cmd=a;var e="cartFillerMessage:"+JSON.stringify(b);c.eval("tmpReference1892049810jf10jfa.postMessage("+JSON.stringify(e)+', "*");')},evaluatedCssSelectorElements=[],reinitializeWorker=function(){var a=workerCurrentTask,b=me.modules.api,c=function(){return(workerGlobals["_foreach stack"]||"").split("|")},d=function(a){workerGlobals["_foreach stack"]=a.join("|")},e=["set [ref] to [value]",function(){b.internalDebugger(),a.ref=a.value,b.result()}];worker={_set:e,"^global variable ${ref} has value ${value}$":e,"^current url is ${url}$":["open url",function(){me.modules.ui.mainFrameWindow.location.href=a.url,b.onload()}],_loop:["check [ref] against [value]",function(){b.internalDebugger(),parseInt(a.ref)<parseInt(a.value)&&b.repeatTask(a.tasks),b.result()}],_inc:["inc [ref]",function(){b.internalDebugger(),a.ref=parseInt(a.ref)+1,b.result()}],_assertEquals:["assert that [ref] is equals to [value]",function(){b.internalDebugger().result(b.compare(a.value,a.ref))}],_wait:["wait for tasks to be added",function(){b.internalDebugger().repeatTask().setTimeout(b.result,1e3)}],_say:["say some static message",function(){a.clear&&b.arrow(),b.internalDebugger().say(a.message,a.pre,a.nextButton).sleep(a.sleepMs),a.nextButton||b.result()}],_foreach:["check whether we are looping",function(){b.internalDebugger();var a=c(),e=-1,f="",g=0;if(a.filter(function(a,c){parseInt(a.split(":")[0])===b.env.taskIndex&&(e=c,f=a)}),-1!==e){var h=f.split(":");a=a.slice(0,e),"*"===h[2]&&(g=parseInt(h[1]))}f=String(b.env.taskIndex)+":"+g,a.push(f),d(a),b.nop()},"initialize values",function(){b.internalDebugger();var e=c(),f=e.pop(),g=f.split(":"),h=parseInt(g[1]),i=a.values.split(a.separator);if(a.index=h,a.value=i[h],a.fields){var j=a.value.split(a.fieldSeparator||",").map(function(a){return a.trim()});a.fields.split(a.fieldSeparator||",").filter(function(a){workerGlobals[a]=j.shift()})}h===i.length-1&&(f=g[0]+":-",e.push(f),d(e)),b.nop()}],_endforeach:["loop",function(){b.internalDebugger();var a=c(),e=a.pop(),f=e.split(":");return"-"===f[1]?(d(a),b.nop()):(e=String(f[0])+":"+String(parseInt(f[1])+1)+":*",a.push(e),d(a),void b.repeatTask(1+b.env.taskIndex-parseInt(f[0])).nop())}],_closeCartFiller:["close CartFiller, only for 'clean' injection mode",function(){b.internalDebugger(),b.closeCartFiller().result()}],_stop:["stop letting user to interact",function(){b.internalDebugger(),b.stop().result()}]}},INTERPOLATE_PATTERN=/(^|[^\\])\$\{([^${}}]+)}/g,workerSourceCodes={},workerCurrentTask={},workerCurrentTaskIndex=!1,workerCurrentStepIndex=!1,workerOnLoadHandler=!1,onLoadHappened=!1,shadowedOnLoadHappened=!1,workerTimeout=0,workerSetTimeoutIds=[],workerSetIntervalIds=[],workerWatchdogId=!1,captureWorkerFnResult=!1,workerGlobals={},currentCf,workerLibResolve=function(a,b,c){var d,e;if("function"==typeof a||a instanceof Array){var f=!1;if(undefined===b.promiseArgs[0]&&"function"==typeof a&&"string"==typeof a.name&&a.name.length)e="helper",d=a.name;else{if("string"!=typeof b.promiseArgs[0]||!b.promiseArgs[0].length||"function"==typeof a&&"string"==typeof a.name&&a.name.length)throw new Error("invalid lib usage, name of function should either be specified as a parameter or named function should be used");e="step builder",d=b.promiseArgs[0],f=!0}var g=b.promiseArgs.slice(1);return"function"==typeof a?(workerLibByWorkerPath[c][d]=a,workerLibByWorkerPath[c][d].cartFillerWorkerLibType=e,f?a.apply({},g):[]):(workerLibByWorkerPath[c][d]=function(){return a},workerLibByWorkerPath[c][d].cartFillerWorkerLibType=e,a)}if(d=b.promiseArgs[0],"function"==typeof d){if("string"!=typeof d.name||!d.name.length)throw new Error("incorrect usage of lib, only named functions should be defined like that");return workerLibByWorkerPath[c][d.name]=d,workerLibByWorkerPath[c][d.name].cartFillerWorkerLibType="helper",[]}var h=d.split(".");d=h.pop();var i=workerLibByWorkerPath[c];if(h.filter(function(a,b){if(!i[a]||!i[a].cartFillerWorkerLibFn)throw new Error("lib ["+c+"]->["+h.slice(0,b).join(".")+"] does not have ["+a+"] sublib");i=i[a]}),!i.hasOwnProperty(d))throw new Error("lib ["+c+"]->["+h.join(".")+"] does not have ["+d+"] entry");return"function"==typeof i[d]?i[d].apply({},b.promiseArgs.slice(1)):i[d]},workerLibByWorkerPath,workerLib,workerLibFactory=function(a){var b=function(){var b=function(c){return workerLibResolve(c,b,a.join("."))};b.cartFillerLibPromiseFunction=!0,b.promiseArgs=[];for(var c=0;c<arguments.length;c++)b.promiseArgs.push(arguments[c]);return b.none=[],b};return b.cartFillerWorkerLibFn=!0,b.cartFillerWorkerLibPath=a.join("."),b},makeProxyForWorkerLib=function(a){var b=function(){var b;try{b=me.modules.ui.mainFrameWindow.document}catch(c){}return a.apply(b,arguments)};return b.cartFillerWorkerLibType=a.cartFillerWorkerLibType,"step builder"!==b.cartFillerWorkerLibType&&(b.cartFillerWorkerLibType="helper"),a.cartFillerWorkerLibType=b.cartFillerWorkerLibType,b},workerLibBrief={},workerUrlsCommonPart,resetWorkerLib=function(){workerLib=workerLibFactory([]),workerLibByWorkerPath={},workerLibBrief={},workerUrlsCommonPart=!1;for(var a in workerSourceCodes)if(!1!==workerUrlsCommonPart){for(var b=workerUrlsCommonPart.length;b>=0&&workerUrlsCommonPart.substr(0,b)!==a.substr(0,b);b--);workerUrlsCommonPart=workerUrlsCommonPart.substr(0,b)}else workerUrlsCommonPart=a},ambiguousWorkerLibProxyFunctionFactory=function(a){return function(){throw new Error("["+a+"] is ambiguous inside lib, use fully qualified name")}},processWorkerLibByPath=function(a,b){for(var c in a)a.hasOwnProperty(c)&&("function"==typeof a[c]?a[c]=makeProxyForWorkerLib(a[c]):"object"==typeof a[c]&&(a[c].cartFillerWorkerLibType="steps"),workerLib[c]=workerLib.hasOwnProperty(c)?ambiguousWorkerLibProxyFunctionFactory(c):a[c],a[c].cartFillerWorkerLibType&&(workerLibBrief[(b.join(".")+"."+c).replace(/^\./,"")]=a[c].cartFillerWorkerLibType));var d=workerLib,e=[];b.filter(function(c,f){if(e.push(c),undefined===d[c])d[c]=f===b.length-1?a:workerLibFactory(e);else{if(!d[c].cartFillerWorkerLibFn)throw new Error("naming conflict, can't put workerLib on this path: ["+e.join(".")+"]");if(f===b.length-1)throw new Error("can't replace workerLib on this path: ["+e.join(".")+"]")}d=d[c]})},processWorkerTasks=function(a){for(var b in a)a.hasOwnProperty(b)&&(worker[b]=recursivelyCollectSteps(a[b]),workerTaskSources[b]=currentEvaluatedWorker)},postProcessWorkerLibs=function(){for(var a in workerLibByWorkerPath)for(var b in workerLib)workerLib.hasOwnProperty(b)&&!workerLibByWorkerPath[a].hasOwnProperty(b)&&(workerLibByWorkerPath[a][b]=workerLib[b])},makeLibPathFromWorkerPath=function(a){return a.substr(workerUrlsCommonPart.length).replace(/(^|\/)workers\//g,function(a,b){return b}).replace(/\.js$/,"").split("/")},workerEventListeners={},resultMessageName=!1,statusMessageName=!1,mainFrameLoaded=!1,workerFrameLoaded=!1,workerCurrentUrl=!1,knownCurrentUrls={},bootstrapped=!1,returnedValuesOfSteps=[],returnedValuesOfStepsAreForTask,mostRecentReturnedValueOfStep,mostRecentReturnedValueOfStepIsElement,jobDetailsCache={},stepRepeatCounter=0,currentStepEnv={},currentStepWorkerFn,me=this.cartFillerConfiguration,oldTitle,sleepAfterThisStep,useTopWindowForLocalFileOperations,currentInvokeWorkerMessage,suspendAjaxRequestsCallback,magicParamPatterns={repeat:/repeat(\d+)/,sleep:/sleep(\d+)/},rememberedHashParams={},hideHashParam={},mainWindowOwnedByTestSuite=window.document.getElementsByTagName("body")[0].getAttribute("data-cartfiller-is-here")?!0:!1,relay={isSlave:!1,slaveCounter:0,parent:!1,currentMainFrameWindow:0,nextRelay:!1,nextRelayDomain:!1,nextRelayRegistered:!1,nextRelayQueue:[],knownDomains:{},registeredDomains:{},noFocusForDomain:{},igniteFromLocal:!1,recoveryPoints:{},bubbleMessage:function(a){this.isSlave&&postMessage(this.parent,"bubbleRelayMessage",a),this.nextRelay&&(this.nextRelayRegistered?postMessage(this.nextRelay,"bubbleRelayMessage",a):(a.cmd="bubbleRelayMessage",this.nextRelayQueue.push(a)))}},getWorkerFnParams=function(){returnedValuesOfStepsAreForTask!==workerCurrentTaskIndex&&(returnedValuesOfSteps=[returnedValuesOfSteps.pop()],returnedValuesOfStepsAreForTask=workerCurrentTaskIndex);for(var a=[],b=1,c=workerCurrentStepIndex;c>=0;c--)if(c in returnedValuesOfSteps){for(;b--;)a.push(returnedValuesOfSteps[c]);b=1}else b++;return a},callEventCallbacks=function(a){if(undefined!==workerEventListeners[a])for(var b in workerEventListeners[a])workerEventListeners[a][b]()},postMessage=function(a,b,c,d){undefined===d&&(d="cartFillerMessage"),undefined===c&&(c={}),c.cmd=b;var e=JSON.stringify(c),f=d+":"+e;"function"==typeof a.postMessage?a.postMessage(f,"*"):console.log("unable to send message to window: "+f)},resetWorker=function(){clearRegisteredTimeoutsAndIntervals(),workerCurrentTaskIndex=workerCurrentStepIndex=workerOnLoadHandler=suspendAjaxRequestsCallback=!1},fillWorkerCurrentTask=function(a){for(var b in workerCurrentTask)workerCurrentTask.hasOwnProperty(b)&&delete workerCurrentTask[b];var c;for(var d in a)a.hasOwnProperty(d)&&(c=a[d],c instanceof Array&&(c=decodeAlias(c)),workerCurrentTask[d]=c)},decodeAlias=function(a,b){var c;if("string"==typeof a)return c=b?a:"_random"===a?String((new Date).getTime())+String(Math.floor(1e3*Math.random())):"_timestamp"===a?String((new Date).getTime()):workerGlobals[a];if(1===a.length){if(a=a[0],"string"==typeof a)return c=b?a:decodeAlias(a);if(a instanceof Array)return c=b?decodeAlias(a):workerGlobals[decodeAlias(a)];throw new Error("incorrect value: ["+typeof a+"] [ "+JSON.stringify(a)+"]")}return c=0===a.length?b?undefined:prompt("enter value for "+newKey,""):b?undefined:a.map(function(a){return a instanceof Array?String(decodeAlias(a)):a}).join("")},fillWorkerGlobals=function(a){me.log(a);for(var b in workerGlobals)workerGlobals.hasOwnProperty(b)&&delete workerGlobals[b];for(var c in a)a.hasOwnProperty(c)&&(workerGlobals[c]=a[c])},getLibUrl=function(){return me.localIndexHtml?"":me.baseUrl.replace(/(src|dist)\/?$/,"lib/")},nextTaskFlow,initialized,clearRegisteredTimeoutsAndIntervals=function(){for(;workerSetTimeoutIds.length;)clearTimeout(workerSetTimeoutIds.pop());for(;workerSetIntervalIds.length;)clearInterval(workerSetIntervalIds.pop())},registerWorkerWatchdog=function(){workerWatchdogId&&workerWatchdogId!==!0?removeWatchdogHandler():workerWatchdogId=!1,workerWatchdogId=workerTimeout?setTimeout(function(){workerWatchdogId=!1,workerOnLoadHandler=suspendAjaxRequestsCallback=!1,me.modules.api.result("Timeout happened, worker step cancelled")},workerTimeout):!0},removeWatchdogHandler=function(){workerWatchdogId&&(workerWatchdogId!==!0&&clearTimeout(workerWatchdogId),workerWatchdogId=!1)},getDomain=function(a){return a.split("/").slice(0,3).join("/")},openRelay=function(a,b,c){""!==a&&(relay.knownDomains[getDomain(a)]=!0),relay.nextRelay&&b?relay.nextRelayRegistered?postMessage(relay.nextRelay,b.cmd,b):relay.nextRelayQueue.push(b):""!==a&&(relay.nextRelayDomain=getDomain(a),me.modules.dispatcher.openPopup({url:a,target:"_blank"},function(a){relay.nextRelay=a,c&&setTimeout(function(){relay.nextRelay.blur(),window.focus()},0),b&&relay.nextRelayQueue.push(b),me.localInjectJs&&(relay.igniteFromLocal=!0,setTimeout(function d(){relay.igniteFromLocal&&(relay.nextRelay.postMessage(me.localInjectJs,"*"),setTimeout(d,500))},500))}))},workersToEvaluate=[],sharedWorkerFunctions={},currentEvaluatedWorker,workerTaskSources={},evaluateNextWorker=function(){if(!workersToEvaluate.length)return void me.modules.dispatcher.postMessageToWorker("globalsUpdate",{globals:workerGlobals});currentEvaluatedWorker=workersToEvaluate.shift();var apiIsThere=!1,injectDebuggerFn=function(a,b){return!apiIsThere&&/\,\s*api\s*\,/.test(a)&&(apiIsThere=!0),apiIsThere?b+" if(api.debug && api.debug.stop) debugger; ":a};eval(workerSourceCodes[currentEvaluatedWorker].replace(/(function\s*\([^)]*\)\s*{[ \t]*)/g,injectDebuggerFn)),evaluateNextWorker()},recursivelyCollectSteps=function(a,b){"undefined"==typeof b&&(b=[]);for(var c=0;c<a.length;c++)a[c]===me.modules.api||(a[c]instanceof Array&&(0===a[c].length||a[c].length>0&&("string"==typeof a[c][0]||a[c][0]instanceof Array||"function"==typeof a[c][0]&&a[c][0].cartFillerLibPromiseFunction))?recursivelyCollectSteps(a[c],b):b.push(a[c]));return b},resolveLibPromisesInWorker=function(){var a=!1;for(var b in worker)for(var c=worker[b].length-1;c>=0;c--)if("function"==typeof worker[b][c])if(worker[b][c].cartFillerLibPromiseFunction===!0){a=!0;var d=recursivelyCollectSteps(worker[b][c]());d.unshift(1),d.unshift(c),worker[b].splice.apply(worker[b],d)}else"helper"===worker[b][c].cartFillerWorkerLibType&&worker[b].splice(c,1);a&&resolveLibPromisesInWorker()},evaluateWorkers=function(){reinitializeWorker(),workersToEvaluate=[],sharedWorkerFunctions={};for(var a in workerSourceCodes)workersToEvaluate.push(a);resetWorkerLib(),currentCf=me.modules.cf.create(),evaluateNextWorker(),processWorkerTasks(currentCf.buildTasks()),currentCf.switchMode(),postProcessWorkerLibs(),resolveLibPromisesInWorker();var b={},c={},d={},e={};for(var f in worker){d[f]={},e[f]={};var g=[],h={},i={};for(a=0;a<worker[f].length;a++)"string"==typeof worker[f][a]&&(g.push(worker[f][a]),worker[f][a+1]instanceof Function&&(h[g.length-1]=discoverTaskParameters(worker[f][a+1],i),d[f][g.length-1]=discoverStepDependencies(worker[f][a+1]),e[f][g.length-1]=worker[f][a+1].cartFillerMakePauseBeforeStep));h.all=i,b[f]=g,c[f]=h}me.modules.dispatcher.postMessageToWorker("workerRegistered",{jobTaskDescriptions:b,discoveredParameters:c,workerTaskSources:workerTaskSources,stepDependencies:d,workerLib:workerLibBrief,pausesBeforeSteps:e})},discoverStepDependencies=function(a){var b=a.toString().split("(")[1].split(")")[0].split(",")[0].trim();if(b.length){for(var c in magicParamPatterns)if(magicParamPatterns[c].test(b))return!1;return!0}return!1},discoverTaskParameters=function(a,b){var c={};return[/[^a-zA-Z0-9_$]task\.([a-zA-Z0-9_$]+)[^a-zA-Z0-9_$]/g,/[^a-zA-Z0-9_$]task\[['"]([^'"]+)['"]\]/g].filter(function(d){var e=new RegExp(d.source),f=a.toString(),g=f.match(d);g&&g.filter(function(a){var d=e.exec(a);d&&(c[d[1]]=b[d[1]]=!0)});var h=a.cartFillerParameterList;if("undefined"!=typeof h)if(h instanceof Array)h.filter(function(a){c[a]=b[a]=!0});else for(var i in h)c[i]=b[i]=!0}),c},startupWatchDog={fn:function(){var a=[];if(this.workerRegistered||a.push("worker"),a.length){var b="one or more frames were not registered: "+a.join(", ");window.cartFillerEventHandler&&window.cartFillerEventHandler({message:b,filename:"dispatcher.js",lineno:0}),alert(b)}},workerRegistered:!1,chooseJobRegistered:!1,mainRegistered:!1};this.cartFillerConfiguration.scripts.push({running:!1,getName:function(){return"dispatcher"},init:function(a){a||setTimeout(function(){startupWatchDog.fn()},1e4);var b=this;initialized||(initialized=!0,window.addEventListener("message",function(a){var c="cartFillerMessage:";if(c===a.data.substr(0,c.length)){var d=JSON.parse(a.data.substr(c.length));if(me.log(a.origin,d.cmd,d),"actAsSlaveHelper"===d.cmd){var e;try{e=a.source.frames["cartFillerMainFrame-s"+d.slaveIndex],e.location.hasOwnProperty("href")&&e.eval(me.injectFunction.toString())}catch(f){}return}if(a.source===relay.nextRelay&&"register"!==d.cmd&&"bubbleRelayMessage"!==d.cmd&&"locate"!==d.cmd)"workerStepResult"===d.cmd&&(me.log("going to fillWorkerGlobals due to workerStepResult message",d),fillWorkerGlobals(d.globals)),"currentUrl"===d.cmd&&(knownCurrentUrls[d.currentMainFrameWindow]=d.url),postMessage(relay.isSlave?relay.parent:me.modules.ui.workerFrameWindow,d.cmd,d);else{var g="onMessage_"+d.cmd;undefined!==b[g]&&b[g]instanceof Function?b[g](d,a.source):console.log("unknown message: "+g+":"+a.data)}}else if(0===a.data.indexOf("cartFillerFilePopupUrl")||0===a.data.indexOf("cartFillerFilePopupPing"))relay.parent.postMessage(a.data,"*");else if("/^'cartFillerEval'/"===a.data)a.source.postMessage(me.localInjectJs,"*");else if(0===a.data.indexOf("'cartFillerEval';"));else{var h=function(a,b,c){if(c>20)return{};"undefined"==typeof c&&(c=0),"undefined"==typeof b&&(b=[]);var d,e=function(a){return a===d},f={};for(var g in a){d=a[g];try{if(!(d instanceof Window||d instanceof Function||"[object Window]"===d.toString())){var i=null;try{"object"==typeof d&&d.constructor&&(i=d.constructor.name)}catch(d){}"Window"!==i&&(b.filter(e).length||(b.push(d),f[g]="object"==typeof a[g]?h(d,b,c+1):a[g]))}}catch(d){}}return f};me.modules.dispatcher.onMessage_postMessage({cmd:"postMessage",event:h(a),originalEvent:a})}return!1},!1))},onMessage_register:function(a,b){var c;if(a.registerFromSlave){if(!relay.isSlave&&me.modules.ui.slaveFramesHelperWindows)for(c in me.modules.ui.slaveFramesHelperWindows)if(me.modules.ui.slaveFramesHelperWindows[c].w===b)return void b.postMessage('cartFillerMessage:{"cmd":"actAsSlaveHelper","slaveIndex":'+me.modules.ui.slaveFramesHelperWindows[c].i+"}","*");relay.nextRelay=b,relay.registeredDomains[relay.nextRelayDomain]=!0,this.onMessage_bubbleRelayMessage({message:"updateKnownAndRegisteredSlaves",knownDomains:relay.knownDomains,registeredDomains:relay.registeredDomains,newRelayDomain:relay.nextRelayDomain})}if(b===me.modules.ui.workerFrameWindow)workerFrameLoaded=!0,startupWatchDog.workerRegistered=!0,mainFrameLoaded&&!bootstrapped&&this.bootstrapCartFiller();else if(b===me.modules.ui.chooseJobFrameWindow)startupWatchDog.chooseJobRegistered=!0,this.postMessageToChooseJob("bootstrap",{lib:getLibUrl(),testSuite:!0,src:me.localIndexHtml?"":me.baseUrl.replace(/\/$/,"")+"/",hashUrl:me["data-choose-job"].split("#")[1]||window.location.hash,urlOnBoot:me.modules.ui.mainFrameWindow.location.href},"cartFillerMessage");else if(b===me.modules.ui.mainFrameWindow)startupWatchDog.mainRegistered=!0,postMessage(b,"bootstrap",{dummy:!0});else if(b===relay.nextRelay){relay.igniteFromLocal=!1,relay.nextRelayRegistered=!0;var d,e=[];for(d in workerSourceCodes)workerSourceCodes.hasOwnProperty(d)&&e.push(d);for(c=e.length-1;c>=0;c--)relay.nextRelayQueue.unshift({cmd:"loadWorker",jobDetailsCache:jobDetailsCache,src:e[c],code:workerSourceCodes[e[c]],isFinal:c===e.length-1});for(var f;relay.nextRelayQueue.length;)f=relay.nextRelayQueue.shift(),postMessage(relay.nextRelay,f.cmd,f)}},onMessage_makeSmaller:function(){me.modules.ui.setSize("small")},onMessage_makeBigger:function(){me.modules.ui.setSize("big")},onMessage_toggleSize:function(a){me.modules.ui.setSize(a.size)},onMessage_reinitialize:function(){relay.isSlave?alert("This slave is already initialized"):this.onMessage_chooseJob({hideHashDetails:1})},onMessage_chooseJob:function(a){relay.isSlave?(a.notToChildren=!0,this.onMessage_bubbleRelayMessage(a)):(me.modules.ui.showHideChooseJobFrame(!0),this.postMessageToWorker("chooseJobShown"),a.hideHashDetails&&(hideHashParam={job:1,task:1,step:1}),this.onMessage_updateHashUrl({params:{}}))},onMessage_chooseJobCancel:function(){relay.isSlave?(details.notToChildren=!0,this.onMessage_bubbleRelayMessage(details)):(me.modules.ui.showHideChooseJobFrame(!1),this.postMessageToWorker("chooseJobHidden"),hideHashParam={},this.onMessage_updateHashUrl({params:{}}))},onMessage_jobDetails:function(a){var b=function(a){if(!(a instanceof Array)){var b=[];for(c=0;"undefined"!=typeof a[c];c++)b.push(a[c]);a=b}return a};if(undefined!==a.details){workerSourceCodes={},resultMessageName=a.resultMessage?a.resultMessage:!1,statusMessageName=a.statusMessage?a.statusMessage:!1,me.modules.ui.showHideChooseJobFrame(!1),hideHashParam={},a.overrideWorkerSrc=me["data-worker"],workerTimeout=a.timeout,workerCurrentTask={},resetWorker();var c;for(c in jobDetailsCache)jobDetailsCache.hasOwnProperty(c)&&delete jobDetailsCache[c];for(c in a)jobDetailsCache[c]=a[c];reinitializeWorker(),workerGlobals=a.globals=a.globals?a.globals:{},me.log("setting workerGlobals to",workerGlobals),a.details=b(a.details),workerEventListeners={}}else{if(undefined===a.$cartFillerTestUpdate){if(undefined!==a.$preventPageReload)return void me.modules.ui.preventPageReload();throw new Error("unknown job details package - should have either details or $cartFillerTestUpdate")}a.$cartFillerTestUpdate.details=b(a.$cartFillerTestUpdate.details)}this.postMessageToWorker("jobDetails",a)},onMessage_sendResult:function(a){me.modules.ui.showHideChooseJobFrame(!0),resultMessageName&&this.postMessageToChooseJob(resultMessageName,a)},onMessage_sendStatus:function(a){relay.isSlave?(a.message="sendStatus",a.notToChildren=!0,a.cmd="bubbleRelayMessage",this.onMessage_bubbleRelayMessage(a)):statusMessageName&&this.postMessageToChooseJob(statusMessageName,a)},onMessage_loadWorker:function(a){try{a.jobDetailsCache&&(jobDetailsCache=a.jobDetailsCache),workerSourceCodes[a.src]=a.code,a.isFinal&&(evaluateWorkers(),relay.isSlave&&this.onMessage_bubbleRelayMessage({message:"slaveReady",notToChildren:!0})),relay.nextRelay&&(a.jobDetailsCache=jobDetailsCache,postMessage(relay.nextRelay,a.cmd,a))}catch(b){throw alert(b),console.log(b),b}},onMessage_updateProperty:function(a){if(parseInt(a.index)===parseInt(workerCurrentTaskIndex)){var b=a.value;b instanceof Array&&(b=workerGlobals[decodeAlias(b)]),workerCurrentTask[a.name]=b}},onMessage_invokeWorker:function(a){me.modules.api.resetDrillDepth(),0===a.index&&0===a.step&&me.modules.ui.currentMainFrameWindow>0&&this.switchToWindow(0),relay.isSlave||(a.currentMainFrameWindow=me.modules.ui.currentMainFrameWindow,0===a.step&&(relay.recoveryPoints[me.modules.ui.currentMainFrameWindow]||(relay.recoveryPoints[me.modules.ui.currentMainFrameWindow]={}),relay.recoveryPoints[me.modules.ui.currentMainFrameWindow][a.index]=knownCurrentUrls[me.modules.ui.currentMainFrameWindow]));var b;if(currentInvokeWorkerMessage=a,a.globals&&(me.log("going to fillWorkerGlobals due to invokeWorker message"),fillWorkerGlobals(a.globals)),this.running=a.running,relay.isSlave||a.drillToFrame&&a.drillToFrame.length||me.modules.ui.prepareTolearOverlaysAndReflect(),this.reflectMessage(a,a.drillToFrame))return me.log("invokeWorker reflected"),a.debug&&console.log("Debugger call went to slave tab - look for it there!"),void(relay.nextRelay||(a.failures=(a.failures||0)+1,me.log(a),me.modules.dispatcher.onMessage_bubbleRelayMessage({message:"retryInvokeWorker",payload:a})));if(me.log("invokeWorker will be processed here"),!1!==workerCurrentStepIndex)b="ERROR: worker task is in still in progress",alert(b);else{stepRepeatCounter=a.stepRepeatCounter,shadowedOnLoadHappened=onLoadHappened,onLoadHappened=!1,nextTaskFlow="normal",workerCurrentTaskIndex!==a.index&&fillWorkerCurrentTask(a.details),workerCurrentTaskIndex=a.index,workerCurrentStepIndex=a.step,this.setReturnedValueOfStep(mostRecentReturnedValueOfStep),currentStepEnv={taskIndex:a.index,taskName:a.task,taskSteps:worker[a.task],stepIndex:a.step,task:a.details,repeatCounter:a.repeatCounter,params:{},stepRepeatCounter:stepRepeatCounter};try{if(undefined===worker[a.task])return void me.modules.api.repeatTask().setTimeout(me.modules.api.result,1e3);if(undefined===worker[a.task][2*a.step+1])return alert(b="invalid worker - function for "+a.task+" step "+a.step+" does not exist"),void me.modules.api.result(b,!1);var c=worker[a.task][2*a.step+1];if("function"!=typeof c){if("function"!=typeof c[0])return alert(b="invalid worker - function for "+a.task+" step "+a.step+" is not a function"),void me.modules.api.result(b,!1);currentStepEnv.params=c[1],c=c[0]}if(registerWorkerWatchdog(),sleepAfterThisStep=undefined,currentStepWorkerFn=c,me.modules.api.debug=a.debug,a.debug){me.modules.api.debug={};try{
Object.defineProperty(me.modules.api.debug,"stop",{get:function(){return me.modules.api.debug=!1,"debugging stopped"}})}catch(d){me.modules.api.debug.stop="can't attach getter"}console.log("to stop debugging of this step type api.debug = 0; in console, or hover over any api.debug.stop property")}me.modules.api.env=currentStepEnv,captureWorkerFnResult=c.cartFillerCaptureResult,c.apply(me.modules.ui.getMainFrameWindowDocument(),getWorkerFnParams())}catch(b){throw this.reportErrorResult(b),b}}},reportErrorResult:function(a){if(console.log(a),workerWatchdogId){var b=String(a);b||(b="unknown exception"),me.modules.api.result(b,!1)}},onMessage_focusMainFrameWindow:function(){me.modules.ui.focusMainFrameWindow()},onMessage_resetWorker:function(a){relay.nextRelay&&openRelay("",a),resetWorker()},onMessage_closePopup:function(){me.modules.ui.closePopup()},onMessage_helloFromPlugin:function(a){this.postMessageToChooseJob(a.message,{useTopWindowForLocalFileOperations:useTopWindowForLocalFileOperations})},onMessage_refreshPage:function(a){this.reflectMessage(a)||me.modules.ui.refreshPage()},onMessage_startReportingMousePointer:function(a){me.modules.ui.startReportingMousePointer(a)},onMessage_evaluateCssSelector:function(details){if(!me.modules.dispatcher.reflectMessage(details)){var arrow=[],elements;try{elements=eval("(function(window, document, api, cf, task){return "+("uselib("===details.selector.substr(0,7)?"cf.":"api.find")+details.selector+";})(me.modules.ui.mainFrameWindow, me.modules.ui.mainFrameWindow.document, me.modules.api, me.modules.cf, "+JSON.stringify(details.taskDetails)+");")}catch(e){elements=[]}for(var i=0;i<elements.length&&16>i;i++)arrow.push(elements[i]);(details.initial||arrow.length!==evaluatedCssSelectorElements.length||arrow.filter(function(a){return-1===evaluatedCssSelectorElements.indexOf(a)}).length)&&(evaluatedCssSelectorElements=arrow,me.modules.ui.clearOverlays(),me.modules.ui.arrowTo(arrow,!0,!0)),this.postMessageToWorker("cssSelectorEvaluateResult",{count:elements.length})}},onMessage_bubbleRelayMessage:function(a,b){if(a.cmd="bubbleRelayMessage",relay.isSlave&&b!==relay.parent&&!a.notToParents&&postMessage(relay.parent,a.cmd,a),relay.nextRelay&&b!==relay.nextRelay&&!a.notToChildren&&(relay.nextRelayRegistered?postMessage(relay.nextRelay,a.cmd,a):relay.nextRelayQueue.push(a)),"onMainFrameLoaded"===a.message)me.modules.dispatcher.onMainFrameLoaded(a.args[0],!0);else if("openRelayOnHead"!==a.message||relay.isSlave)if("openRelayOnTail"===a.message)relay.knownDomains[getDomain(a.args[0])]=!0,relay.nextRelay||openRelay(a.args[0],undefined,a.args[1]);else if("updateTitle"===a.message)me.modules.dispatcher.onMessage_updateTitle(a);else if("drill"!==a.message||relay.isSlave)if("drawOverlays"===a.message)me.modules.ui.drawOverlays(a);else if("clearOverlays"===a.message)me.modules.ui.clearOverlays();else if("drawOverlays"===a.message)me.modules.ui.drawOverlays();else if("tellWhatYouHaveToDraw"===a.message)me.modules.ui.tellWhatYouHaveToDraw();else if("sendStatus"===a.message&&b&&!relay.isSlave)me.modules.dispatcher.onMessage_sendStatus(a);else if("clearCurrentUrl"===a.message&&b)me.modules.dispatcher.onMessage_clearCurrentUrl();else if("prepareToClearOverlays"===a.message)me.modules.ui.prepareToClearOverlays();else if("setAdditionalWindows"!==a.message||relay.isSlave)if("switchToWindow"!==a.message||relay.isSlave)if("slaveReady"!==a.message||relay.isSlave)if("chooseJob"!==a.message||relay.isSlave)if("chooseJobCancel"!==a.message||relay.isSlave)if("updateSlaveCounter"===a.message)relay.slaveCounter=a.slaveCounter;else if("broadcastReturnedValues"===a.message&&b)a.returnedValuesOfStepsAreForTask!==returnedValuesOfStepsAreForTask&&(returnedValuesOfSteps=[undefined],returnedValuesOfStepsAreForTask=a.returnedValuesOfStepsAreForTask),a.values.filter(function(a,b){undefined!==a&&null!==a&&(returnedValuesOfSteps[b]=a)});else if("reportingMousePointerClickForWindow"===a.message&&b)a.currentMainFrameWindow===relay.currentMainFrameWindow&&me.modules.ui.reportingMousePointerClickForWindow(a.x,a.y);else if("retryInvokeWorker"!==a.message||relay.isSlave)if("popupRelayMainWindowRequest"===a.message&&b){if(me.modules.ui.mainFrameWindow)try{postMessageFromWindowToWindow("popupRelayMainWindowResponse",{},me.modules.ui.mainFrameWindow,b)}catch(c){}}else"updateKnownAndRegisteredSlaves"===a.message&&(relay.knownDomains=a.knownDomains,relay.registeredDomains=a.registeredDomains,!relay.isSlave&&relay.noFocusForDomain[a.newRelayDomain]&&alert("Thank you!"));else if(me.log("retryInvokeWorker",a),a.payload.failures<15)setTimeout(function(){me.modules.dispatcher.onMessage_invokeWorker(a.payload)},1e3);else{var d=relay.recoveryPoints[me.modules.ui.currentMainFrameWindow][a.payload.index]||"about:blank";d&&(me.modules.ui.mainFrames[me.modules.ui.currentMainFrameWindow].setAttribute("src",d),setTimeout(function(){workerCurrentTaskIndex=a.payload.index,workerCurrentStepIndex=a.payload.step,me.modules.api.repeatTask().result("recovering after access deined into: "+d,1),workerCurrentTaskIndex=!1},2e4))}else me.modules.dispatcher.onMessage_chooseJobCancel(a);else me.modules.dispatcher.onMessage_chooseJob(a);else relay.slaveCounter++,me.modules.dispatcher.onMessage_bubbleRelayMessage({message:"updateSlaveCounter",slaveCounter:relay.slaveCounter});else me.modules.dispatcher.switchToWindow(a.index);else me.modules.dispatcher.setAdditionalWindows(a.descriptors,a);else a.cmd="invokeWorker",me.modules.dispatcher.onMessage_invokeWorker(a);else relay.noFocusForDomain[getDomain(a.args[0])]=a.args[1],relay.knownDomains[getDomain(a.args[0])]||me.modules.dispatcher.onMessage_bubbleRelayMessage({message:"openRelayOnTail",args:a.args})},onMessage_reportingMousePointerClick:function(a){me.modules.dispatcher.reflectMessage(a)||me.modules.ui.reportingMousePointerClick(a.x,a.y,a.w,a.fl,a.ft)},onMessage_postMessage:function(a){if(/^cartFillerFilePopup/.test(a.event.data))me.modules.ui.chooseJobFrameWindow.postMessage(a.event.data,"*");else if(!me.modules.dispatcher.reflectMessage(a)){var b;b=new me.modules.ui.mainFrameWindow.CustomEvent("message",a.event);for(var c in a.event)try{b[c]=a.event[c]}catch(d){}me.modules.ui.mainFrameWindow.dispatchEvent(b)}},onMessage_locate:function(){alert("Here I am!")},onMessage_updateHashUrl:function(a){if(mainWindowOwnedByTestSuite){var b,c=a.params;for(b in c)rememberedHashParams[b]=c[b];for(b in rememberedHashParams)undefined===c[b]&&(c[b]=rememberedHashParams[b]);var d=window.location.hash.replace(/^#\/?/,"").split("&").map(function(a){var b,d;for(d in hideHashParam)if(b=encodeURIComponent(d),0===a.indexOf(b+"="))return"";for(d in c)if(b=encodeURIComponent(d),0===a.indexOf(b+"=")){var e=hideHashParam[d]||""!==c[d]&&c[d]!==!1?b+"="+encodeURIComponent(c[d]):"";return delete c[d],e}return a}).filter(function(a){return a.length});for(b in c)hideHashParam[b]||""===c[b]||c[b]===!1||d.push(encodeURIComponent(b)+"="+encodeURIComponent(c[b]));var e=d.join("&");e.length<4096&&(window.history&&window.history.replaceState?window.history.replaceState(undefined,undefined,"#"+e):window.location.hash=e)}},onMessage_updateTitle:function(a){window.document.title=me.modules.ui.rootWindowTitle()||a.title},onMessage_requestWorkers:function(a){this.postMessageToChooseJob("cartFillerRequestWorkers",a)},onMessage_launchFromSlave:function(){useTopWindowForLocalFileOperations=!0,me.launch(!0)},onMessage_highlightElementForQueryBuilder:function(a){me.modules.dispatcher.reflectMessage(a)||me.modules.ui.highlightElementForQueryBuilder(a)},onMessage_updateGlobal:function(a){this.reflectMessage(a),workerGlobals[a.name]=a.value,fillWorkerCurrentTask(currentStepEnv.task)},onMessage_toggleEditorMode:function(a){this.onMessage_sendStatus({toggleEditorMode:!0,enable:a.enable}),a.cb&&(suspendAjaxRequestsCallback=a.cb),a.enable&&this.postMessageToWorker("toggleEditorModeResponse",{enabled:!0})},onMessage_suspendAjaxRequestsDone:function(a){this.reflectMessage(a)||(this.postMessageToWorker("toggleEditorModeResponse"),suspendAjaxRequestsCallback&&suspendAjaxRequestsCallback())},onMainFrameLoaded:function(a,b){if(mainFrameLoaded=!0,workerFrameLoaded&&!bootstrapped?this.bootstrapCartFiller():b||relay.bubbleMessage({message:"onMainFrameLoaded",args:[a]}),workerOnLoadHandler){try{callEventCallbacks("onload"),workerOnLoadHandler(a)}catch(c){this.reportErrorResult(c)}workerOnLoadHandler=!1,onLoadHappened=!1}else onLoadHappened=!0},setMainFrameLoaded:function(){mainFrameLoaded=!0},postMessageToWorker:function(a,b){postMessage(me.modules.ui.workerFrameWindow,a,b)},postMessageToChooseJob:function(a,b,c){postMessage(me.modules.ui.chooseJobFrameWindow,a,b,c?c:a)},bootstrapCartFiller:function(){bootstrapped=!0,this.postMessageToWorker("bootstrap",{lib:getLibUrl(),debug:me["data-debug"]})},registerWorker:function(a){var b=makeLibPathFromWorkerPath(currentEvaluatedWorker),c=workerLibFactory(b);workerLibByWorkerPath[b.join(".")]=c;var d=a.toString().split("(")[1].split(")")[0].split(",").map(function(a){return a.trim()}),e={window:me.modules.ui.mainFrameWindow,document:undefined,api:me.modules.api,task:workerCurrentTask,job:jobDetailsCache,globals:workerGlobals,lib:-1===d.indexOf("cf")?c:currentCf.getLib(),cf:currentCf.getCf(),oldlib:c},f=d.map(function(a){return e.hasOwnProperty(a)?e[a]:function(){for(;!sharedWorkerFunctions[a]&&workersToEvaluate.length;)evaluateNextWorker();if(!sharedWorkerFunctions[a]){var b="bad worker - shared function was not defined: ["+a+"]";throw alert(b),new Error(b)}return sharedWorkerFunctions[a].apply(worker,arguments)}}),g=a.apply(undefined,f);processWorkerLibByPath(c,b),processWorkerTasks(g)},manageTaskFlow:function(a){nextTaskFlow=a},submitWorkerResult:function(a,b,c){if(suspendAjaxRequestsCallback&&(suspendAjaxRequestsCallback=!1,this.onMessage_toggleEditorMode({enable:!0})),workerCurrentStepIndex===!1)return void alert("You have invalid worker, result is submitted twice, please fix");for(var d in currentStepEnv.task)if(currentStepEnv.task[d]instanceof Array){for(var e=currentStepEnv.task[d][0];e[0]instanceof Array;e=e[0]);var f=decodeAlias(currentStepEnv.task[d],!0);undefined!==f&&(workerGlobals[f]=workerCurrentTask[d])}var g,h;if((1===captureWorkerFnResult||captureWorkerFnResult>1&&a)&&(this.setReturnedValueOfStep([""===a?undefined:a,mostRecentReturnedValueOfStep,mostRecentReturnedValueOfStepIsElement]),nextTaskFlow=captureWorkerFnResult>1?"skipStep,"+(captureWorkerFnResult-1):"normal",a=undefined),undefined===a||""===a)g="ok";else{if("string"!=typeof a)throw new Error("invalid message type "+typeof a);g=b?"skip":"error"}if(clearRegisteredTimeoutsAndIntervals(),this.onMessage_bubbleRelayMessage({message:"tellWhatYouHaveToDraw"}),"ok"!==g){if(stepRepeatCounter++,h=magicParamPatterns.repeat.exec(currentStepWorkerFn.toString().split(")")[0]),h&&parseInt(h[1])>stepRepeatCounter)return void me.modules.api.setTimeout(function(){me.modules.api.repeatStep().result()},1e3)}else"undefined"==typeof sleepAfterThisStep&&(h=magicParamPatterns.sleep.exec(currentStepWorkerFn.toString().split(")")[0]),h&&(sleepAfterThisStep=parseInt(h[1])));removeWatchdogHandler();var i={index:workerCurrentTaskIndex,step:workerCurrentStepIndex,status:g,message:a,response:c,nop:"nop"===b,nextTaskFlow:nextTaskFlow,globals:workerGlobals,sleep:sleepAfterThisStep};workerCurrentStepIndex=!1,currentInvokeWorkerMessage&&currentInvokeWorkerMessage.details&&"_wait"===currentInvokeWorkerMessage.details.task&&(workerCurrentTaskIndex=!1),workerOnLoadHandler=!1,suspendAjaxRequestsCallback=!1,this.postMessageToWorker("workerStepResult",i)},registerWorkerOnloadCallback:function(a,b){if(onLoadHappened||b&&shadowedOnLoadHappened){try{callEventCallbacks("onload"),a(!0)}catch(c){this.reportErrorResult(c)}workerOnLoadHandler=!1}else workerOnLoadHandler=a},getWorkerCurrentStepIndex:function(){return workerCurrentStepIndex},setReturnedValueOfStep:function(a,b){returnedValuesOfSteps[workerCurrentStepIndex+1]=mostRecentReturnedValueOfStep=a,mostRecentReturnedValueOfStepIsElement=b,this.onMessage_bubbleRelayMessage({message:"broadcastReturnedValues",values:returnedValuesOfSteps.map(function(a){return"string"==typeof a||"number"==typeof a?a:undefined}),returnedValuesOfStepsAreForTask:returnedValuesOfStepsAreForTask})},registerWorkerSetTimeout:function(a){workerSetTimeoutIds.push(a)},registerWorkerSetInterval:function(a){workerSetIntervalIds.push(a)},updateCurrentUrl:function(a){workerCurrentUrl!==a&&(this.postMessageToWorker("currentUrl",{url:a,currentMainFrameWindow:relay.isSlave?me.modules.dispatcher.getFrameWindowIndex():me.modules.ui.currentMainFrameWindow}),this.onMessage_bubbleRelayMessage({message:"clearCurrentUrl"}),workerCurrentUrl=knownCurrentUrls[me.modules.ui.currentMainFrameWindow]=a)},onMessage_clearCurrentUrl:function(){workerCurrentUrl=!1},haveAccess:function(a){var b=me.modules.ui.mainFrameWindow;if((a||[]).filter(function(a){b=b&&b.frames[a]}),!b)return!1;var c,d=function(){};try{c=b.document,d(c.getElementsByTagName("body")[0])}catch(e){return!1}return!0},reflectMessage:function(a,b){var c=this.haveAccess(b);if(c&&(!a.hasOwnProperty("currentMainFrameWindow")||relay.currentMainFrameWindow===a.currentMainFrameWindow))return me.log("dispatcher.reflectMessage - false",c,b),!1;if(me.log("dispatcher.reflectMessage - true",c,b),"invokeWorker"===a.cmd){a.globals={};for(var d in workerGlobals)a.globals[d]=workerGlobals[d]}return openRelay("",a),!0},startSlaveMode:function(a){for(var b=document.getElementsByTagName("body")[0];b.children.length;)b.removeChild(b.children[0]);var c,d,e=document.createElement("a");try{e.textContent="This tab/iframe is used by cartFiller as slave ("+window.location.href.split("/")[2]+"), DO NOT CLOSE IT!, click this message to locate original tab.",e.style.color="red",e.style.display="block",e.style.padding="0px",e.setAttribute("href","#"),e.onclick=function(){relay.parent.postMessage('cartFillerMessage:{"cmd":"locate"}',"*")}}catch(f){}b.appendChild(e);try{e.focus()}catch(f){}if(reinitializeWorker(),a)relay.parent=a;else if(window.opener)relay.parent=window.opener;else if(window.parent){relay.parent=window.parent;try{for(c=1;d=window.parent.frames["cartFillerMainFrame-s"+c];c++)if(d===window){relay.currentMainFrameWindow=c,me.modules.ui.mainFrameWindow=window.parent.frames["cartFillerMainFrame-"+c],c>1&&(relay.parent=window.parent.frames["cartFillerMainFrame-s"+(c-1)]);break}}catch(f){}}me.modules.dispatcher.init(!0),relay.parent.postMessage('cartFillerMessage:{"cmd":"register","registerFromSlave":1}',"*"),me.modules.ui.chooseJobFrameWindow=me.modules.ui.workerFrameWindow=relay.parent;try{if(relay.parent===window.opener)for(var g=window.opener;g&&g!==g.opener;g=g.opener){try{if(g.frames["cartFillerMainFrame-0"]){me.modules.ui.mainFrameWindow=g.frames["cartFillerMainFrame-0"];break}}catch(f){}try{g.frames.cartFillerWorkerFrame&&postMessage(relay.parent,"bubbleRelayMessage",{message:"popupRelayMainWindowRequest"})}catch(f){}}}catch(f){return}return me.modules.ui.mainFrameWindow?void this.startSlaveModeWithWindow():void setTimeout(function(){me.uiLaunched||me.modules.ui.mainFrameWindow||alert("could not find mainFrameWindow in slave mode")},1e4)},startSlaveModeWithWindow:function(){relay.isSlave||(me.modules.dispatcher.registerLoadWatcher(),relay.isSlave=!0,setInterval(function(){var a=!1;try{me.modules.ui.mainFrameWindow&&me.modules.ui.mainFrameWindow.location&&(a=me.modules.ui.mainFrameWindow.location.href)}catch(b){}a&&me.modules.dispatcher.updateCurrentUrl(a)},100))},onMessage_popupRelayMainWindowResponse:function(a,b){me.modules.ui.mainFrameWindow=b,this.startSlaveModeWithWindow()},registerLoadWatcher:function(){setTimeout(function a(){var b;try{me.modules.ui.mainFrameWindow.document&&"complete"===me.modules.ui.mainFrameWindow.document.readyState&&!me.modules.ui.mainFrameWindow.document.getElementsByTagName("html")[0].getAttribute("data-cartfiller-reload-tracker")&&(me.modules.ui.mainFrameWindow.document.getElementsByTagName("html")[0].setAttribute("data-cartfiller-reload-tracker",0),me.modules.ui.checkAndUpdateCurrentUrl(),me.modules.dispatcher.onMainFrameLoaded(!0)),b="undefined"==typeof me.modules.ui.mainFrameWindow.document.title?"":me.modules.ui.mainFrameWindow.document.title}catch(c){}oldTitle!==b&&(oldTitle=b,"undefined"!=typeof b&&(me.modules.dispatcher.onMessage_updateTitle({title:b}),relay.bubbleMessage({message:"updateTitle",title:b}))),setTimeout(a,100)},100)},openRelayOnTheTail:function(a,b){me.modules.dispatcher.onMessage_bubbleRelayMessage({message:"openRelayOnHead",args:[a,b],notToChildren:!0})},registerEventCallback:function(a,b,c){undefined===workerEventListeners[a]&&(workerEventListeners[a]={}),workerEventListeners[a][b]=c},getWorkerTask:function(){return workerCurrentTask},getWorkerGlobals:function(){return workerGlobals},getWorker:function(){return worker},defineSharedWorkerFunction:function(a,b){sharedWorkerFunctions[a]=b},setSleepAfterThisStep:function(a){sleepAfterThisStep=a},drill:function(a){me.log("dispatcher.drill",a),workerCurrentStepIndex=workerOnLoadHandler=suspendAjaxRequestsCallback=!1,currentInvokeWorkerMessage.drillToFrame=this.getFrameToDrill(),currentInvokeWorkerMessage.drillToFrame.push(a),currentInvokeWorkerMessage.message="drill",currentInvokeWorkerMessage.notToChildren=!0,currentInvokeWorkerMessage.notToParents=!1,this.onMessage_bubbleRelayMessage(currentInvokeWorkerMessage)},isDrilling:function(){return"undefined"!=typeof currentInvokeWorkerMessage.drillToFrame},getFrameToDrill:function(){return currentInvokeWorkerMessage&&currentInvokeWorkerMessage.drillToFrame?currentInvokeWorkerMessage.drillToFrame:[]},isSlave:function(){return relay.isSlave},onMessage_closeRelay:function(){relay.nextRelay&&relay.nextRelayRegistered&&openRelay("",{cmd:"closeRelay"}),relay.isSlave&&window.close()},resetRelays:function(){this.onMessage_closeRelay(),relay.nextRelay=relay.nextRelayRegistered=!1,relay.nextRelayQueue=[],relay.knownDomains={},relay.registeredDomains={},relay.slaveCounter=0,relay.recoveryPoints={},knownCurrentUrls={},me.modules.ui.slaveFrames=[undefined],me.modules.ui.slaveFramesWindows=[undefined],me.modules.ui.slaveFramesHelperWindows={}},getSlaveCounter:function(){return relay.slaveCounter},onMessage_resetAdditionalWindows:function(){me.modules.ui.switchToWindow(0),me.modules.ui.setAdditionalWindows([],!0)},setAdditionalWindows:function(a,b){if(relay.currentMainFrameWindow>0)throw new Error("setAdditionalWindows is only allowed when worker is switched to primary window (0)");relay.isSlave?this.onMessage_bubbleRelayMessage({message:"setAdditionalWindows",descriptors:a,notToChildren:!0,workerCurrentStepIndex:workerCurrentStepIndex,workerCurrentTaskIndex:workerCurrentTaskIndex,nextTaskFlow:nextTaskFlow,sleepAfterThisStep:sleepAfterThisStep,workerGlobals:workerGlobals}):(me.modules.ui.setAdditionalWindows(a),b&&(workerCurrentTaskIndex=b.workerCurrentTaskIndex,workerCurrentStepIndex=b.workerCurrentStepIndex,nextTaskFlow=b.nextTaskFlow,sleepAfterThisStep=b.sleepAfterThisStep,me.log("setting workerGlobals to: ",workerGlobals),workerGlobals=b.workerGlobals))},switchToWindow:function(a){relay.isSlave?this.onMessage_bubbleRelayMessage({message:"switchToWindow",index:a,notToChildren:!0}):(me.modules.ui.switchToWindow(a),this.postMessageToWorker("switchToWindow",{currentMainFrameWindow:a}))},getFrameWindowIndex:function(){return relay.currentMainFrameWindow},discoverTaskParameters:function(a,b){return discoverTaskParameters(a,b)},injectTaskParameters:function(a,b){var c={};(b instanceof Array?b:[b]).filter(function(a){"function"==typeof a?me.modules.dispatcher.discoverTaskParameters(a,c):"string"==typeof a&&me.modules.dispatcher.interpolateText(a,c)}),a.cartFillerParameterList=a.cartFillerParameterList||[];for(var d in c)a.cartFillerParameterList.push(d);return a},recursivelyCollectSteps:function(a,b){return recursivelyCollectSteps(a,b)},isRelayRegistered:function(a){return relay.registeredDomains[getDomain(a)]},openPopup:function(a,b,c){c=c||0;var d=a.target?window.open(a.url,a.target):window.open(a.url);return d?b(d):(c%20===0&&alert("looks like popups are blocked, please unblock popups and I'll retry in 15 seconds"),void setTimeout(function(){me.modules.dispatcher.openPopup(a,b,c+1)},1e3))},interpolateText:function(a,b){"string"!=typeof a&&(a=undefined===a||null===a?"":String(a));var c=a,d=function(a,c,d){b&&(b[d]=!0);var e=workerCurrentTask[d];return undefined===e&&(e=workerGlobals[d]),c+(undefined===e||null===e?"":String(e))};do a=c,c=a.replace(INTERPOLATE_PATTERN,d);while(c!==a);return a.replace(/\\\$/g,"$")}})}.call(this,document,window),function(a,b){"use strict";var c=["dispatcher","ui","api","cf"],d=this,e=function(){for(var a=c.length-1;a>=0;a--){for(var e=!1,f=d.cartFillerConfiguration.scripts.length-1;f>=0;f--)if(d.cartFillerConfiguration.scripts[f].getName()===c[a]){e=!0;break}if(!e)return}b.cartFillerAPI=function(){return d.cartFillerConfiguration.modules.api},d.cartFillerConfiguration.modules={};for(var g=d.cartFillerConfiguration.scripts.length-1;g>=0;g--){var h=d.cartFillerConfiguration.scripts[g];d.cartFillerConfiguration.modules[h.getName()]=h}for(var i in d.cartFillerConfiguration.modules)d.cartFillerConfiguration.modules[i].onLoaded&&d.cartFillerConfiguration.modules[i].onLoaded();d.cartFillerConfiguration.launch()};if(this.cartFillerConfiguration.scripts.push=function(a){Array.prototype.push.call(this,a),e()},!this.cartFillerConfiguration.concatenated)for(var f=a.getElementsByTagName("head")[0],g=c.length-1;g>=0;g--){var h=a.createElement("script");h.setAttribute("src",this.cartFillerConfiguration.baseUrl+"/boot/helpers/"+c[g]+".js"),f.appendChild(h)}}.call(this,document,window),function(a,b,c){"use strict";var d,e=this.cartFillerConfiguration,f="cartFillerOverlayDiv",g="cartFillerMainFrame",h="cartFillerWorkerFrame",i="cartFillerChooseJobFrame",j=!1,k=[],l={},m={},n="",o={},p="",q=!1,r="",s=0,t=!1,u=0,v="framed",w="big",x=!1,y=!1,z=!1,A=function(){return e.modules.ui.mainFrameWindow},B=function(){return"rgba(255,0,0,0.3)"},C=function(a){var b=A().document.createElement("div");b.style.position="fixed",b.style.backgroundColor=B(),b.style.zIndex=ca(),b.className=f+" "+f+a,b.onclick=function(){e.modules.ui.clearOverlaysAndReflect()},b.addEventListener("mousemove",function(){b.style.display="none",setTimeout(function(){b.style.display="block"},100)});var c=A().document.getElementsByTagName("body")[0];if(c){var d=c.getElementsByClassName("cartFillerOverlayDivmessage");d.length?c.insertBefore(b,d[0]):c.appendChild(b)}return b},D=function(a){for(var b=A().document.getElementsByClassName(f+(a?a:"")),c=b.length-1;c>=0;c--)b[c].parentNode.removeChild(b[c]);for(b=A().document.getElementsByClassName(f+" "+f+(a?a:"")),c=b.length-1;c>=0;c--)b[c].parentNode.removeChild(b[c])},E=function(a,b,c,d,e){e=String(e||20)+"px";var f=C(a);f.style.left=b+"px",f.style.top=c+"px",f.style.width=e,f.style.height=d+"px"},F=function(a,b,c,d,e){e=String(e||20)+"px";var f=C(a);f.style.left=b+"px",f.style.top=c+"px",f.style.width=d+"px",f.style.height=e},G=function(a,b,c){var d=C(a);d.style.left=b+"px",d.style.top=c-25+"px",d.style.width=d.style.height="0px",d.style.backgroundColor="transparent",d.style.borderTop=d.style.borderBottom="25px solid transparent",d.style.borderLeft="30px solid rgba(255,0,0,0.3)"},H=function(a,b,c){var d=C(a);d.style.left=b-25+"px",d.style.top=c+"px",d.style.width=d.style.height="0px",d.style.backgroundColor="transparent",d.style.borderLeft=d.style.borderRight="25px solid transparent",d.style.borderTop="30px solid rgba(255,0,0,0.3)"},I=function(a,b,c){var d=C(a);d.style.left=b-25+"px",d.style.top=c+"px",d.style.width=d.style.height="0px",d.style.backgroundColor="transparent",d.style.borderLeft=d.style.borderRight="25px solid transparent",d.style.borderBottom="30px solid rgba(255,0,0,0.3)"},J=function(a){var b,c,d,f,g,h,i,j={};if(!(a instanceof Array)){var k=[];for(b in a)k.push(a[b]);a=k}for(b=a.length-1;b>=0;b--)if(h=a[b],h&&h.element){i=h.element.getBoundingClientRect();var l=0,m=0;if("iframe"===h.type)try{var n=h.element.ownerDocument.defaultView.getComputedStyle(h.element);m=parseInt(n.borderTopWidth.replace(/[^0-9]/g,"")),l=parseInt(n.borderLeftWidth.replace(/[^0-9]/g,""))}catch(o){}i.width>0||i.height>0||i.left>0||i.top>0?(c=Math.round(i.top-5),d=Math.round(i.left-5),g=Math.round(i.height+9),f=Math.round(i.width+9),(c!==h.top||d!==h.left||g!==h.height||f!==h.width)&&(e.log(h),j.any=!0,h.type&&(j[h.type]=!0),e.log(j),h.top=c,h.left=d,h.height=g,h.width=f,h.right=d+f,h.bottom=c+g,h.self={top:i.top+m,left:i.left+l,right:i.right+l,bottom:i.bottom+m,width:i.width,height:i.height})):(e.log(h),j.any=!0,h.type&&(j[h.type]=!0),e.log(j),h.deleted=!0,h.element=null)}return j},K=function(a){if(e.log(a),!a.path||!a.path.length)return a;for(var b={left:a.rect.left,top:a.rect.top,width:a.rect.width,height:a.rect.height,originalElement:a},c=a.path.length-1;c>=0;c--){var d=a.path.slice(0,c+1).join("/"),f=m[d];f&&(b.left+=f.rect.left,b.top+=f.rect.top)}return e.log(b),{rect:b}},L=function(a){b.callPhantom({scroll:a}),e.modules.dispatcher.postMessageToWorker("phantomScroll",{scroll:a})},M=0,N=function(){var a,c,d=function(b){b.scroll&&b.ts>M&&(b.ts>c||!c)&&(a=b,c=b.ts)},g=function(a){return a.currentMainFrameWindow===e.modules.dispatcher.getFrameWindowIndex()};for(var h in l)l[h].filter(g).filter(d);if(!a&&b.callPhantom&&r){var i=A().document.getElementsByClassName(f+"message");i.length&&L({rect:i[0].getBoundingClientRect()})}if(a){if(M=c,b.callPhantom&&b.callPhantom instanceof Function){var j=K(a);L(j)}else{for(var k=.25,m=[a.rect.left-U()*k,a.rect.top-T()*k],n=0;2>n;n++)m[n]<0||(m[n]=Math.min(m[n],Math.max(0,a.rect[n?"bottom":"right"]-(n?T():U())*(1-k))));e.modules.ui.mainFrameWindow.addEventListener("scroll",Y),e.modules.ui.mainFrameWindow.scrollBy(m[0],m[1])}return!0}},O=!1,P=function(){Q(!0)},Q=function(a){var b=0;a?O=!1:O&&(clearTimeout(O),O=!1);var c;if(!a)for(c in l)if(b+=l[c].length,b>1)return void(O=setTimeout(P,200));e.log(),N(),D("arrow");for(c in l)R(l[c])},R=function(a){e.log(a);var b,c,d;a.filter(function(a){return"arrow"===a.type&&!a.deleted}).filter(function(a){return a.currentMainFrameWindow===e.modules.dispatcher.getFrameWindowIndex()}).map(K).filter(function(a,e){if(!(e>50)){var f=5;F("arrow",a.rect.left-f,a.rect.top-f,a.rect.width+2*f,f),F("arrow",a.rect.left-f,a.rect.bottom,a.rect.width+2*f,f),E("arrow",a.rect.left-f,a.rect.top,a.rect.height,f),E("arrow",a.rect.right,a.rect.top,a.rect.height,f),a.rect.left>40?(b=a.rect.top+Math.round(a.rect.height/2),E("arrow",0,0,b-10),F("arrow",0,b-10,a.rect.left-30),G("arrow",a.rect.left-30,b)):a.rect.top>40?(c=a.rect.left+Math.min(30+30*e,Math.round(a.rect.width/2)),F("arrow",0,0,c-10),E("arrow",c-10,0,a.rect.top-30),H("arrow",c,a.rect.top-30)):(c=a.rect.left+Math.min(30,Math.round(a.rect.width/2)),d=a.rect.top+a.rect.height,F("arrow",0,d+60,c+10),E("arrow",c-10,d+30,30),I("arrow",c,d))}})},S=function(a){var b,d,f,g,h=function(b){return("undefined"==typeof a||a[b.type])&&!b.deleted},i=function(a){b=c===b?a.rect.left:Math.min(b,a.rect.left),f=c===f?a.rect.left+a.rect.width:Math.max(f,a.rect.left+a.rect.width),d=c===d?a.rect.top:Math.min(d,a.rect.top),g=c===g?a.rect.top+a.rect.height:Math.max(g,a.rect.top+a.rect.height)},j=function(a){return a.currentMainFrameWindow===e.modules.dispatcher.getFrameWindowIndex()};for(var k in l)l[k].filter(h).filter(j).map(K).filter(i);return{left:b,right:f,top:d,bottom:g}},T=function(){try{if(parent.callPhantom)return 600}catch(a){}return e.modules.ui.mainFrameWindow.innerHeight},U=function(){return e.modules.ui.mainFrameWindow.innerWidth},V=function(){N(),D("highlight");var a=S({highlight:!0});if(a.left!==c){var b=T(),d=U(),e=5;aa(0,0,Math.max(0,a.left-e),b),aa(Math.min(d,a.right+e),0,d,b),aa(Math.max(0,a.left-e),0,Math.min(d,a.right+e),Math.min(b,a.top-e)),aa(Math.max(0,a.left-e),Math.max(0,a.bottom+e),Math.min(d,a.right+e),b)}},W=function(a){return a.split("/").slice(0,3).join("/")},X=function(){D("message");var a=S({highlight:!0,arrow:!0});if(a.left===c&&(a={top:0,bottom:0,left:0,right:0}),"string"==typeof n&&n.length>0||"string"!=typeof n&&c!==n&&null!==n&&!isNaN(n)){var b=A().document.createElement("div");b.style.display="block",b.style.backgroundColor="#fff",b.style.padding="10px",b.style.fontSize="20px;",b.style.zIndex=ca(),b.style.border="#bbb solid 10px",b.style.borderRadius="20px",b.style.overflow="auto",b.style.opacity="0",b.style.top=Math.min(T()-100,a.bottom+5-u)+"px",b.style.left=Math.max(0,Math.round((a.left+a.right)/2)-t)+"px",b.style.width=t+"px",b.style.height="auto",b.style.maxHeight="100%",b.style.position="fixed",b.style.fontSize="20px",b.style.lineHeight="1.4",b.className=f+" "+f+"message";var d=A().document.createElement(q?"pre":"div");b.appendChild(d),o.html?d.innerHTML=n:q?(d.style.fontSize="14px",d.textContent=n,d.style.whiteSpace="pre",b.style.left="3px",b.style.width=U()-60+"px"):n.split("\n").filter(function(a,b){if(b){var c=A().document.createElement("br");d.appendChild(c)}var e=A().document.createElement("span");e.textContent=a,d.appendChild(e)}),d.style.backgroundColor="#fff",d.style.border="none",d.onclick=function(a){return a.stopPropagation(),!1};var g=A().document.createElement("button");b.appendChild(g),g.textContent=o.nextButton||"Close (spacebar)",g.style.borderRadius="4px",g.style.fontSize="14px",g.style["float"]="right",g.style.borderColor="#bbb",g.style.padding="2px 6px",g.style.borderWidth="2px",g.style.backgroundColor="#fff",g.style.borderStyle="outset",o.nextButton&&(e.modules.dispatcher.running===!0?setTimeout(function(){e.modules.ui.clearOverlaysAndReflect()},0):g.onclick=function(a){return a.stopPropagation(),e.modules.ui.clearOverlaysAndReflect(),e.modules.dispatcher.postMessageToWorker("messageCloseClicked",{}),!1}),b.onclick=function(){e.modules.ui.clearOverlaysAndReflect(),e.modules.dispatcher.postMessageToWorker("messageCloseClicked",{})},A().document.getElementsByTagName("body")[0].appendChild(b),g.focus(),s=100,e.modules.ui.adjustMessageDiv(b),o.callback&&o.callback.apply(_(),[b])}r=n},Y=function(){var a=function(a){var b=function(a){var b="iframe"===a.type?a.self:a;return{rect:{left:b.left,top:b.top,width:b.width,height:b.height,right:b.right,bottom:b.bottom,url:a.element?a.element.ownerDocument.defaultView.location.href:!1},type:a.type,path:a.path,scroll:a.scroll,ts:a.ts,deleted:a.deleted,currentMainFrameWindow:a.currentMainFrameWindow}},c={};return k.filter(function(b){return a[b.type]}).filter(function(a){return c[a.path.join("/")]=[],!0}).map(b).filter(function(a){a.discard||c[a.path.join("/")].push(a)}),c};try{var b=J(k),c=r!==n;if(b.arrow||b.highlight||c||b.iframe){var d={elementsByPath:a({arrow:b.arrow,highlight:b.highlight}),rebuild:b,iframesByPath:{}};c&&(d.messageToSay=n,d.rebuild.message=!0),b.iframe&&(d.iframesByPath=a({iframe:!0})),e.modules.ui.drawOverlaysAndReflect(d)}}catch(f){}},Z={width:!1,height:!1,outerWidth:!1,outerHeight:!1,workerFrameSize:!1},$=function(a){var c=b.innerWidth,f=b.innerHeight,g="framed"===v?!1:b.outerWidth,h="framed"===v?!1:b.outerHeight;e.modules.ui.checkAndUpdateCurrentUrl(),(Z.width!==c||Z.height!==f||Z.outerWidth!==g||Z.outerHeight!==h||Z.workerFrameSize!==w||"framed"===v&&e.modules.ui.currentMainFrameWindow!==e.modules.ui.drawnMainFrameWindow||a)&&(!function(){var a=.8*c-1,i=.2*c-1,j=.8*c-1,k=.2*c-1,l=20,m=Math.floor((f-15-("framed"===v?(e.modules.ui.mainFrames.length-1)*l:0))/("framed"===v?e.modules.ui.mainFrames.length:1)),n=f-15,o="clean"===v?.02*d.width:.02*c+("framed"===v?0:200),p="clean"===v?.76*d.width:.76*c-("framed"===v?0:200),q=.02*("clean"===v?0:f),r=.96*("clean"===v?d.height-50:f),s=[];if("framed"===v&&e.modules.ui.mainFrames.filter(function(a,b){s[b]=Math.floor(m*(1===e.modules.ui.mainFrames.length?1:b===e.modules.ui.currentMainFrameWindow?.3+.7*e.modules.ui.mainFrames.length:.3)),a.style.height=s[b]+"px",b>0&&e.modules.ui.slaveFrames[b]&&(e.modules.ui.slaveFrames[b].style.height=l+"px")}),
"clean"!==v)try{e.modules.ui.workerFrame.style.height=n+"px"}catch(t){}try{e.modules.ui.chooseJobFrame.style.height=r+"px",e.modules.ui.chooseJobFrame.style.top=q+"px",e.modules.ui.chooseJobFrame.style.left=o+"px",e.modules.ui.chooseJobFrame.style.width=p+"px"}catch(t){}if("framed"===v&&e.modules.ui.mainFrames.filter(function(a,b){try{var c=s.slice(0,b).reduce(function(a,b){return a+b+l},0);a.style.top=c+"px",b>0&&e.modules.ui.slaveFrames[b]&&(e.modules.ui.slaveFrames[b].style.top=c-l+"px")}catch(d){}}),"big"===w){if("framed"===v){try{e.modules.ui.workerFrame.style.width=j+"px",e.modules.ui.workerFrame.style.left=i+"px"}catch(t){}e.modules.ui.mainFrames.filter(function(a,b){try{a.style.width=i+"px",b>0&&e.modules.ui.slaveFrames[b]&&(e.modules.ui.slaveFrames[b].style.width=i+"px")}catch(c){}})}else if("popup"===v){try{e.modules.ui.mainFrameWindow.resizeTo(1,1)}catch(t){}try{e.modules.ui.workerFrame.style.width=j+"px",e.modules.ui.workerFrame.style.left=c-j-5+"px"}catch(t){}}else if("clean"===v)try{b.resizeTo(d.width,d.height),b.moveTo(0,0)}catch(t){}}else if("small"===w)if("framed"===v){try{e.modules.ui.workerFrame.style.width=k+"px",e.modules.ui.workerFrame.style.left=a+"px"}catch(t){}e.modules.ui.mainFrames.filter(function(b,c){try{b.style.width=a+"px",c>0&&e.modules.ui.slaveFrames[c]&&(e.modules.ui.slaveFrames[c].style.width=a+"px")}catch(d){}})}else if("popup"===v){try{e.modules.ui.mainFrameWindow.resizeTo(Math.round(.8*g-10),Math.round(h))}catch(t){}try{e.modules.ui.workerFrame.style.width=k+"px",e.modules.ui.workerFrame.style.left=c-k-5+"px"}catch(t){}}else try{b.resizeTo(Math.floor(.2*d.width),d.height),b.moveTo(Math.floor(.8*d.width),0)}catch(t){}}(),Z.width=c,Z.height=f,Z.outerWidth=g,Z.outerHeight=h,Z.workerFrameSize=w,e.modules.ui.drawnMainFrameWindow=e.modules.ui.currentMainFrameWindow)},_=function(){return e.modules.ui.mainFrameWindow.document},aa=function(a,b,c,d){a=Math.round(a),b=Math.round(b),c=Math.round(c),d=Math.round(d);var g=_().createElement("div");g.style.position="fixed",g.style.left=a+"px",g.style.top=b+"px",g.style.width=c-a+"px",g.style.height=d-b+"px",g.style.backgroundColor="rgba(0,0,0,0.3)",g.style.zIndex=ca(),g.className=f+" "+f+"highlight",g.onclick=function(){e.modules.ui.clearOverlaysAndReflect()};var h=_().getElementsByClassName("cartFillerOverlayDivmessage");h.length?_().getElementsByTagName("body")[0].insertBefore(g,h[0]):_().getElementsByTagName("body")[0].appendChild(g)},ba=function(){return e["data-wfu"]?e["data-wfu"]:e.baseUrl+"/index"+(e.concatenated?"":/\/src$/.test(e.baseUrl)?"":".uncompressed")+".html"+(e.gruntBuildTimeStamp?"?"+e.gruntBuildTimeStamp:"")},ca=function(){return 2147483647};setInterval(Y,200);var da=function(a,b){if(b=b||[],a===e.modules.ui.mainFrameWindow)return b;for(var c=a.parent,d=0;d<c.frames.length&&a!==c.frames[d];d++);b.unshift(d),da(c,b);try{c.location.href;var f=c.document.getElementsByTagName("iframe");for(d=f.length-1;d>=0;d--)f[d].contentWindow===a&&e.modules.ui.addElementToTrack("iframe",f[d],!0,[d])}catch(g){}return b},ea=function(a){if(a=a||0,e.modules.ui.currentMainFrameWindow=a,e.modules.ui.mainFrameWindow=e.modules.ui.mainFrameWindows[0],"framed"===v)if(e.modules.ui.mainFrames&&e.modules.ui.mainFrames.length>1)for(var b=e.modules.ui.mainFrames.length-1;b>=0;b--){var c=e.modules.ui.mainFrames[b];c.style.borderWidth="5px",c.style.borderColor=b===a?"red":"transparent"}else e.modules.ui.mainFrames[0].style.borderWidth="0px"};e.scripts.push({getName:function(){return"ui"},setSize:function(){},showHideChooseJobFrame:function(a){a&&!j&&(0===e["data-choose-job"].indexOf("#")&&e.localIndexHtml?this.chooseJobFrameWindow.document.write(e.localIndexHtml.replace(/data-local-href=""/,'data-local-href="'+e["data-choose-job"]+'"')):this.chooseJobFrameWindow.location.href=e["data-choose-job"],j=!0),this.chooseJobFrame.style.display=a?"block":"none","clean"===v&&this.setSize(a?"big":"small")},closePopup:function(){},focusMainFrameWindow:function(){},highlight:function(a,b){y&&this.clearOverlaysAndReflect(!0),n="";var d,f=!1;if(null!==a&&"object"==typeof a&&("string"==typeof a.jquery&&c!==a.length&&"function"==typeof a.each||a instanceof e.modules.api.getSelectorClass()))a.each(function(a,c){return e.modules.ui.addElementToTrack("highlight",c),f=!0,b?void 0:!1});else if(a instanceof Array)for(d=a.length-1;d>=0&&(this.addElementToTrack("highlight",a[d]),f=!0,!0===b);d--);else c!==a&&(this.addElementToTrack("highlight",a),f=!0);if(f>0&&e.modules.dispatcher.haveAccess()){var g=this.mainFrameWindow.document.getElementsByTagName("body")[0];g.style.paddingBottom=T()+"px"}},arrowTo:function(a,b,d){if(y&&this.clearOverlaysAndReflect(!0),null!==a&&"object"==typeof a&&("string"==typeof a.jquery&&c!==a.length&&"function"==typeof a.each||a instanceof e.modules.api.getSelectorClass()))a.each(function(a,c){return e.modules.ui.addElementToTrack("arrow",c,d),b?void(d=!0):!1});else if(a instanceof Array)for(var f=0;f<a.length&&(this.addElementToTrack("arrow",a[f],d),b);f++)d=!0;else c!==a&&this.addElementToTrack("arrow",a,d)},say:function(a,b,d,e,f){n=c===a||null===a?"":a,o.nextButton=d,o.html=e,o.callback=f,q=b,t=Math.max(100,Math.round(.5*U())),u=0,s=100},adjustMessageDiv:function(a){var b=this;z&&clearTimeout(z),z=setTimeout(function c(){var d=!0;if(s>0){if(!a.parentNode)return void setTimeout(c,100);d=!1;var e=a.getBoundingClientRect();e.bottom>b.mainFrameWindow.innerHeight||e.width-20<a.scrollWidth?e.width>.95*b.mainFrameWindow.innerWidth&&e.bottom>b.mainFrameWindow.innerHeight?u+=Math.min(e.top,e.bottom-b.mainFrameWindow.innerHeight):t=Math.min(b.mainFrameWindow.innerWidth-60,parseInt(a.style.width.replace("px",""))+Math.round(.4*b.mainFrameWindow.innerWidth)):d=!0,d?(a.style.opacity="1",s=0,z=!1):(s--,z=setTimeout(c,10))}else s=0,a.style.opacity="1",z=!1;N()},0),r=n},popup:function(a,b){e.modules.dispatcher.init(),v="popup",this.mainFrameWindows=[b.open(b.location.href,"_blank","resizable=1, height=1, width=1, scrollbars=1")],ea(),this.mainFrameWindow=this.mainFrameWindows[0],this.closePopup=function(){this.mainFrameWindow.close()},this.focusMainFrameWindow=function(){this.mainFrameWindow.focus()},e.modules.dispatcher.registerLoadWatcher();for(var d=b.document.getElementsByTagName("body")[0];d.children.length;)d.removeChild(d.children[0]);this.setSize=function(a){c===a&&(a="big"===w?"small":"big"),w=a,$(),"small"===a&&this.mainFrameWindow.focus()},this.workerFrame=b.document.createElement("iframe"),this.workerFrame.setAttribute("name",h),this.workerFrame.style.position="fixed",this.workerFrame.style.top="0px",this.workerFrame.style.height="100%",this.workerFrame.style.zIndex=2147483647,d.appendChild(this.workerFrame),this.workerFrameWindow=b.frames[h],e.localIndexHtml?this.workerFrameWindow.document.write(e.localIndexHtml):this.workerFrameWindow.location.href=ba(),this.chooseJobFrame=b.document.createElement("iframe"),this.chooseJobFrame.setAttribute("name",i),this.chooseJobFrame.style.position="fixed",this.chooseJobFrame.style.height="0px",this.chooseJobFrame.style.top="0px",this.chooseJobFrame.style.left="0px",this.chooseJobFrame.style.width="0px",this.chooseJobFrame.style.zIndex=2147483647,this.chooseJobFrame.style.background="white",d.appendChild(this.chooseJobFrame),this.chooseJobFrameWindow=b.frames[i],this.setSize("big"),setInterval($,2e3)},framed:function(a,b){v="framed",e.modules.dispatcher.init();for(var d=a.getElementsByTagName("body")[0],f=b.location.href;d.children.length;)d.removeChild(d.children[0]);this.mainFrames=[a.createElement("iframe")],this.mainFrames[0].setAttribute("name",g+"-0"),this.mainFrames[0].style.height="0px",this.mainFrames[0].style.position="fixed",this.mainFrames[0].style.left="0px",this.mainFrames[0].style.top="0px",this.mainFrames[0].style.borderWidth="0px",this.slaveFrames=[c],this.slaveFramesWindows=[c],this.slaveFramesHelperWindows={},this.workerFrame=a.createElement("iframe"),this.workerFrame.setAttribute("name",h),this.workerFrame.style.height="0px",this.workerFrame.style.position="fixed",this.workerFrame.style.top="0px",this.chooseJobFrame=a.createElement("iframe"),this.chooseJobFrame.setAttribute("name",i),this.chooseJobFrame.style.display="none",this.chooseJobFrame.style.height="0px",this.chooseJobFrame.style.top="0px",this.chooseJobFrame.style.left="0px",this.chooseJobFrame.style.width="0px",this.chooseJobFrame.style.position="fixed",this.chooseJobFrame.style.background="white",this.chooseJobFrame.style.zIndex=2147483647,d.appendChild(this.mainFrames[0]),this.mainFrameWindows=[b.frames[g+"-0"]],ea(),e.modules.dispatcher.registerLoadWatcher(),this.mainFrameWindow.location.href=f,d.appendChild(this.workerFrame),this.workerFrameWindow=b.frames[h],e.localIndexHtml?this.workerFrameWindow.document.write(e.localIndexHtml):this.workerFrameWindow.location.href=ba(),d.appendChild(this.chooseJobFrame),this.chooseJobFrameWindow=b.frames[i],this.setSize=function(a){c===a&&(a="big"===w?"small":"big"),w=a,$()},this.setSize("small"),setInterval($,2e3)},clean:function(a,b){v="clean",b.document.title=this.rootWindowTitle(),d={width:b.opener&&(b.opener.screen&&b.opener.screen.availWidth||b.opener.screen.width||b.opener.outerWidth||b.opener.innerWidth),height:b.opener&&(b.opener.screen&&b.opener.screen.availHeight||b.opener.screen.height||b.opener.outerHeight||b.opener.innerHeight)},e.modules.dispatcher.setMainFrameLoaded(),e.modules.dispatcher.init(),this.mainFrameWindows=[b.opener],ea(),this.mainFrameWindow=this.mainFrameWindows[0],this.closePopup=function(){},this.focusMainFrameWindow=function(){},e.modules.dispatcher.registerLoadWatcher();var f=b.document.getElementsByTagName("body")[0];this.setSize=function(a){c===a&&(a="big"===w?"small":"big"),w=a,$(),"small"===a&&this.mainFrameWindow.focus()},this.workerFrame=b.document.createElement("iframe"),this.workerFrame.setAttribute("name",h),this.workerFrame.style.position="fixed",this.workerFrame.style.top="0px",this.workerFrame.style.left="0px",this.workerFrame.style.height="100%",this.workerFrame.style.width="100%",f.appendChild(this.workerFrame),this.workerFrameWindow=b.frames[h],e.localIndexHtml?this.workerFrameWindow.document.write(e.localIndexHtml):this.workerFrameWindow.location.href=ba(),this.chooseJobFrame=b.document.createElement("iframe"),this.chooseJobFrame.setAttribute("name",i),this.chooseJobFrame.style.position="fixed",this.chooseJobFrame.style.height="0px",this.chooseJobFrame.style.top="0px",this.chooseJobFrame.style.left="0px",this.chooseJobFrame.style.width="0px",this.chooseJobFrame.style.zIndex=2147483647,this.chooseJobFrame.style.background="white",f.appendChild(this.chooseJobFrame),this.chooseJobFrameWindow=b.frames[i],this.setSize("big"),setInterval($,2e3)},refreshPage:function(){this.mainFrameWindow.location.reload()},reportingMousePointerClick:function(a,d,f,g,h){if(f===c){var i=b.document.elementFromPoint(a,d);if(i){var j=/^cartFillerMainFrame-(\d+)$/.exec(i.getAttribute("name"));j&&(f=parseInt(j[1]))}}return f!==c?void(f!==e.modules.dispatcher.getFrameWindowIndex()?e.modules.dispatcher.onMessage_bubbleRelayMessage({message:"reportingMousePointerClickForWindow",currentMainFrameWindow:f,x:a-g,y:d-h}):this.reportingMousePointerClickForWindow(a,d)):void e.modules.dispatcher.postMessageToWorker("mousePointer",{x:a,y:d,stack:[],w:e.modules.dispatcher.getFrameWindowIndex()})},reportingMousePointerClickForWindow:function(a,b){var c=e.modules.ui.mainFrameWindow.document.elementFromPoint(a,b);e.modules.ui.reportingMousePointerClickForElement(c)},reportingMousePointerClickForElement:function(b,d){var f=[];e.modules.ui.clearOverlaysAndReflect(),e.modules.ui.arrowTo(b,!0,!0);var g,h,i,j,k;if("SELECT"===b.nodeName){var l=b.childNodes;for(i=l.length-1;i>=0;i--)if("OPTION"===l[i].nodeName&&l[i].selected){b=l[i];break}}for(var m=e.modules.cf.getLibSelectors(),n={};b&&"BODY"!==b.nodeName&&"HTML"!==b.nodeName&&b!==a;){for(i in m)for(k=0;k<m[i].length;k++)if(m[i][k]===b){n[i]=m[i],delete m[i];break}var o=[];for(i=b.attributes.length-1;i>=0;i--)k=b.attributes[i].name,"id"!==k&&"class"!==k&&o.push({n:k,v:b.attributes[i].value});for(g=b,i=0;g;g=g.previousElementSibling)g.nodeName===b.nodeName&&i++;for(h=b,j=0;h;h=h.nextElementSibling)h.nodeName===b.nodeName&&j++;f.unshift({element:b.nodeName.toLowerCase(),lib:c,attrs:o,classes:"string"==typeof b.className?b.className.split(" ").filter(function(a){return a}):[],id:"string"==typeof b.id?b.id:c,index:i,indexOf:i+j-1,text:String(b.textContent).length<200?String(b.textContent):""}),b=b.parentNode}for(i in n)f.unshift({element:c,lib:i,attrs:[],classes:[],id:c,index:0,text:""});e.modules.dispatcher.postMessageToWorker("mousePointer",{stack:f,w:e.modules.dispatcher.getFrameWindowIndex(),notFinal:d})},startReportingMousePointerDirect:function(){function a(){if(!d){f&&f!==g&&(e.modules.ui.reportingMousePointerClickForElement(f,!0),g=f);for(var h=b.getElementsByTagName("body")[0].getElementsByTagName("*"),k=0;k<h.length;k++)-1===c.indexOf(h[k])&&(c.push(h[k]),h[k].addEventListener("mousemove",i,!0),h[k].addEventListener("mouseenter",i,!0),h[k].addEventListener("mouseleave",j,!0));setTimeout(a,100)}}var b=_(),c=[],d=!1,f=!1,g=!1,h=function(){d=!0;for(var a=0;a<c.length;a++)c[a].removeEventListener("mousemove",i,!0),c[a].removeEventListener("mouseenter",i,!0),c[a].removeEventListener("mouseleave",j,!0)},i=function(a){d||(a.shiftKey?(e.modules.ui.reportingMousePointerClickForElement(a.target),h()):f=a.target)},j=function(a){!d&&a.shiftKey&&(e.modules.ui.reportingMousePointerClickForElement(a.target),h())};a()},startReportingMousePointer:function(c,d){try{e.modules.ui.clearOverlaysAndReflect()}catch(f){}if(c.direct)return c.delay&&!d?void setTimeout(function(){e.modules.ui.startReportingMousePointerDirect(c),e.modules.dispatcher.postMessageToWorker("mousePointer",{autoshootReady:!0})},5e3):this.startReportingMousePointerDirect(c);if(c.delay&&!d)return void setTimeout(function(){e.modules.ui.startReportingMousePointer(!0,!0),e.modules.dispatcher.postMessageToWorker("mousePointer",{autoshootReady:!0})},5e3);if(!x){var g="framed"===v?a:_(),h=g.createElement("div");h.style.height=b.innerHeight+"px",h.style.width=b.innerWidth+"px",h.zindex=2147483647,h.style.position="absolute",h.style.left="0px",h.style.top="0px",h.style.backgroundColor="transparent",g.getElementsByTagName("body")[0].appendChild(h),x=h;var i,j,k=function(){g.getElementsByTagName("body")[0].removeChild(x)},l=function(){var a=0,b={left:0,top:0};if(x=!1,"framed"===v){var c=g.elementFromPoint(i,j);if(c){var d=/^cartFillerMainFrame-(\d+)$/.exec(c.getAttribute("name"));d&&(a=parseInt(d[1]))}if(b=c.getBoundingClientRect(),e.modules.dispatcher.reflectMessage({cmd:"reportingMousePointerClick",x:i,y:j,w:a,ft:b.top,fl:b.left}))return}e.modules.ui.reportingMousePointerClick(i,j,a,b.left,b.top)};h.addEventListener("mousemove",function(a){i=a.clientX,j=a.clientY,c.delay&&(e.modules.dispatcher.postMessageToWorker("mousePointer",{autoshootCaptured:!0}),k(),setTimeout(function(){l()},5e3))},!1),h.addEventListener("click",function(a){i=i||a.clientX,j=j||a.clientY,k(),l()})}},preventPageReload:function(){"clean"!==v&&setInterval(function(){b.onbeforeunload=function(){return setTimeout(function(){e.modules.ui.mainFrameWindow.location.reload()},0),"This will cause CartFiller to reload. Choose not to reload if you want just to refresh the main frame."}},2e3)},getMessageToSay:function(){return n},highlightElementForQueryBuilder:function(a){if(this.clearOverlays(),a.path){for(var b=a.path,c=this.mainFrameWindow.document.getElementsByTagName("body")[0],d=0;d<b.length;d++){for(var f=b[d][0],g=c.children.length,h=0;g>h;h++)if(c.children[h].nodeName.toLowerCase()===f){if(!b[d][1]){c=c.children[h],f=!1;break}b[d][1]--}if(f)return}this.arrowTo(c,!1,!0)}else a.lib&&this.arrowTo(e.modules.cf.getlib(a.lib),!0,!0)},prepareTolearOverlaysAndReflect:function(){e.log(),e.modules.dispatcher.onMessage_bubbleRelayMessage({message:"prepareToClearOverlays"})},prepareToClearOverlays:function(){e.log(),y=!0,n="",e.modules.dispatcher.haveAccess()&&X()},clearOverlaysAndReflect:function(a){e.log(),!a&&o.nextButton&&(e.modules.api.result(),o.nextButton=!1),e.modules.dispatcher.onMessage_bubbleRelayMessage({message:"clearOverlays"})},clearOverlays:function(){e.log(),y=!1,k=k.filter(function(a){return"iframe"===a.type&&!a.isOld}).map(function(a){return a.isOld=!0,a}),l={},n="",e.modules.dispatcher.haveAccess()&&(Q(),V(),X())},drawOverlays:function(a){e.log(a);var b,c=!1;for(b in a.iframesByPath)m[b]=a.iframesByPath[b][0],c=!0;for(b in a.elementsByPath)l[b]=a.elementsByPath[b];e.modules.dispatcher.haveAccess()&&((a.rebuild.arrow||c)&&Q(),(a.rebuild.highlight||c)&&V(),(a.rebuild.message||c)&&(p=a.messageToSay,X()))},drawOverlaysAndReflect:function(a){e.log(),a.message="drawOverlays",e.modules.dispatcher.onMessage_bubbleRelayMessage(a)},tellWhatYouHaveToDraw:function(){e.log(),Y()},addElementToTrack:function(a,b,c,d){e.log(a,c,d),k.push({element:b,type:a,scroll:!c,path:da(b.ownerDocument.defaultView,d),ts:(new Date).getTime(),currentMainFrameWindow:e.modules.dispatcher.getFrameWindowIndex()}),c||b.scrollIntoView()},getMainFrameWindow:function(){return e.modules.ui.mainFrameWindow},getMainFrameWindowDocument:function(a){a=a||this.getMainFrameWindow();var b;try{b=a.document}catch(c){}return b},setAdditionalWindows:function(c,d){if("framed"===v){for(var f=this.mainFrames.length-1;f>=1;f--)this.mainFrames[f].parentNode.removeChild(this.mainFrames[f]),this.slaveFrames[f]&&this.slaveFrames[f].parentNode.removeChild(this.slaveFrames[f]);this.mainFrames.splice(1),this.slaveFrames.splice(1),this.mainFrameWindows.splice(1),e.modules.dispatcher.resetRelays();var h=a.getElementsByTagName("body")[0],i=-1,j=function(){return e.modules.dispatcher.getSlaveCounter()===i+1},k=function(a){if(a)if(i++,i===c.length)e.modules.api.result();else{e.modules.ui.slaveFramesWindows[i+1]=e.modules.ui.slaveFrames[i+1].contentWindow,e.modules.ui.slaveFramesWindows[i+1].location.href=c[i].slave+"#launchSlaveInFrame";var b=function(){e.modules.api.waitFor(j,k,3e5)};c[i].withHelper?e.modules.ui.slaveFramesHelperWindows[W(c[i].slave)]?(e.modules.ui.slaveFramesHelperWindows[W(c[i].slave)].i=i+1,e.modules.ui.slaveFramesHelperWindows[W(c[i].slave)].w.postMessage('cartFillerMessage:{"cmd":"actAsSlaveHelper","slaveIndex":'+(i+1)+"}","*"),b()):e.modules.dispatcher.openPopup({url:c[i].slave},function(a){e.modules.ui.slaveFramesHelperWindows[W(c[i].slave)]={w:a,i:i+1},b()}):b()}else e.modules.api.result("Unable to load slave")};for(f=1;f<=c.length;f++){var l=a.createElement("iframe");l.setAttribute("name",g+"-"+f),l.style.height="0px",l.style.position="fixed",l.style.left="0px",l.style.top="0px",l.style.borderWidth="0px",this.mainFrames[f]=l,h.appendChild(l),this.mainFrameWindows[f]=b.frames[g+"-"+f],this.mainFrameWindows[f].location.href=c[f-1].url;var m=a.createElement("iframe");m.setAttribute("name",g+"-s"+f),m.style.height="0px",m.style.position="fixed",m.style.left="0px",m.style.top="0px",m.style.borderWidth="1px",m.style.borderColor="#ccc",this.slaveFrames[f]=m,h.appendChild(m)}ea(),$(!0),d||k(!0)}else if(c&&c.length)throw new Error("this function is only availabled in framed mode")},switchToWindow:function(a){ea(a)},checkAndUpdateCurrentUrl:function(){try{if(e.modules.ui.mainFrameWindow&&e.modules.ui.mainFrameWindow.location){var a=!1;try{a=e.modules.ui.mainFrameWindow.location.href}catch(b){}a&&e.modules.dispatcher.updateCurrentUrl(a)}}catch(b){}},isMessageStable:function(){return 0===s},rootWindowTitle:function(){return"clean"===v?"CartFiller Dashboard":c},closeCartFiller:function(){"clean"===v&&b.close()}})}.call(this,document,window)}).call({cartFillerConfiguration:{},cartFillerEval:this.cartFillerEval})}).call(this);