/*
 *  cartFiller - v0.0.1
 *  Tool for automating cart filling process when doing big purchases
 *  https://andrey012.github.com/cartFiller
 *
 *  Made by Andrey Grinenko
 *  Under MIT License
 */
(function(){(function(a,b){"use strict";var c,d="undefined"!=typeof this.cartFillerConfiguration,e="undefined"!=typeof this.cartFillerEval;if(e&&!d?(b.cartFillerConfiguration={},c=b.cartFillerConfiguration):(this.cartFillerConfiguration={},c=this.cartFillerConfiguration),c.concatenated=d,c.scripts=[],c.launch=function(){"0"===String(c["data-type"])?this.modules.ui.framed(a,b):"1"===String(c["data-type"])?this.modules.ui.popup(a,b):alert("Type not specified, should be 0 for framed, 1 for popup")},c.baseUrl="",c["data-type"]=0,c["data-choose-job"]="",c["data-debug"]=!1,c["data-worker"]="",c.gruntBuildTimeStamp="1434100679746",e)c.baseUrl=this.cartFillerEval[0],c["data-type"]=this.cartFillerEval[1],c["data-choose-job"]=this.cartFillerEval[2],c["data-debug"]=this.cartFillerEval[3],c["data-worker"]=this.cartFillerEval[4];else for(var f=a.getElementsByTagName("head")[0].getElementsByTagName("script"),g=f[f.length-1],h=g.attributes,i=h.length-1;i>=0;i--)/^data-/.test(h[i].name)&&("data-base-url"===h[i].name?c.baseUrl=h[i].value:c[h[i].name]=h[i].value);if(!d){var j=a.createElement("script");j.setAttribute("src",c.baseUrl+"/boot/helpers/loader.js"),a.getElementsByTagName("head")[0].appendChild(j)}}).call(this,document,window),function(a,b,c){"use strict";var d=this.cartFillerConfiguration;d.scripts.push({getName:function(){return"api"},registerWorker:function(a){return d.modules.dispatcher.registerWorker(a,this),this},result:function(a,b){return d.modules.dispatcher.submitWorkerResult(a,b),this},nop:function(){return d.modules.dispatcher.submitWorkerResult("","nop"),this},onload:function(a){return d.modules.dispatcher.registerWorkerOnloadCallback(a),this},waitFor:function(a,b,e,f){c===e&&(e=2e4),c===f&&(f=200);var g=Math.round(e/f),h=function(){var c=a();!1!==d.modules.dispatcher.getWorkerCurrentStepIndex()&&(c?b(c):(g--,g>0?setTimeout(h,f):b(!1)))};return setTimeout(h,f),this},highlight:function(a,b){return d.modules.ui.highlight(a,b),d.modules.dispatcher.setHighlightedElement(a),this},arrow:function(a,b){return d.modules.ui.arrowTo(a,b),d.modules.dispatcher.setHighlightedElement(a),this},say:function(a){return d.modules.ui.say(a),this}})}.call(this,document,window),function(document,window,undefined){"use strict";var worker=!1,workerSrcPretendent="",workerCurrentTask={},workerCurrentTaskIndex=!1,workerCurrentStepIndex=!1,workerOnLoadHandler=!1,resultMessageName=!1,mainFrameLoaded=!1,workerFrameLoaded=!1,bootstrapped=!1,highlightedElement=!1,me=this.cartFillerConfiguration,postMessage=function(a,b,c,d){undefined===d&&(d="cartFillerMessage"),undefined===c&&(c={}),c.cmd=b,a.postMessage(d+":"+JSON.stringify(c),"*")},resetWorker=function(){workerCurrentTaskIndex=workerCurrentStepIndex=workerOnLoadHandler=!1},fillWorkerCurrentTask=function(a){for(var b in workerCurrentTask)workerCurrentTask.hasOwnProperty(b)&&delete workerCurrentTask[b];for(var c in a)a.hasOwnProperty(c)&&(workerCurrentTask[c]=a[c])};this.cartFillerConfiguration.scripts.push({getName:function(){return"dispatcher"},init:function(){var a=this;window.addEventListener("message",function(b){var c=/^cartFillerMessage:(.*)$/;if(c.test(b.data)){var d=c.exec(b.data),e=JSON.parse(d[1]),f="onMessage_"+e.cmd;undefined!==a[f]&&a[f]instanceof Function?a[f](e):console.log("unknown message: "+f+":"+b.data)}},!1)},onMessage_register:function(){workerFrameLoaded=!0,mainFrameLoaded&&!bootstrapped&&this.bootstrapCartFiller()},onMessage_makeSmaller:function(){me.modules.ui.setSize("small")},onMessage_makeBigger:function(){me.modules.ui.setSize("big")},onMessage_toggleSize:function(){me.modules.ui.setSize()},onMessage_chooseJob:function(){me.modules.ui.showHideChooseJobFrame(!0)},onMessage_chooseJobCancel:function(){me.modules.ui.showHideChooseJobFrame(!1)},onMessage_jobDetails:function(a){resultMessageName=a.resultMessage?a.resultMessage:!1,me.modules.ui.showHideChooseJobFrame(!1),a.overrideWorkerSrc=me["data-worker"],resetWorker(),this.postMessageToWorker("jobDetails",a)},onMessage_sendResult:function(a){me.modules.ui.showHideChooseJobFrame(!0),resultMessageName&&this.postMessageToChooseJob(resultMessageName,a)},onMessage_loadWorker:function(message){try{workerSrcPretendent=message.src,eval(message.code),resetWorker()}catch(e){throw alert(e),e}},onMessage_invokeWorker:function(a){if(!1!==workerCurrentStepIndex){var b="ERROR: worker task is in still in progress";alert(b),this.postMessage("workerStepResult",{index:a.index,step:a.step,result:b})}else{workerCurrentTaskIndex!==a.index&&fillWorkerCurrentTask(a.details),workerCurrentTaskIndex=a.index,workerCurrentStepIndex=a.step;var c={stepIndex:a.index,task:a.details,params:{}};try{undefined===worker[a.task][2*a.step+1]?alert("invalid worker - function for "+a.task+" step "+a.step+" does not exist"):"function"!=typeof worker[a.task][2*a.step+1]?"function"==typeof worker[a.task][2*a.step+1][0]?(c.params=worker[a.task][2*a.step+1][1],worker[a.task][2*a.step+1][0](highlightedElement,c)):alert("invalid worker - function for "+a.task+" step "+a.step+" is not a function"):worker[a.task][2*a.step+1](highlightedElement,c)}catch(b){throw alert(b),b}}},onMessage_resetWorker:function(){resetWorker()},onMessage_closePopup:function(){me.modules.ui.closePopup()},onMessage_helloFromPlugin:function(a){this.postMessageToChooseJob(a.message,{})},onMainFrameLoaded:function(a){mainFrameLoaded=!0,workerFrameLoaded&&!bootstrapped&&this.bootstrapCartFiller(),workerOnLoadHandler&&(workerOnLoadHandler(a),workerOnLoadHandler=!1)},postMessageToWorker:function(a,b){postMessage(me.modules.ui.workerFrameWindow,a,b)},postMessageToChooseJob:function(a,b){postMessage(me.modules.ui.chooseJobFrameWindow,a,b,a)},bootstrapCartFiller:function(){bootstrapped=!0,this.postMessageToWorker("bootstrap",{lib:me.baseUrl.replace(/(src|dist)\/?$/,"lib/"),debug:me["data-debug"]})},registerWorker:function(a,b){workerCurrentTask={},worker=a(me.modules.ui.mainFrameWindow,undefined,b,workerCurrentTask);var c={};for(var d in worker)if(worker.hasOwnProperty(d)){for(var e=[],f=0;f<worker[d].length;f++)"string"==typeof worker[d][f]&&e.push(worker[d][f]);c[d]=e}this.postMessageToWorker("workerRegistered",{jobTaskDescriptions:c,src:workerSrcPretendent})},submitWorkerResult:function(a,b){var c;if(undefined===a||""===a)c="ok";else{if("string"!=typeof a)throw"invalid message type "+typeof a;c=b?"skip":"error"}this.postMessageToWorker("workerStepResult",{index:workerCurrentTaskIndex,step:workerCurrentStepIndex,status:c,message:a,nop:"nop"===b}),workerCurrentStepIndex=workerOnLoadHandler=!1},registerWorkerOnloadCallback:function(a){workerOnLoadHandler=a},getWorkerCurrentStepIndex:function(){return workerCurrentStepIndex},setHighlightedElement:function(a){highlightedElement=a}})}.call(this,document,window),function(a,b){"use strict";var c=["dispatcher","ui","api"],d=this,e=function(){for(var a=c.length-1;a>=0;a--){for(var e=!1,f=d.cartFillerConfiguration.scripts.length-1;f>=0;f--)if(d.cartFillerConfiguration.scripts[f].getName()===c[a]){e=!0;break}if(!e)return}b.cartFillerAPI=function(){return d.cartFillerConfiguration.modules.api},d.cartFillerConfiguration.modules={};for(var g=d.cartFillerConfiguration.scripts.length-1;g>=0;g--){var h=d.cartFillerConfiguration.scripts[g];d.cartFillerConfiguration.modules[h.getName()]=h}d.cartFillerConfiguration.launch()};if(this.cartFillerConfiguration.scripts.push=function(a){Array.prototype.push.call(this,a),e()},!this.cartFillerConfiguration.concatenated)for(var f=a.getElementsByTagName("head")[0],g=c.length-1;g>=0;g--){var h=a.createElement("script");h.setAttribute("src",this.cartFillerConfiguration.baseUrl+"/boot/helpers/"+c[g]+".js"),f.appendChild(h)}}.call(this,document,window),function(a,b,c){"use strict";var d,e=this.cartFillerConfiguration,f="cartFillerOverlayDiv",g="cartFillerMainFrame",h="cartFillerWorkerFrame",i="cartFillerChooseJobFrame",j=!1,k=[],l=function(){return"rgba(255,0,0,0.3)"},m=function(){var a=t().createElement("div");return a.style.position="fixed",a.style.backgroundColor=l(),a.style.zIndex=D(),a.className=f,a.onclick=function(){y(),k=[]},t().getElementsByTagName("body")[0].appendChild(a),a},n=function(a,b,c){var d=m();d.style.left=a+"px",d.style.top=b+"px",d.style.width="20px",d.style.height=c+"px"},o=function(a,b,c){var d=m();d.style.left=a+"px",d.style.top=b+"px",d.style.width=c+"px",d.style.height="20px"},p=function(a,b){var c=m();c.style.left=a+"px",c.style.top=b-25+"px",c.style.width=c.style.height="0px",c.style.backgroundColor="transparent",c.style.borderTop=c.style.borderBottom="25px solid transparent",c.style.borderLeft="30px solid rgba(255,0,0,0.3)"},q=function(a,b){var c=m();c.style.left=a-25+"px",c.style.top=b+"px",c.style.width=c.style.height="0px",c.style.backgroundColor="transparent",c.style.borderLeft=c.style.borderRight="25px solid transparent",c.style.borderTop="30px solid rgba(255,0,0,0.3)"},r=function(a,b){var c=m();c.style.left=a-25+"px",c.style.top=b+"px",c.style.width=c.style.height="0px",c.style.backgroundColor="transparent",c.style.borderLeft=c.style.borderRight="25px solid transparent",c.style.borderBottom="30px solid rgba(255,0,0,0.3)"},s=function(){try{var a,b,c,d,e=!1;for(a=k.length-1;a>=0;a--){var f=k[a].element.getBoundingClientRect();b=Math.round(f.top-5),c=Math.round(f.left-5),(b!==k[a].top||c!==k[a].left)&&(e=!0,k[a].top=b,k[a].left=c,k[a].height=Math.round(f.height+9),k[a].width=Math.round(f.width+9))}if(e)for(y(),a=k.length-1;a>=0;a--){var g=k[a],h=m();h.style.backgroundColor="transparent",h.style.borderLeft=h.style.borderTop=h.style.borderRight=h.style.borderBottom="5px solid rgba(255,0,0,0.3)",h.style.left=g.left+"px",h.style.top=g.top+"px",h.style.width=g.width+"px",h.style.height=g.height+"px",h.style.boxSizing="border-box",g.left>40?(b=g.top+Math.round(g.height/2),n(0,0,b-10),o(0,b-10,g.left-30),p(g.left-30,b)):g.top>40?(c=g.left+Math.min(30,Math.round(g.width/2)),o(0,0,c-10),n(c-10,0,g.top-30),q(c,g.top-30)):(c=g.left+Math.min(30,Math.round(g.width/2)),d=g.top+g.height,o(0,d+60,c+10),n(c-10,d+30,30),r(c,d))}}catch(i){}},t=function(){return e.modules.ui.mainFrameWindow.document},u=function(){return t().documentElement.scrollLeft||t().body.scrollLeft},v=function(){return t().documentElement.scrollTop||t().body.scrollTop},w=function(a,b,c,d){a=Math.round(a),b=Math.round(b),c=Math.round(c),d=Math.round(d);var e=t().createElement("div");e.style.position="absolute",e.style.left=a+"px",e.style.top=b+"px",e.style.width=c-a+"px",e.style.height=d-b+"px",e.style.backgroundColor="rgba(0,0,0,0.3)",e.style.zIndex=D(),e.className=f,e.onclick=function(){y()},t().getElementsByTagName("body")[0].appendChild(e)},x=function(a,b,c,d){var f,g,h,i,j=(c+a)/2,k=(d+b)/2,l=j-t().documentElement.clientWidth/2,m=k-t().documentElement.clientHeight/2;h=i=f=u();var n,o;n=o=g=u();for(var p=1e3;p&&(h=Math.min(h,f),i=Math.max(i,f),n=Math.min(n,g),o=Math.max(o,g),e.modules.ui.mainFrameWindow.scrollBy(l-f,m-g),f=u(),g=v(),!(f>=h&&i>=f&&g>=n&&o>=g));p--);},y=function(){for(var a=t().getElementsByClassName(f),b=a.length-1;b>=0;b--)a[b].parentNode.removeChild(a[b])},z=function(){return e.baseUrl+"/index"+(e.concatenated?".min":"")+".html"+(e.gruntBuildTimeStamp?"?"+e.gruntBuildTimeStamp:"")},A=!1,B=!1,C=!1,D=function(){return 1e7};setInterval(s,200),e.scripts.push({getName:function(){return"ui"},setSize:function(){},showHideChooseJobFrame:function(a){a&&!j&&(this.chooseJobFrameWindow.location.href=e["data-choose-job"],j=!0),this.chooseJobFrame.style.display=a?"block":"none"},closePopup:function(){},highlight:function(a,b){var d,e=function(a,b){a.left=c===a.left?b.left:Math.min(a.left,b.left),a.right=c===a.right?b.right:Math.max(a.right,b.right),a.top=c===a.top?b.top:Math.min(a.top,b.top),a.bottom=c===a.bottom?b.bottom:Math.max(a.bottom,b.bottom)},f=this.mainFrameWindow.document.getElementsByTagName("body")[0];f.style.paddingBottom=this.mainFrameWindow.innerHeight+"px";var g=this;setTimeout(function(){if(c!==g.mainFrameWindow.jQuery&&a instanceof g.mainFrameWindow.jQuery)1>a.length?a=c:!0===b?(d={left:c,right:c,top:c,bottom:c},a.each(function(a,b){e(d,b.getBoundingClientRect())})):d=a[0].getBoundingClientRect();else if(a instanceof Array)if(!0===b){d={left:c,right:c,top:c,bottom:c};for(var h=a.length-1;h>=0;h--)e(d,a[h].getBoundingClientRect())}else a.length>0?d=a[0].getBoundingClientRect():a=c;else c!==a&&(d=a.getBoundingClientRect());var i=f.getBoundingClientRect(),j=v(),k=u(),l=Math.max(i.right+k,f.scrollWidth,g.mainFrameWindow.innerWidth)-1,m=Math.max(i.bottom+j,f.scrollHeight,g.mainFrameWindow.innerHeight)-1;if(y(),c!==a){var n=5;A=k+Math.round(d.left+d.right)/2,C=j+d.bottom,B=j+d.top,w(0,0,Math.max(0,d.left+k-n),m),w(Math.min(l,d.right+k+n),0,l,m),w(Math.max(0,d.left+k-n),0,Math.min(l,d.right+k+n),Math.min(m,d.top+j-n)),w(Math.max(0,d.left+k-n),Math.max(0,d.bottom+j+n),Math.min(l,d.right+k+n),m),x(d.left+k,d.top+j,d.right+k,d.bottom+j)}else w(0,0,l,m),A=C=B=!1},0)},arrowTo:function(a,b){if(k=[],c!==this.mainFrameWindow.jQuery&&a instanceof this.mainFrameWindow.jQuery)a.each(function(a,c){return k.push({element:c}),b?void 0:!1});else if(a instanceof Array)for(var d=0;d<a.length&&(k.push({element:a[d]}),b);d++);else c!==a?k.push({element:a}):(k=[],y())},say:function(a){var b=this;setTimeout(function(){var c=Math.max(100,Math.round(.5*b.mainFrameWindow.innerWidth)),d=b.mainFrameWindow.document.createElement("div");d.style.display="block",d.style.backgroundColor="#fff",d.style.padding="10px",d.style.fontSize="20px;",d.style.zIndex=D()+1,d.style.border="#bbb solid 10px",d.style.borderRadius="20px",d.style.overflow="auto",d.style.visibility="hidden",d.style.top=C+5+"px",d.style.left=Math.max(0,A-c)+"px",d.style.width=c+"px",d.style.height="auto",d.style.position="absolute",d.style.fontSize="20px",d.className=f,d.textContent=a,d.onclick=function(){y()},b.mainFrameWindow.document.getElementsByTagName("body")[0].appendChild(d),b.adjustMessageDiv(d)},0)},adjustMessageDiv:function(a,b){c===b&&(b=0);var d=this;setTimeout(function(){var c=!1;if(100>b){var e=a.getBoundingClientRect();e.bottom>d.mainFrameWindow.innerHeight?e.width>.95*d.mainFrameWindow.innerWidth?e.top-(C-B)-10<.05*d.mainFrameWindow.innerHeight?c=!0:d.mainFrameWindow.scrollBy(0,Math.round(.05*d.mainFrameWindow.innerHeight)):(a.style.left=Math.max(0,parseInt(a.style.left.replace("px",""))-Math.round(.04*d.mainFrameWindow.innerWidth))+"px",a.style.width=Math.min(d.mainFrameWindow.innerWidth,parseInt(a.style.width.replace("px",""))+Math.round(.04*d.mainFrameWindow.innerWidth))+"px"):c=!0}else c=!0;c?a.style.visibility="visible":d.adjustMessageDiv(a,b+1)},0)},popup:function(a,b){var f=b.innerWidth,g=b.innerHeight,j=.02*f,k=.76*f,l=.02*g,m=.96*g,n=.8*f-1,o=.2*f-1;e.modules.dispatcher.init(),this.mainFrameWindow=b.open(b.location.href,"_blank","height="+Math.round(b.outerHeight)+", width="+Math.round(.8*b.outerWidth)),this.closePopup=function(){this.mainFrameWindow.close()},this.mainFrameWindow.addEventListener("load",function(){e.modules.dispatcher.onMainFrameLoaded()},!0);var p=this;setTimeout(function r(){p.mainFrameWindow.document&&"complete"===p.mainFrameWindow.document.readyState&&e.modules.dispatcher.onMainFrameLoaded(!0),setTimeout(r,100)},100);for(var q=b.document.getElementsByTagName("body")[0];q.children.length;)q.removeChild(q.children[0]);this.setSize=function(a){c===a&&(a="big"===d?"small":"big"),d=a,"big"===a?(this.workerFrame.style.width=n+"px",this.workerFrame.style.left=f-n-5+"px"):"small"===a&&(this.workerFrame.style.width=o+"px",this.workerFrame.style.left=f-o-5+"px")},this.workerFrame=b.document.createElement("iframe"),this.workerFrame.setAttribute("name",h),this.workerFrame.style.position="fixed",this.workerFrame.style.top="0px",this.workerFrame.style.height="100%",this.workerFrame.style.zIndex="100000",this.setSize("big"),q.appendChild(this.workerFrame),this.workerFrameWindow=b.frames[h],this.workerFrameWindow.location.href=z(),this.chooseJobFrame=b.document.createElement("iframe"),this.chooseJobFrame.setAttribute("name",i),this.chooseJobFrame.style.position="fixed",this.chooseJobFrame.style.height=m+"px",this.chooseJobFrame.style.top=l+"px",this.chooseJobFrame.style.left=j+"px",this.chooseJobFrame.style.width=k+"px",this.chooseJobFrame.style.zIndex="1000000",this.chooseJobFrame.style.background="white",q.appendChild(this.chooseJobFrame),this.chooseJobFrameWindow=b.frames[i]},framed:function(a,b){e.modules.dispatcher.init();for(var d=a.getElementsByTagName("body")[0],f=b.location.href,j=b.innerWidth,k=b.innerHeight,l=.8*j-1,m=.2*j-1,n=.8*j-1,o=.2*j-1,p=k-15,q=.02*j,r=.76*j,s=.02*k,t=.96*k,u="big";d.children.length;)d.removeChild(d.children[0]);this.mainFrame=a.createElement("iframe"),this.mainFrame.setAttribute("name",g),this.mainFrame.style.height=p+"px",this.mainFrame.style.position="fixed",this.mainFrame.style.left="0px",this.mainFrame.style.top="0px",this.workerFrame=a.createElement("iframe"),this.workerFrame.setAttribute("name",h),this.workerFrame.style.height=p+"px",this.workerFrame.style.position="fixed",this.workerFrame.style.top="0px",this.chooseJobFrame=a.createElement("iframe"),this.chooseJobFrame.setAttribute("name",i),this.chooseJobFrame.style.display="none",this.chooseJobFrame.style.height=t+"px",this.chooseJobFrame.style.top=s+"px",this.chooseJobFrame.style.left=q+"px",this.chooseJobFrame.style.width=r+"px",this.chooseJobFrame.style.position="fixed",this.chooseJobFrame.style.background="white",d.appendChild(this.mainFrame),this.mainFrameWindow=b.frames[g],this.mainFrame.onload=function(){e.modules.dispatcher.onMainFrameLoaded()},this.mainFrameWindow.location.href=f,d.appendChild(this.workerFrame),this.workerFrameWindow=b.frames[h],this.workerFrameWindow.location.href=z(),d.appendChild(this.chooseJobFrame),this.chooseJobFrameWindow=b.frames[i],this.setSize=function(a){c===a&&(a="big"===u?"small":"big"),u=a,"big"===a?(this.workerFrame.style.width=n+"px",this.mainFrame.style.width=m+"px",this.workerFrame.style.left=m+"px"):"small"===a&&(this.workerFrame.style.width=o+"px",this.mainFrame.style.width=l+"px",this.workerFrame.style.left=l+"px")},this.setSize("big")}})}.call(this,document,window)}).call({cartFillerConfiguration:{},cartFillerEval:this.cartFillerEval});