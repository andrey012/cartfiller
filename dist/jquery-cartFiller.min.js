/*
 *  cartFiller - v0.0.1
 *  Tool for automating cart filling process when doing big purchases
 *  https://andrey012.github.com/cartFiller
 *
 *  Made by Andrey Grinenko
 *  Under MIT License
 */
!function(a){"use strict";function b(b,e){this.element=b,this.settings=a.extend({},d,e),this._defaults=d,this._name=c,this.init()}var c="cartFillerPlugin",d={chooseJob:"",baseUrl:"",inject:"script",minified:!0,type:"framed",debug:!1,worker:"",traceStartup:!1,logLength:!1,useSource:!1};a.extend(b.prototype,{init:function(){var b;"script"===this.settings.inject?b=this.scriptBookmarklet():"eval"===this.settings.inject?b=this.evalBookmarklet():"iframe"===this.settings.inject?b=this.iframeBookmarklet():alert('invalid inject value, correct values are "script", "eval" and "iframe"'),this.settings.logLength&&console.log("generated bookmarklet: "+b.length),a(this.element).attr("href",b)},getTypeId:function(){return"framed"===this.settings.type?0:"popup"===this.settings.type?1:(alert('type not set or invalid, should be either "framed" or "popup"'),0)},getInjectUrl:function(){var a;return a=this.settings.minified?"inject.min.js":"inject.js",(this.settings.useSource?"/boot/":"/")+a},getIframeUrl:function(){return(this.settings.useSource?"/boot/":"/")+"i.htm"},trace:function(a){return this.settings.traceStartup?"alert('"+a+"');":""},scriptBookmarklet:function(){return this.javaScriptUrl()+"try{"+this.trace("start")+"(function(d,c,a,t,o,b,e,u,v,j,k,x,y,w,z,s){"+this.trace("in function")+"s=d.createElement('script');"+this.trace("script element created")+"s[a](c+t,o);"+this.trace("type set")+"s[a](c+b,e);"+this.trace("base-url set")+"s[a](u,e+v+'?'+(new Date()).getTime());"+this.trace("src set")+"s[a](c+j,k);"+this.trace("choose-job set")+"if(x)s[a](c+x,y);"+this.trace("debug set")+"if(w)s[a](c+w,z);"+this.trace("worker set")+"s.onerror=function(){alert('error');};"+this.trace("onerror set")+"d.getElementsByTagName('head')[0].appendChild(s);"+this.trace("script element added")+"})(document,'data-','setAttribute','type',"+this.getTypeId()+",'base-url','"+this.settings.baseUrl+"','src','"+this.getInjectUrl()+"','choose-job','"+this.settings.chooseJob+"','debug',"+(this.settings.debug?1:0)+",'worker','"+this.settings.worker+"');}catch(e){alert(e);}"},evalBookmarklet:function(){return this.javaScriptUrl()+"try{"+this.trace("start")+"(function(f,x,t,u,v,j,d){"+this.trace("in function")+"x.open('GET',u+v+'?'+(new Date()).getTime(),true);"+this.trace("x opened")+"x.onload=function(){try{"+this.trace("x onload called")+"f=1;eval('(function(){'+x.response+'}).call({cartFillerEval:[u,t,j,d]});');"+this.trace("eval complete")+"}catch(e){alert(e);}};"+this.trace("x onload set")+"setTimeout(function(){if(!f)alert('error');},5000);"+this.trace("onerror set")+"x.send();"+this.trace("x sent")+"})(0,new XMLHttpRequest(),"+this.getTypeId()+",'"+this.settings.baseUrl+"','"+this.getInjectUrl()+"','"+this.settings.chooseJob+"',"+(this.settings.debug?1:0)+");}catch(e){alert(e);}"},iframeBookmarklet:function(){return this.javaScriptUrl()+"try{"+this.trace("start")+"(function(f,d,p,t,u,v,m,j,y,x,i){"+this.trace("in")+"window.addEventListener('message',function(e){f=1;try{"+this.trace("event")+"if(p.test(x=e.data)){"+this.trace("event+")+"eval('(function(){'+x+'}).call({cartFillerEval:[u,t,j,y]});');"+this.trace("eval done")+"}}catch(e){alert(e);}},true);"+this.trace("lstnr+")+"i=d.createElement('iframe');"+this.trace("iframe")+"d.getElementsByTagName('body')[0].appendChild(i);"+this.trace("iframe+")+"i.contentWindow.location.href=u+v+(m?'?min&':'?')+(new Date()).getTime();"+this.trace("iframe++")+"setTimeout(function(){if(!f)alert('error');},5000);"+this.trace("timeout set")+"})(0,document,/^'cartFillerEval'/,"+this.getTypeId()+",'"+this.settings.baseUrl+"','"+this.getIframeUrl()+"',"+(this.settings.minified?1:0)+",'"+this.settings.chooseJob+"',"+(this.settings.debug?1:0)+");}catch(e){alert(e);}"},javaScriptUrl:function(){var a="java",b="script";return a+b+":"}}),a.fn[c]=function(d){return this.each(function(){a.data(this,"plugin_"+c)||a.data(this,"plugin_"+c,new b(this,d))})}}(jQuery,window,document);